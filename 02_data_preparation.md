

# ë°ì´í„° ì¤€ë¹„ {#data_preparation}

## ë°ì´í„° ìœ í˜• ì²˜ë¦¬ {#data_types}

### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?

ë°ì´í„° í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ ì¤‘ í•˜ë‚˜ëŠ” ê° ë³€ìˆ˜ì— ì˜¬ë°”ë¥¸ ë°ì´í„° ìœ í˜•ì„ í• ë‹¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ê°„ë‹¨í•´ ë³´ì´ëŠ” ì‘ì—…ì´ì§€ë§Œ, ì¼ë¶€ ì•Œê³ ë¦¬ì¦˜ì€ íŠ¹ì • ë°ì´í„° ìœ í˜•ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ê° ê²½ìš°ì˜ ì˜ë¯¸ë¥¼ ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…í•˜ë©´ì„œ ì´ëŸ¬í•œ ë³€í™˜ì„ ë‹¤ë£¨ë ¤ê³  í•©ë‹ˆë‹¤.


<div class="figure">
<img src="data_preparation/fibonacci_spiral.jpg" alt="í”¼ë³´ë‚˜ì¹˜ ë‚˜ì„ " height="150px"  />
<p class="caption">(\#fig:Fibonnacci-curve)í”¼ë³´ë‚˜ì¹˜ ë‚˜ì„ </p>
</div>

_í”¼ë³´ë‚˜ì¹˜ ìˆ˜ì—´. ìì—°ê³¼ ì¸ì²´ì— ì¡´ì¬í•˜ëŠ” ìˆ«ìì˜ ìˆœì„œ._

**ì´ ì¥ì—ì„œ ë¬´ì—‡ì„ ê²€í† í•  ì˜ˆì •ì¸ê°€ìš”?**

* ì˜¬ë°”ë¥¸ ë°ì´í„° ìœ í˜• ê°ì§€
* ë²”ì£¼í˜•ì„ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•
* ìˆ«ìí˜•ì„ ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²• (ì´ì‚°í™” ë°©ë²•)
* ì´ë¡  ë° ì‹¤ì œì  ì¸¡ë©´ (R ì˜ˆì œ)
* ì˜ˆì¸¡ ëª¨ë¸ì´ ìˆ«ìí˜• ë³€ìˆ˜ë¥¼ ë³´ëŠ” ë°©ì‹

### ë°ì´í„° ìœ í˜•ì˜ ì„¸ê³„

ì£¼ìš” ë°ì´í„° ìœ í˜•ì€ **ìˆ«ìí˜•**ê³¼ **ë²”ì£¼í˜•** ë‘ ê°€ì§€ì…ë‹ˆë‹¤. ë²”ì£¼í˜•ì˜ ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œëŠ” **ë¬¸ìì—´**ê³¼ **ëª…ëª©í˜•**ì´ ìˆìŠµë‹ˆë‹¤.

ë²”ì£¼í˜•ì˜ í•˜ìœ„ ì§‘í•©ìœ¼ë¡œ ìˆœì„œí˜• ë˜ëŠ” Rì—ì„œ **ì •ë ¬ëœ(ordered)** íŒ©í„°ë¼ê³  ë¶ˆë¦¬ëŠ” ìœ í˜•ì´ ìˆìŠµë‹ˆë‹¤. ì ì–´ë„ Rì—ì„œëŠ” ì´ ìœ í˜•ì€ íŠ¹ì • ìˆœì„œë¡œ ë²”ì£¼ë¥¼ ê·¸ë¦´ ë•Œë§Œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. R ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```r
# ìˆœì„œí˜• ë˜ëŠ” ì •ë ¬ëœ íŒ©í„° ìƒì„±
var_factor=factor(c("3_high", "2_mid", "1_low"))
var_ordered=factor(var_factor, ordered = T)
var_ordered
```

ìˆ«ìí˜•ê³¼ ë²”ì£¼í˜•ì´ ê°€ì¥ í•„ìš”í•˜ë¯€ë¡œ ì´ ë°ì´í„° ìœ í˜•ì—ëŠ” ë„ˆë¬´ ë§ì€ ì£¼ì˜ë¥¼ ê¸°ìš¸ì´ì§€ ë§ˆì‹­ì‹œì˜¤.

#### ì´ì§„ ë³€ìˆ˜, ìˆ«ìí˜• ë˜ëŠ” ë²”ì£¼í˜•?

ì´ ì±…ì€ `0`ì´ `FALSE`ì´ê³  `1`ì´ `TRUE`ì¼ ë•Œ ì´ì§„ ë³€ìˆ˜ë¥¼ ìˆ«ìí˜•ìœ¼ë¡œ ì‚¬ìš©í•  ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ë¥¼ í”„ë¡œíŒŒì¼ë§í•˜ê¸°ê°€ ë” ì‰½ìŠµë‹ˆë‹¤.

### ì•Œê³ ë¦¬ì¦˜ë³„ ë°ì´í„° ìœ í˜•

ì¼ë¶€ ì•Œê³ ë¦¬ì¦˜ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤.

* ğŸ“Š ë²”ì£¼í˜• ë°ì´í„°ë§Œ ì‚¬ìš©
* ğŸ“ ìˆ«ìí˜• ë°ì´í„°ë§Œ ì‚¬ìš©
* ğŸ“ŠğŸ“ ë‘ ê°€ì§€ ìœ í˜• ëª¨ë‘ ì‚¬ìš©

ë˜í•œ, ëª¨ë“  ì˜ˆì¸¡ ëª¨ë¸ì´ **ê²°ì¸¡ê°’**ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

**ë°ì´í„° ì‚¬ì´ì–¸ìŠ¤ ë¼ì´ë¸Œ ë¶**ì€ ì´ ëª¨ë“  ìƒí™©ì„ ë‹¤ë£¨ë ¤ê³  í•©ë‹ˆë‹¤.

### ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜í•˜ê¸°

Rì˜ `caret` íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ **í”Œë˜ê·¸ ë³€ìˆ˜**(ë”ë¯¸ ë³€ìˆ˜ë¼ê³ ë„ í•¨)ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•œ ì‘ì—…ì…ë‹ˆë‹¤.

ì›ë˜ ë²”ì£¼í˜• ë³€ìˆ˜ì— 30ê°œì˜ ê°€ëŠ¥í•œ ê°’ì´ ìˆë‹¤ë©´, 30ê°œì˜ ìƒˆ ì—´ì´ ìƒì„±ë˜ì–´ `0` ë˜ëŠ” `1` ê°’ì„ ê°€ì§€ê²Œ ë˜ë©°, ì—¬ê¸°ì„œ `1`ì€ í•´ë‹¹ í–‰ì— í•´ë‹¹ ë²”ì£¼ê°€ ì¡´ì¬í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

Rì˜ caret íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ë³€í™˜ì€ ë‹¨ ë‘ ì¤„ì˜ ì½”ë“œë§Œ í•„ìš”í•©ë‹ˆë‹¤.


``` r
library(caret) # dummyVars í•¨ìˆ˜ í¬í•¨
library(dplyr) # ë°ì´í„° ì •ì œ ë¼ì´ë¸ŒëŸ¬ë¦¬
library(funModeling) # df_status í•¨ìˆ˜ í¬í•¨
  
# ë²”ì£¼í˜• ë³€ìˆ˜ í™•ì¸
status=df_status(heart_disease)
```

```
##                  variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1                     age       0    0.00    0 0.00     0     0 integer     41
## 2                  gender       0    0.00    0 0.00     0     0  factor      2
## 3              chest_pain       0    0.00    0 0.00     0     0  factor      4
## 4  resting_blood_pressure       0    0.00    0 0.00     0     0 integer     50
## 5       serum_cholestoral       0    0.00    0 0.00     0     0 integer    152
## 6     fasting_blood_sugar     258   85.15    0 0.00     0     0  factor      2
## 7         resting_electro     151   49.83    0 0.00     0     0  factor      3
## 8          max_heart_rate       0    0.00    0 0.00     0     0 integer     91
## 9             exer_angina     204   67.33    0 0.00     0     0 integer      2
## 10                oldpeak      99   32.67    0 0.00     0     0 numeric     40
## 11                  slope       0    0.00    0 0.00     0     0 integer      3
## 12      num_vessels_flour     176   58.09    4 1.32     0     0 integer      4
## 13                   thal       0    0.00    2 0.66     0     0  factor      3
## 14 heart_disease_severity     164   54.13    0 0.00     0     0 integer      5
## 15           exter_angina     204   67.33    0 0.00     0     0  factor      2
## 16      has_heart_disease       0    0.00    0 0.00     0     0  factor      2
```

``` r
filter(status,  type %in% c("factor", "character")) %>% select(variable)
```

```
##              variable
## 1              gender
## 2          chest_pain
## 3 fasting_blood_sugar
## 4     resting_electro
## 5                thal
## 6        exter_angina
## 7   has_heart_disease
```

``` r
# ëª¨ë“  ë²”ì£¼í˜• ë³€ìˆ˜(íŒ©í„° ë° ë¬¸ìì—´)ë¥¼ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
# ê¸°ì¡´ ë³€ìˆ˜ë¥¼ ìƒëµí•˜ë¯€ë¡œ ë³€í™˜ í›„ì— ì œê±°í•  í•„ìš”ê°€ ì—†ìœ¼ë©°, ë°ì´í„°ê°€ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
dmy = dummyVars(" ~ .", data = heart_disease)
heart_disease_2 = data.frame(predict(dmy, newdata = heart_disease))

# ìƒˆë¡œìš´ ìˆ˜ì¹˜í˜• ë°ì´í„°ì…‹ í™•ì¸:
colnames(heart_disease_2)
```

```
##  [1] "age"                    "gender.female"          "gender.male"           
##  [4] "chest_pain.1"           "chest_pain.2"           "chest_pain.3"          
##  [7] "chest_pain.4"           "resting_blood_pressure" "serum_cholestoral"     
## [10] "fasting_blood_sugar.0"  "fasting_blood_sugar.1"  "resting_electro.0"     
## [13] "resting_electro.1"      "resting_electro.2"      "max_heart_rate"        
## [16] "exer_angina"            "oldpeak"                "slope"                 
## [19] "num_vessels_flour"      "thal.3"                 "thal.6"                
## [22] "thal.7"                 "heart_disease_severity" "exter_angina.0"        
## [25] "exter_angina.1"         "has_heart_disease.no"   "has_heart_disease.yes"
```



ì›ë³¸ ë°ì´í„° `heart_disease`ëŠ” ë²”ì£¼í˜• ë³€ìˆ˜ ì—†ì´ ìˆ˜ì¹˜í˜• ë° ë”ë¯¸ ë³€ìˆ˜ë§Œ í¬í•¨ëœ `heart_disease_2`ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ ê° ë³€ìˆ˜ ëª…ì—ëŠ” ì (`.`) ë’¤ì— í•´ë‹¹ ê°’ì´ ë¶™ìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, 4ê°€ì§€ ê°’(`1`, `2`, `3`, `4`)ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” `chest_pain` ë³€ìˆ˜ì˜ 7ë²ˆì§¸ í™˜ì(í–‰)ì— ëŒ€í•´ ë³€í™˜ ì „í›„ë¥¼ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.


``` r
# ë³€í™˜ ì „
as.numeric(heart_disease[7, "chest_pain"])
```

```
## [1] 4
```

``` r
# ë³€í™˜ í›„
heart_disease_2[7, c("chest_pain.1", "chest_pain.2", "chest_pain.3", "chest_pain.4")]
```

```
##   chest_pain.1 chest_pain.2 chest_pain.3 chest_pain.4
## 7            0            0            0            1
```

ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë§Œ ìœ ì§€ ë° ë³€í˜•í•˜ê³  ëª…ëª©í˜• ë³€ìˆ˜ë¥¼ ì œì™¸í•¨ìœ¼ë¡œì¨, `heart_disease_2` ë°ì´í„°ëŠ” ë¶„ì„ì— ë°”ë¡œ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

`dummyVars`ì— ëŒ€í•œ ë” ìì„¸í•œ ì •ë³´: http://amunategui.github.io/dummyVar-Walkthrough/



### ë²”ì£¼í˜•ì¸ê°€ìš”, ìˆ˜ì¹˜í˜•ì¸ê°€ìš”? ìƒê°í•´ ë´…ì‹œë‹¤.

`1`, `2`, `3`, `4`ì˜ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆëŠ” `chest_pain` ë³€ìˆ˜ë¥¼ ìƒê°í•´ ë³´ì„¸ìš”. ì´ ë³€ìˆ˜ëŠ” ë²”ì£¼í˜•ì¸ê°€ìš”, ìˆ˜ì¹˜í˜•ì¸ê°€ìš”?

ë§Œì•½ ê°’ì´ ìˆœì„œê°€ ìˆë‹¤ë©´, ì¦‰ 1 < 2 < 3 < 4ì™€ ê°™ì´ **ìˆœì„œ(order)**ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤ë©´ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ê³ ë ¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ì‚¬ê²°ì • íŠ¸ë¦¬ ëª¨ë¸ì„ ë§Œë“ ë‹¤ë©´, "`If chest_pain > 2.5, then...`"ê³¼ ê°™ì€ ê·œì¹™ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²Œ ë§ì´ ë ê¹Œìš”? ì•Œê³ ë¦¬ì¦˜ì€ ì‹¤ì œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°’(`2.5`)ì„ ê¸°ì¤€ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ë¶„í• í•˜ì§€ë§Œ, ìš°ë¦¬ëŠ” ì´ë¥¼ "ë§Œì•½ `chest_pain`ì´ 3 ì´ìƒì´ë¼ë©´..."ìœ¼ë¡œ í•´ì„í•©ë‹ˆë‹¤.


#### ì•Œê³ ë¦¬ì¦˜ì²˜ëŸ¼ ìƒê°í•˜ê¸°

ë‘ ê°œì˜ ìˆ˜ì¹˜í˜• ì…ë ¥ ë³€ìˆ˜ì™€ í•˜ë‚˜ì˜ ì´ì§„ íƒ€ê²Ÿ ë³€ìˆ˜ë¥¼ ìƒê°í•´ ë´…ì‹œë‹¤. ì•Œê³ ë¦¬ì¦˜ì€ ê° ìˆ«ì ì‚¬ì´ì— ë¬´í•œí•œ ê°’ì´ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í•˜ê³  ë‘ ì…ë ¥ ë³€ìˆ˜ë¥¼ í‰ë©´ ìœ„ì˜ ì ìœ¼ë¡œ _ì¸ì‹_í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, **ì„œí¬íŠ¸ ë²¡í„° ë¨¸ì‹ **(SVM)ì€ íƒ€ê²Ÿ ë³€ìˆ˜ì˜ í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ _ì—¬ëŸ¬ ê°œì˜_ ë²¡í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ë²¡í„°ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ **ì˜ì—­(regions)**ì„ ì°¾ìŠµë‹ˆë‹¤. ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ëŸ¬í•œ ì˜ì—­ì„ ì°¾ëŠ” ê²ƒì´ ê°€ëŠ¥í• ê¹Œìš”? ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ SVMì´ ì¸ê³µ ì‹ ê²½ë§ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë§Œ ì§€ì›í•˜ëŠ” ì´ìœ ì…ë‹ˆë‹¤.


<div class="figure">
<img src="data_preparation/svm.png" alt="ì„œí¬íŠ¸ ë²¡í„° ë¨¸ì‹  (SVM)" width="200px"  />
<p class="caption">(\#fig:Support-Vector-Machine)ì„œí¬íŠ¸ ë²¡í„° ë¨¸ì‹  (SVM)</p>
</div>

_ì´ë¯¸ì§€ ì¶œì²˜: ZackWeinberg_

ìœ„ ì´ë¯¸ì§€ëŠ” ì„¸ ê°œì˜ ì„ ì„ ë³´ì—¬ì£¼ë©°, ì´ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì„¸ ê°œì˜ ê²°ì • ê²½ê³„ ë˜ëŠ” ì˜ì—­ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

SVM ê°œë…ì— ëŒ€í•œ ë¹ ë¥¸ ì†Œê°œë¥¼ ë³´ë ¤ë©´ ë‹¤ìŒ ì§§ì€ ì˜ìƒì„ ì°¸ê³ í•˜ì„¸ìš”: [SVM Demo](https://www.youtube.com/watch?v=1NxnPkZM9bc).

í•˜ì§€ë§Œ ì˜ì‚¬ê²°ì • íŠ¸ë¦¬, ëœë¤ í¬ë ˆìŠ¤íŠ¸, ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹ ê³¼ ê°™ì€ íŠ¸ë¦¬ ê¸°ë°˜ ëª¨ë¸ì€ ê·¸ ê²€ìƒ‰ ê³µê°„ì´ ì˜ì—­(SVMê³¼ ë™ì¼)ë¿ë§Œ ì•„ë‹ˆë¼ ë²”ì£¼ì¼ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ë‘ ê°€ì§€ ìœ í˜•ì„ ëª¨ë‘ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ: "`if postal_code is AX441AG and age > 55, then...`".

ë‹¤ì‹œ ì‹¬ì¥ ì§ˆí™˜ ì˜ˆì œë¡œ ëŒì•„ê°€ì„œ, `chest_pain` ë³€ìˆ˜ëŠ” ìˆœì„œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ì ì„ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ë¥¼ ë²”ì£¼í˜• ë³€ìˆ˜ë¡œ ë³€í™˜í•˜ë©´ **ì •ë³´ë¥¼ ìƒê²Œ ë˜ê¸° ë•Œë¬¸**ì´ë©°, ì´ëŠ” ë°ì´í„° ìœ í˜•ì„ ì²˜ë¦¬í•  ë•Œ ì¤‘ìš”í•œ í¬ì¸íŠ¸ì…ë‹ˆë‹¤.


#### ëª¨ë“  ê²ƒì„ ë²”ì£¼í˜•ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ í•´ê²°ì±…ì¼ê¹Œìš”?

ì•„ë‹ˆìš”... ìˆ˜ì¹˜í˜• ë³€ìˆ˜ëŠ” ìˆœì„œ ë•ë¶„ì— ëª…ëª©í˜• ë³€ìˆ˜ë³´ë‹¤ ë” ë§ì€ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ë²”ì£¼í˜• ë³€ìˆ˜ì—ì„œëŠ” ê°’ë“¤ì„ ì§ì ‘ ë¹„êµí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `If postal code is higher than "AX2004-P"`ì™€ ê°™ì€ ê·œì¹™ì„ ë§Œë“œëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

ëª…ëª©í˜• ë³€ìˆ˜ì˜ ê°’ë“¤ì€ ì°¸ì¡°í•  ë‹¤ë¥¸ ë³€ìˆ˜(ë³´í†µ ì˜ˆì¸¡í•  ê²°ê³¼ê°’)ê°€ ìˆì„ ë•Œë§Œ ë¹„êµë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ìš°í¸ ë²ˆí˜¸ "AX2004-P"ê°€ "MA3942-H"ë³´ë‹¤ _ë” ë†’ì€_ ì´ìœ ëŠ” í•´ë‹¹ ì§€ì—­ì— ì‚¬ì§„ ê°•ì˜ ìˆ˜ê°•ì— ê´€ì‹¬ ìˆëŠ” ì‚¬ëŒë“¤ì´ ë” ë§ê¸° ë•Œë¬¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, **ê³ ì¹´ë””ë„ë¦¬í‹°(high cardinality)**ëŠ” ë²”ì£¼í˜• ë³€ìˆ˜ì—ì„œ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìˆ˜ë°± ê°œì˜ ë‹¤ë¥¸ ê°’ì„ í¬í•¨í•˜ëŠ” `postal code` ë³€ìˆ˜ê°€ ê·¸ë ‡ìŠµë‹ˆë‹¤. ì´ ì±…ì€ [ê¸°ìˆ  í†µê³„ëŸ‰](#high_cardinality_descriptive_stats) ë° [ì˜ˆì¸¡ ëª¨ë¸ë§](#high_cardinality_predictive_modeling) ì¥ì—ì„œ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤.

ì–´ì¨Œë“  ëª¨ë“  ë³€ìˆ˜ë¥¼ ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•˜ê³  ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì§ì ‘ _ë¬´ë£Œ í…ŒìŠ¤íŠ¸_ë¥¼ í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì¼ ë•Œì˜ ê²°ê³¼ì™€ ë¹„êµí•´ ë³´ì„¸ìš”. í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ Kappaë‚˜ ROC í†µê³„ëŸ‰ê³¼ ê°™ì€ ì¢‹ì€ ì˜¤ì°¨ ì¸¡ì • ì§€í‘œë¥¼ ì‚¬ìš©í•˜ê³ , ê²°ê³¼ë¥¼ êµì°¨ ê²€ì¦í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.


#### ë²”ì£¼í˜•ì„ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¡œ ë³€í™˜í•  ë•Œ ì£¼ì˜í•  ì 

ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•˜ëŠ” ìƒí™©ì„ ê°€ì •í•´ ë´…ì‹œë‹¤. ì´ì „ ì‚¬ë¡€ì™€ ê°™ì´ ê° ë²”ì£¼ì— ë‹¤ë¥¸ ìˆ«ìë¥¼ í• ë‹¹í•˜ëŠ” **ë³€í™˜(transformation)**ì„ ì‹œë„í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë³€í™˜ì„ í•  ë•ŒëŠ” ë³€ìˆ˜ì— **ìˆœì„œë¥¼ ë„ì…**í•˜ê²Œ ë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ë„¤ ê°œì˜ í–‰ì„ ê°€ì§„ ë‹¤ìŒ ë°ì´í„°ë¥¼ ê³ ë ¤í•´ ë³´ì„¸ìš”. ì²˜ìŒ ë‘ ë³€ìˆ˜ëŠ” `visits`ì™€ `postal_code`ì…ë‹ˆë‹¤ (ì´ëŠ” ë‘ ê°œì˜ ì…ë ¥ ë³€ìˆ˜ì´ê±°ë‚˜, `visits`ë¥¼ ì…ë ¥ìœ¼ë¡œ í•˜ê³  `postal_code`ë¥¼ ì¶œë ¥ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ ëª¨ë‘ í•´ë‹¹ë©ë‹ˆë‹¤).

ë‹¤ìŒ ì½”ë“œëŠ” ë‘ ê°€ì§€ ê¸°ì¤€ì— ë”°ë¼ ë³€í™˜ëœ `postal_code`ì— ë”°ë¥¸ `visits`ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

* `transformation_1`: ì£¼ì–´ì§„ ìˆœì„œì— ë”°ë¼ ì¼ë ¨ë²ˆí˜¸ë¥¼ í• ë‹¹.
* `transformation_2`: `visits`ì˜ ìˆ˜ì— ë”°ë¼ ìˆ«ìë¥¼ í• ë‹¹.


``` r
# creating data -toy- sample 
df_pc=data.frame(visits=c(10, 59, 27, 33), postal_code=c("AA1", "BA5", "CG3", "HJ1"), transformation_1=c(1,2,3,4), transformation_2=c(1, 4, 2, 3 ))

# printing table
knitr::kable(df_pc)
```



| visits|postal_code | transformation_1| transformation_2|
|------:|:-----------|----------------:|----------------:|
|     10|AA1         |                1|                1|
|     59|BA5         |                2|                4|
|     27|CG3         |                3|                2|
|     33|HJ1         |                4|                3|

``` r
library(gridExtra)

# transformation 1
plot_1=ggplot(df_pc, aes(x=transformation_1, y=visits, label=postal_code)) +  geom_point(aes(color=postal_code), size=4)+ geom_smooth(method=loess, group=1, se=FALSE, color="lightblue", linetype="dashed") + theme_minimal()  + theme(legend.position="none") + geom_label(aes(fill = factor(postal_code)), colour = "white", fontface = "bold")
  

# transformation 2
plot_2=ggplot(df_pc, aes(x=transformation_2, y=visits, label=postal_code)) +  geom_point(aes(color=postal_code), size=4)+ geom_smooth(method=lm, group=1, se=FALSE, color="lightblue", linetype="dashed") + theme_minimal()  + theme(legend.position="none") + geom_label(aes(fill = factor(postal_code)), colour = "white", fontface = "bold")
  
# ì—¬ëŸ¬ í”Œë¡¯ì„ ë‚˜ë€íˆ ë°°ì¹˜
grid.arrange(plot_1, plot_2, ncol=2)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-types-in-machine-learning-1.png" alt="ë°ì´í„° ë³€í™˜ ë¹„êµ" width="864"  />
<p class="caption">(\#fig:data-types-in-machine-learning)ë°ì´í„° ë³€í™˜ ë¹„êµ</p>
</div>

ë„¤ ê°œì˜ í–‰ìœ¼ë¡œ ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•˜ëŠ” ì‚¬ëŒì€ ì•„ë¬´ë„ ì—†ê² ì§€ë§Œ, ì´ ì˜ˆì œì˜ ì˜ë„ëŠ” ê´€ê³„ê°€ ë¹„ì„ í˜•(`transformation_1`)ì—ì„œ ì„ í˜•(`transformation_2`)ìœ¼ë¡œ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ì´ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì´ ê´€ê³„ë¥¼ ë” ì‰½ê²Œ ì„¤ëª…í•˜ê³  íŒŒì•…í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

ë°ì´í„° í–‰ì´ ìˆ˜ë°±ë§Œ ê°œë¡œ ëŠ˜ì–´ë‚˜ê³  ë³€ìˆ˜ ìˆ˜ê°€ ìˆ˜ë°± ê°œë¡œ í™•ì¥ë˜ì–´ë„ íš¨ê³¼ëŠ” ë™ì¼í•©ë‹ˆë‹¤. ì‘ì€ ë°ì´í„°ë¡œë¶€í„° ë°°ìš°ëŠ” ê²ƒì€ ì´ëŸ¬í•œ ê²½ìš°ì— ì˜¬ë°”ë¥¸ ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤.



### ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ì´ì‚°í™” (Discretizing numerical variables) {#discretizing_numerical_variables}

ì´ í”„ë¡œì„¸ìŠ¤ëŠ” ë°ì´í„°ë¥¼ êµ¬ê°„(bin)ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ë©‹ì§„ ì •ì˜ë¥¼ ìœ„í•´ _ìœ„í‚¤ë°±ê³¼_ë¥¼ ì¸ìš©í•˜ìë©´: _ì´ì‚°í™”(Discretization)ëŠ” ì—°ì†ì ì¸ í•¨ìˆ˜, ëª¨ë¸, ë°©ì •ì‹ì„ ì´ì‚°ì ì¸ ëŒ€ì‘ë¬¼ë¡œ ì˜®ê¸°ëŠ” ê³¼ì •ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤._

êµ¬ê°„(bins)ì€ ë²„í‚·(buckets) ë˜ëŠ” ì„¸ê·¸ë¨¼íŠ¸(segments)ë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤. ì˜ˆì œë¥¼ ê³„ì† ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

#### ë°ì´í„°ì— ëŒ€í•˜ì—¬

ì´ ë°ì´í„°ëŠ” ë°œìœ¡ ë¶€ì§„(stunted) ì•„ë™ì˜ ë¹„ìœ¨ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì´ìƒì ì¸ ê°’ì€ 0ì…ë‹ˆë‹¤.

> ì´ ì§€í‘œëŠ” ë°œìœ¡ ë¶€ì§„ìœ¼ë¡œ ê³ í†µë°›ëŠ” 5ì„¸ ë¯¸ë§Œ ì•„ë™ì˜ ë¹„ìœ¨ì„ ë°˜ì˜í•©ë‹ˆë‹¤. ë°œìœ¡ì´ ë¶€ì§„í•œ ì•„ë™ì€ ì§ˆë³‘ê³¼ ì‚¬ë§ì˜ ìœ„í—˜ì´ ë” í½ë‹ˆë‹¤.

ë°ì´í„° ì¶œì²˜: [ourworldindata.org, hunger and undernourishment](https://ourworldindata.org/hunger-and-undernourishment/#undernourishment-of-children).

ë¨¼ì €, ê°„ë‹¨í•œ **ë°ì´í„° ì¤€ë¹„**ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤. ê° í–‰ì€ êµ­ê°€-ì—°ë„ ìŒì„ ë‚˜íƒ€ë‚´ë¯€ë¡œ, êµ­ê°€ë³„ë¡œ ê°€ì¥ ìµœì‹  ì§€í‘œ ê°’ì„ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.


``` r
data_stunting=read.csv(file = "https://goo.gl/hFEUfN", 
                       header = T, 
                       stringsAsFactors = F)

# renaming the metric
data_stunting=
  dplyr::rename(
    data_stunting,
    share_stunted_child=
      Share.of.stunted.children.under.5
    )

# doing the grouping mentioned before
d_stunt_grp = group_by(data_stunting, Entity) %>% 
  filter(Year == max(Year)) %>%
  dplyr::summarise(share_stunted_child=
                     max(share_stunted_child)
                   )
```

ê°€ì¥ í‘œì¤€ì ì¸ êµ¬ê°„í™”(binning) ê¸°ì¤€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* ë™ì¼ ê°„ê²© (Equal range)
* ë™ì¼ ë¹ˆë„ (Equal frequency)
* ì‚¬ìš©ì ì •ì˜ êµ¬ê°„ (Custom bins)

ì•„ë˜ì—ì„œ ê°ê°ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.


#### ë™ì¼ ê°„ê²© (Equal range)

ë°ì´í„° ë¶„í¬ë¥¼ í™•ì¸í•˜ëŠ” íˆìŠ¤í† ê·¸ë¨ì—ì„œ í”íˆ ë³¼ ìˆ˜ ìˆëŠ” ë°©ì‹ì´ì§€ë§Œ, ì´ìƒì¹˜ì— ë§¤ìš° ì·¨ì•½í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë„¤ ê°œì˜ êµ¬ê°„ì„ ë§Œë“¤ë ¤ë©´ (ìµœëŒ€ê°’ - ìµœì†Œê°’)ì„ 4ë¡œ ë‚˜ëˆ„ì–´ì•¼ í•©ë‹ˆë‹¤.



``` r
# funModelingì— equal_freq(ì´ì‚°í™”) í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
library(funModeling)

# ggplot2 it provides 'cut_interval' function used to 
# split the variables based on equal range criteria
library(ggplot2) 

# `cut` í•¨ìˆ˜ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê³¼í•™ì  í‘œê¸°ë²•ì„ ë¹„í™œì„±í™”í•˜ë ¤ë©´
# `dig.lab=9` ë§¤ê°œë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
d_stunt_grp$share_stunted_child_eq_range=
  cut_interval(d_stunt_grp$share_stunted_child, n = 4)

# The â€˜describeâ€™ function from Hmisc package is 
# extremely useful to profile data
describe(d_stunt_grp$share_stunted_child_eq_range)
```

```
## d_stunt_grp$share_stunted_child_eq_range 
##        n  missing distinct 
##      154        0        4 
##                                                           
## Value       [1.3,15.8] (15.8,30.3] (30.3,44.8] (44.8,59.3]
## Frequency           62          45          37          10
## Proportion       0.403       0.292       0.240       0.065
```

``` r
# Plotting the variable
p2=ggplot(d_stunt_grp, 
          aes(share_stunted_child_eq_range)
          ) +
  geom_bar(fill="#009E73") + 
  theme_bw()
p2
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/equal-range-discretization-1.png" alt="ë™ì¼ ê°„ê²© ì´ì‚°í™”" width="384"  />
<p class="caption">(\#fig:equal-range-discretization)ë™ì¼ ê°„ê²© ì´ì‚°í™”</p>
</div>

`describe` ê²°ê³¼ëŠ” ë³€ìˆ˜ì— 4ê°œì˜ ì¹´í…Œê³ ë¦¬ê°€ ìˆìŒì„ ì•Œë ¤ì£¼ë©°, ê´„í˜¸/ëŒ€ê´„í˜¸ ì‚¬ì´ì— ê° ì¹´í…Œê³ ë¦¬ë³„ ì´ ì‚¬ë¡€ ìˆ˜(ì ˆëŒ€ê°’ ë° ìƒëŒ€ê°’)ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¹´í…Œê³ ë¦¬ `(15.8,30.3]`ì€ `share_stunted_child` ê°’ì´ 15.8(ë¯¸í¬í•¨)ì—ì„œ 30.3(í¬í•¨) ì‚¬ì´ì¸ ëª¨ë“  ì‚¬ë¡€ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
ì´ êµ¬ê°„ì€ `45`ë²ˆ ë‚˜íƒ€ë‚˜ë©° ì „ì²´ ì‚¬ë¡€ì˜ `29%`ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.


#### ë™ì¼ ë¹ˆë„ (Equal frequency) {#equal-frequency-binning}

ì´ ê¸°ìˆ ì€ ë°±ë¶„ìœ„ìˆ˜(percentiles)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê° êµ¬ê°„ì— ë™ì¼í•œ ìˆ˜ì˜ ê´€ì¸¡ì¹˜ê°€ ë“¤ì–´ê°€ë„ë¡ ê·¸ë£¹í™”í•©ë‹ˆë‹¤. ë°±ë¶„ìœ„ìˆ˜ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [ë¶€ë¡ 1: ë°±ë¶„ìœ„ìˆ˜ì˜ ë§ˆë²•](#appendix-percentiles) ì¥ì„ ì°¸ì¡°í•˜ì„¸ìš”.

`funModeling` íŒ¨í‚¤ì§€ì—ëŠ” ì´ ê¸°ì¤€ì— ë”°ë¼ êµ¬ê°„ì„ ìƒì„±í•˜ëŠ” `equal_freq` í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.



``` r
d_stunt_grp$stunt_child_ef=
  equal_freq(var = d_stunt_grp$share_stunted_child, 
             n_bins = 4
             )

# profiling variable 
describe(d_stunt_grp$stunt_child_ef)
```

```
## d_stunt_grp$stunt_child_ef 
##        n  missing distinct 
##      154        0        4 
##                                                           
## Value      [ 1.3, 9.5) [ 9.5,20.8) [20.8,32.9) [32.9,59.3]
## Frequency           40          37          39          38
## Proportion       0.260       0.240       0.253       0.247
```

``` r
p3=ggplot(d_stunt_grp, aes(stunt_child_ef)) + 
  geom_bar(fill="#CC79A7") + theme_bw()
p3
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/equal-frequency-discretization-1.png" alt="ë™ì¼ ë¹ˆë„ ì˜ˆì œ" width="384"  />
<p class="caption">(\#fig:equal-frequency-discretization)ë™ì¼ ë¹ˆë„ ì˜ˆì œ</p>
</div>


ì´ ê²½ìš°, 4ê°œì˜ êµ¬ê°„ì„ ì„ íƒí–ˆìœ¼ë¯€ë¡œ ê° êµ¬ê°„ì€ ì•½ 25%ì˜ ì ìœ ìœ¨ì„ ê°€ì§‘ë‹ˆë‹¤.


#### ì‚¬ìš©ì ì •ì˜ êµ¬ê°„ (Custom bins)

êµ¬ê°„ì„ ë‚˜ëˆŒ ì§€ì ì„ ì´ë¯¸ ì•Œê³  ìˆë‹¤ë©´ `cut` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
# dig.lab ë§¤ê°œë³€ìˆ˜ëŠ” ê³¼í•™ì  í‘œê¸°ë²•ì„ "ë¹„í™œì„±í™”"í•©ë‹ˆë‹¤.
d_stunt_grp$share_stunted_child_custom=
  cut(d_stunt_grp$share_stunted_child, 
      breaks = c(0, 2, 9.4, 29, 100)
      )

describe(d_stunt_grp$share_stunted_child_custom)
```

```
## d_stunt_grp$share_stunted_child_custom 
##        n  missing distinct 
##      154        0        4 
##                                               
## Value         (0,2]  (2,9.4] (9.4,29] (29,100]
## Frequency         5       35       65       49
## Proportion    0.032    0.227    0.422    0.318
```

``` r
p4=ggplot(d_stunt_grp, aes(share_stunted_child_custom)) + 
  geom_bar(fill="#0072B2") + 
  theme_bw()
p4
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/discretization-custom-bins-1.png" alt="ìˆ˜ë™ ì´ì‚°í™”" width="384"  />
<p class="caption">(\#fig:discretization-custom-bins)ìˆ˜ë™ ì´ì‚°í™”</p>
</div>

ê° ë²„í‚·ì˜ ìµœëŒ€ê°’ë§Œ ì •ì˜í•˜ë©´ ëœë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.

ì¼ë°˜ì ìœ¼ë¡œ ìµœì†Œê°’ì´ë‚˜ ìµœëŒ€ê°’ì„ ëª¨ë¥´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê·¸ëŸ° ê²½ìš°ì—ëŠ” `-Inf`ì™€ `Inf` ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šê³  ë²”ìœ„ ë°–ì˜ ê°’ì„ ì •ì˜í•˜ë©´ `cut`ì€ `NA` ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.

ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ì„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í• ë‹¹í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ê´€í–‰ì…ë‹ˆë‹¤. ì´ ì‚¬ë¡€ì—ì„œ ë³€ìˆ˜ëŠ” ë°±ë¶„ìœ¨ì´ë¯€ë¡œ ë²”ìœ„ê°€ 0ì—ì„œ 100 ì‚¬ì´ì„ì„ ë¯¸ë¦¬ ì•Œê³  ìˆì§€ë§Œ, âš ï¸ _ë§Œì•½ ë²”ìœ„ë¥¼ ëª¨ë¥¸ë‹¤ë©´ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§ˆê¹Œìš”?_

í•¨ìˆ˜ëŠ” ì ˆë‹¨ ì§€ì ë³´ë‹¤ ë‚®ê±°ë‚˜ ë†’ì€ ê°’ì— ëŒ€í•´ `NA`ë¥¼ ë°˜í™˜í•  ê²ƒì…ë‹ˆë‹¤. í•œ ê°€ì§€ í•´ê²°ì±…ì€ ë³€ìˆ˜ì˜ ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì…ë‹ˆë‹¤.


``` r
# ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ ê°€ì ¸ì˜¤ê¸°
min_value=min(d_stunt_grp$share_stunted_child)
max_value=max(d_stunt_grp$share_stunted_child)

# ìµœì†Œê°’ì„ í¬í•¨í•˜ë ¤ë©´ `include.lowest=T`ë¡œ ì„¤ì •í•˜ì„¸ìš”.
# ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ NAë¡œ í• ë‹¹ë©ë‹ˆë‹¤.
d_stunt_grp$share_stunted_child_custom_2=
  cut(d_stunt_grp$share_stunted_child, 
      breaks = c(min_value, 2, 9.4, 29, max_value), 
      include.lowest = T)

describe(d_stunt_grp$share_stunted_child_custom_2)
```

```
## d_stunt_grp$share_stunted_child_custom_2 
##        n  missing distinct 
##      154        0        4 
##                                                   
## Value        [1.3,2]   (2,9.4]  (9.4,29] (29,59.3]
## Frequency          5        35        65        49
## Proportion     0.032     0.227     0.422     0.318
```



### ìƒˆë¡œìš´ ë°ì´í„°ì—ì„œì˜ ì´ì‚°í™” {#discretization_new_data}

ì´ëŸ¬í•œ ëª¨ë“  ë³€í™˜ì€ ë³€ìˆ˜ì˜ ë¶„í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ í•™ìŠµ ë°ì´í„°ì…‹ì´ ì£¼ì–´ì¡Œì„ ë•Œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ë™ì¼ ë¹ˆë„ ë° ë™ì¼ ê°„ê²© ì´ì‚°í™”ì˜ ê²½ìš°ê°€ ê·¸ë ‡ìŠµë‹ˆë‹¤. _í•˜ì§€ë§Œ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë“¤ì–´ì˜¨ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?_

ìƒˆë¡œìš´ ìµœì†Œê°’ì´ë‚˜ ìµœëŒ€ê°’ì´ ë‚˜íƒ€ë‚˜ë©´ **ë™ì¼ ê°„ê²©** ë°©ë²•ì˜ êµ¬ê°„ ë²”ìœ„ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.
ìƒˆë¡œìš´ ê°’ì´ ë“¤ì–´ì˜¤ë©´ **ë™ì¼ ë¹ˆë„** ë°©ë²•ì—ì„œ ë³´ì•˜ë“¯ì´ ë°±ë¶„ìœ„ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œ ì§€ì ë“¤ì´ ì´ë™í•˜ê²Œ ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì œì•ˆëœ ì˜ˆì œì— `88`, `2`, `7`, `3`ì´ë¼ëŠ” ê°’ì„ ê°€ì§„ ë„¤ ê°œì˜ ì‚¬ë¡€ë¥¼ ì¶”ê°€í•œë‹¤ê³  ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.


``` r
# 4ê°œì˜ ìƒˆë¡œìš´ ê°’ì´ ë“¤ì–´ì˜¤ëŠ” ìƒí™© ì‹œë®¬ë ˆì´ì…˜
updated_data=c(d_stunt_grp$share_stunted_child, 88, 2, 7, 3)

# ë™ì¼ ë¹ˆë„ ê¸°ì¤€ ì´ì‚°í™”
updated_data_eq_freq=equal_freq(updated_data,4)

# ê²°ê³¼ëŠ”...
describe(updated_data_eq_freq)
```

```
## updated_data_eq_freq 
##        n  missing distinct 
##      158        0        4 
##                                                           
## Value      [ 1.3, 9.3) [ 9.3,20.6) [20.6,32.9) [32.9,88.0]
## Frequency           40          39          40          39
## Proportion       0.253       0.247       0.253       0.247
```

ì´ì œ ì´ì „ì— ìƒì„±í•œ êµ¬ê°„ê³¼ ë¹„êµí•´ ë³´ê² ìŠµë‹ˆë‹¤:


``` r
describe(d_stunt_grp$stunt_child_ef)
```

```
## d_stunt_grp$stunt_child_ef 
##        n  missing distinct 
##      154        0        4 
##                                                           
## Value      [ 1.3, 9.5) [ 9.5,20.8) [20.8,32.9) [32.9,59.3]
## Frequency           40          37          39          38
## Proportion       0.260       0.240       0.253       0.247
```


**ëª¨ë“  êµ¬ê°„ì´ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤!** ğŸ˜± ì´ë“¤ì€ ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ì´ê¸° ë•Œë¬¸ì—, ì˜ˆì¸¡ ëª¨ë¸ì€ ì´ë“¤ì„ ëª¨ë‘ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ì¸ì‹í•˜ì—¬ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•  ê²ƒì…ë‹ˆë‹¤.

í•´ê²°ì±…ì€ ë°ì´í„° ì¤€ë¹„ë¥¼ í•  ë•Œ ì ˆë‹¨ ì§€ì (cut points)ì„ ì €ì¥í•´ ë‘ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ëª¨ë¸ì„ ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©ì ì •ì˜ êµ¬ê°„ ì´ì‚°í™”ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ìƒˆë¡œìš´ ì‚¬ë¡€ê°€ ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ì— ê°•ì œë¡œ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì˜ˆì¸¡ ëª¨ë¸ì€ í•­ìƒ ë™ì¼í•œ ê²ƒì„ ë³´ê²Œ ë©ë‹ˆë‹¤.

í•´ê²°ì±…ì€ ë‹¤ìŒ ì„¹ì…˜ì— ìˆìŠµë‹ˆë‹¤.



### ìë™ ë°ì´í„° í”„ë ˆì„ ì´ì‚°í™” {#data-discretization}

`funModeling` íŒ¨í‚¤ì§€(ë²„ì „ 1.6.6 ì´ìƒ)ëŠ” ì´ì‚°í™” ì‘ì—…ì„ ë•ê¸° ìœ„í•´ ë‘ ê°€ì§€ í•¨ìˆ˜ì¸ `discretize_get_bins`ì™€ `discretize_df`ë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤.


``` r
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
# install.packages("funModeling")
library(funModeling)
library(dplyr)
```

ì˜ˆì‹œë¥¼ í•˜ë‚˜ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ë¨¼ì € í˜„ì¬ ë°ì´í„° ìœ í˜•ì„ í™•ì¸í•©ë‹ˆë‹¤.


``` r
df_status(heart_disease) %>% select(variable, type, unique, q_na) %>% arrange(type)
```

```
##                  variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1                     age       0    0.00    0 0.00     0     0 integer     41
## 2                  gender       0    0.00    0 0.00     0     0  factor      2
## 3              chest_pain       0    0.00    0 0.00     0     0  factor      4
## 4  resting_blood_pressure       0    0.00    0 0.00     0     0 integer     50
## 5       serum_cholestoral       0    0.00    0 0.00     0     0 integer    152
## 6     fasting_blood_sugar     258   85.15    0 0.00     0     0  factor      2
## 7         resting_electro     151   49.83    0 0.00     0     0  factor      3
## 8          max_heart_rate       0    0.00    0 0.00     0     0 integer     91
## 9             exer_angina     204   67.33    0 0.00     0     0 integer      2
## 10                oldpeak      99   32.67    0 0.00     0     0 numeric     40
## 11                  slope       0    0.00    0 0.00     0     0 integer      3
## 12      num_vessels_flour     176   58.09    4 1.32     0     0 integer      4
## 13                   thal       0    0.00    2 0.66     0     0  factor      3
## 14 heart_disease_severity     164   54.13    0 0.00     0     0 integer      5
## 15           exter_angina     204   67.33    0 0.00     0     0  factor      2
## 16      has_heart_disease       0    0.00    0 0.00     0     0  factor      2
```

```
##                  variable    type unique q_na
## 1                  gender  factor      2    0
## 2              chest_pain  factor      4    0
## 3     fasting_blood_sugar  factor      2    0
## 4         resting_electro  factor      3    0
## 5                    thal  factor      3    2
## 6            exter_angina  factor      2    0
## 7       has_heart_disease  factor      2    0
## 8                     age integer     41    0
## 9  resting_blood_pressure integer     50    0
## 10      serum_cholestoral integer    152    0
## 11         max_heart_rate integer     91    0
## 12            exer_angina integer      2    0
## 13                  slope integer      3    0
## 14      num_vessels_flour integer      4    4
## 15 heart_disease_severity integer      5    0
## 16                oldpeak numeric     40    0
```

íŒ©í„°(factor), ì •ìˆ˜(integer), ìˆ˜ì¹˜í˜•(numeric) ë³€ìˆ˜ë“¤ì´ ì„ì—¬ ìˆìŠµë‹ˆë‹¤! ë³€í™˜ì€ ë‘ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì²«ì§¸, ê° ì„¸ê·¸ë¨¼íŠ¸ê°€ ì‹œì‘ë˜ëŠ” ì ˆë‹¨ê°’ ë˜ëŠ” ì„ê³„ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ë‘˜ì§¸, í•´ë‹¹ ì„ê³„ê°’ì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.


ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” `max_heart_rate`ì™€ `oldpeak` ë‘ ë³€ìˆ˜ë¥¼ ì´ì‚°í™”í•  ê²ƒì…ë‹ˆë‹¤. ë˜í•œ ê²°ì¸¡ê°’ì— ëŒ€í•´ í•¨ìˆ˜ê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `oldpeak`ì— ëª‡ ê°€ì§€ `NA` ê°’ì„ ë„ì…í•˜ê² ìŠµë‹ˆë‹¤.



``` r
# creating a copy to keep original data clean
heart_disease_2=heart_disease

# Introducing some missing values in the first 30 rows of the oldpeak variable
heart_disease_2$oldpeak[1:30]=NA
```

1ë‹¨ê³„) ê° ì…ë ¥ ë³€ìˆ˜ì— ëŒ€í•´ êµ¬ê°„ ì„ê³„ê°’ ê°€ì ¸ì˜¤ê¸°:

`discretize_get_bins`ëŠ” `discretize_df` í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë  ë°ì´í„° í”„ë ˆì„ì„ ë°˜í™˜í•˜ë©°, ì´ í•¨ìˆ˜ëŠ” ìµœì¢… ì²˜ë¦¬ëœ ë°ì´í„° í”„ë ˆì„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.



``` r
d_bins=discretize_get_bins(data=heart_disease_2, input=c("max_heart_rate", "oldpeak"), n_bins=5)
```

```
## Variables processed: max_heart_rate, oldpeak
```

``` r
# `d_bins` ê°ì²´ í™•ì¸:
d_bins
```

```
##         variable                cuts
## 1 max_heart_rate 131|147|160|171|Inf
## 2        oldpeak   0.1|0.3|1.1|2|Inf
```
ë§¤ê°œë³€ìˆ˜: 

- `data`: ì²˜ë¦¬í•  ë³€ìˆ˜ê°€ í¬í•¨ëœ ë°ì´í„° í”„ë ˆì„.
- `input`: ë³€ìˆ˜ ì´ë¦„ì„ í¬í•¨í•˜ëŠ” ë¬¸ìì—´ ë²¡í„°.
- `n_bins`: ì´ì‚°í™”ëœ ë°ì´í„°ì—ì„œ ê°€ì§ˆ êµ¬ê°„/ì„¸ê·¸ë¨¼íŠ¸ì˜ ìˆ˜.

ê° ë³€ìˆ˜ì— ëŒ€í•œ ê° ì„ê³„ê°’ ì§€ì (ë˜ëŠ” ìƒí•œ ê²½ê³„)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì°¸ê³ **: ë²„ì „ 1.6.6ì—ì„œ 1.6.7ë¡œì˜ ë³€ê²½ ì‚¬í•­:

* `discretize_get_bins`ëŠ” í•´ë‹¹ ê°’ì´ í•­ìƒ ìµœì†Œê°’ìœ¼ë¡œ ê°„ì£¼ë˜ì—ˆê¸° ë•Œë¬¸ì— `-Inf` ì„ê³„ê°’ì„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* ë‹¨ì¼ ê°’ ì¹´í…Œê³ ë¦¬ëŠ” ì´ì œ ë²”ìœ„ë¡œ í‘œì‹œë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `"5"`ì˜€ë˜ ê²ƒì€ ì´ì œ `"[5, 6)"`ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
* ë²„í‚· í¬ë§·ì´ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ í•¨ìˆ˜ë¥¼ ìš´ì˜ í™˜ê²½ì—ì„œ ì‚¬ìš© ì¤‘ì´ì—ˆë‹¤ë©´ ìƒˆë¡œìš´ ê°’ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆ ì‹œê°„ì…ë‹ˆë‹¤!

2ë‹¨ê³„) ê° ë³€ìˆ˜ì— ì„ê³„ê°’ ì ìš©í•˜ê¸°:


``` r
# ì´ì œ ë™ì¼í•œ ë°ì´í„° í”„ë ˆì„ì´ë‚˜ ìƒˆë¡œìš´ ë°ì´í„° í”„ë ˆì„(ì˜ˆ: ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë°ì´í„°ê°€ ë³€í•˜ëŠ” 
# ì˜ˆì¸¡ ëª¨ë¸)ì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
heart_disease_discretized = 
  discretize_df(data=heart_disease_2, 
                data_bins=d_bins, 
                stringsAsFactors=T)
```

```
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## â„¹ Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

```
## Variables processed: max_heart_rate, oldpeak
```

ë§¤ê°œë³€ìˆ˜:

- `data`: ì´ì‚°í™”í•  ìˆ˜ì¹˜í˜• ë³€ìˆ˜ê°€ í¬í•¨ëœ ë°ì´í„° í”„ë ˆì„.
- `data_bins`: `discretize_get_bins`ê°€ ë°˜í™˜í•œ ë°ì´í„° í”„ë ˆì„. ì‚¬ìš©ìê°€ ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²½ìš°, ì˜ˆì œì— í‘œì‹œëœ ëŒ€ë¡œ ê° ìƒí•œ ê²½ê³„ëŠ” íŒŒì´í”„ ë¬¸ì(`|`)ë¡œ êµ¬ë¶„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- `stringsAsFactors`: ê¸°ë³¸ê°’ì€ `TRUE`ì´ë©°, ìµœì¢… ë³€ìˆ˜ëŠ” íŒ©í„°(ë¬¸ìì—´ ëŒ€ì‹ )ê°€ ë˜ì–´ ì‹œê°í™”í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.



#### ìµœì¢… ê²°ê³¼ ë° í”Œë¡¯

ë³€í™˜ ì „í›„:


```
##   max_heart_rate_before max_heart_rate_after oldpeak_before oldpeak_after
## 1                   171          [ 171, Inf]             NA           NA.
## 2                   114          [-Inf, 131)             NA           NA.
## 3                   151          [ 147, 160)            1.8   [ 1.1, 2.0)
## 4                   160          [ 160, 171)            1.4   [ 1.1, 2.0)
## 5                   158          [ 147, 160)            0.0   [-Inf, 0.1)
## 6                   161          [ 160, 171)            0.5   [ 0.3, 1.1)
```

ìµœì¢… ë¶„í¬:


``` r
freq(heart_disease_discretized %>% 
           select(max_heart_rate,oldpeak),
     plot = F)
```

```
##   max_heart_rate frequency percentage cumulative_perc
## 1    [-Inf, 131)        63      20.79           20.79
## 2    [ 147, 160)        62      20.46           41.25
## 3    [ 160, 171)        62      20.46           61.71
## 4    [ 131, 147)        59      19.47           81.18
## 5    [ 171, Inf]        57      18.81          100.00
## 
##       oldpeak frequency percentage cumulative_perc
## 1 [-Inf, 0.1)        97      32.01           32.01
## 2 [ 0.3, 1.1)        54      17.82           49.83
## 3 [ 1.1, 2.0)        54      17.82           67.65
## 4 [ 2.0, Inf]        50      16.50           84.15
## 5         NA.        30       9.90           94.05
## 6 [ 0.1, 0.3)        18       5.94          100.00
```

```
## [1] "Variables processed: max_heart_rate, oldpeak"
```

``` r
p5=ggplot(heart_disease_discretized, 
          aes(max_heart_rate)) + 
  geom_bar(fill="#0072B2") + 
  theme_bw() + 
  theme(axis.text.x = 
          element_text(angle = 45, vjust = 1, hjust=1)
        )

p6=ggplot(heart_disease_discretized, 
          aes(oldpeak)) + 
  geom_bar(fill="#CC79A7") +
  theme_bw() + 
  theme(axis.text.x = 
          element_text(angle = 45, vjust = 1, hjust=1)
        )

gridExtra::grid.arrange(p5, p6, ncol=2)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/binning-variable-1.png" alt="ìë™ ì´ì‚°í™” ê²°ê³¼" width="672"  />
<p class="caption">(\#fig:binning-variable)ìë™ ì´ì‚°í™” ê²°ê³¼</p>
</div>


**ë™ì¼ ë¹ˆë„**ë¥¼ ê³„ì‚°í•  ë•Œ `oldpeak` ë³€ìˆ˜ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ë²„í‚·ë‹¹ ë™ì¼í•œ ìˆ˜ì˜ ì‚¬ë¡€ë¥¼ ì–»ëŠ” ê²ƒì´ í•­ìƒ ê°€ëŠ¥í•œ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.

#### NA ì²˜ë¦¬

`NA` ê°’ê³¼ ê´€ë ¨í•˜ì—¬, ìƒˆë¡œìš´ `oldpeak` ë³€ìˆ˜ì—ëŠ” 6ê°œì˜ ì¹´í…Œê³ ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ì¦‰, `n_bins=5`ì—ì„œ ì •ì˜ëœ 5ê°œ ì¹´í…Œê³ ë¦¬ì™€ `NA.` ê°’ì…ë‹ˆë‹¤. ëì— ìˆëŠ” ì ì€ ê²°ì¸¡ê°’ì˜ ì¡´ì¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.


#### ì¶”ê°€ ì •ë³´

- `discretize_df`ëŠ” ê²°ì¸¡ê°’ì„ `NA.` ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì§€ ì•Šê³ ëŠ” ì ˆëŒ€ `NA`ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- `n_bins`ëŠ” ëª¨ë“  ë³€ìˆ˜ì— ëŒ€í•œ êµ¬ê°„ ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
- `input`ì´ ëˆ„ë½ëœ ê²½ìš°, ê³ ìœ  ê°’ì˜ ìˆ˜ê°€ êµ¬ê°„ ìˆ˜(`n_bins`)ë³´ë‹¤ í° ëª¨ë“  ìˆ˜ì¹˜í˜•/ì •ìˆ˜í˜• ë³€ìˆ˜ì— ëŒ€í•´ ì‹¤í–‰ë©ë‹ˆë‹¤. 
- `input`ì— ì •ì˜ëœ ë³€ìˆ˜ë§Œ ì²˜ë¦¬ë˜ë©° ë‚˜ë¨¸ì§€ ë³€ìˆ˜ëŠ” **ì „í˜€ ìˆ˜ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. 
- `discretize_get_bins`ëŠ” ë‹¨ì§€ ë°ì´í„° í”„ë ˆì„ì„ ë°˜í™˜í•˜ë¯€ë¡œ í…ìŠ¤íŠ¸ íŒŒì¼ì´ë‚˜ R ì„¸ì…˜ì—ì„œ í•„ìš”ì— ë”°ë¼ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



#### ìƒˆë¡œìš´ ë°ì´í„°ì—ì„œì˜ ì´ì‚°í™”

ìš°ë¦¬ ë°ì´í„°ì—ì„œ `max_heart_rate`ì˜ ìµœì†Œê°’ì€ 71ì…ë‹ˆë‹¤. ë°ì´í„° ì¤€ë¹„ ê³¼ì •ì€ ìƒˆë¡œìš´ ë°ì´í„°ì— ëŒ€í•´ ê²¬ê³ í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `max_heart_rate`ê°€ 68ì¸ ìƒˆë¡œìš´ í™˜ìê°€ ë“¤ì–´ì˜¤ë©´, í˜„ì¬ í”„ë¡œì„¸ìŠ¤ëŠ” ì´ í™˜ìë¥¼ ê°€ì¥ ë‚®ì€ ì¹´í…Œê³ ë¦¬ì— í• ë‹¹í•  ê²ƒì…ë‹ˆë‹¤.

ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì˜ ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œëŠ” ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ê¸° ë•Œë¬¸ì— `NA`ë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´ ìƒˆë¡œìš´ ìµœì†Œê°’ì´ë‚˜ ìµœëŒ€ê°’ì´ ë‚˜íƒ€ë‚  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ì´ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ë°©í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `discretize_df`ëŠ” í•­ìƒ `-Inf`/`Inf`ë¥¼ ìµœì†Œê°’/ìµœëŒ€ê°’ìœ¼ë¡œ ê°€ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ ìµœì†Œê°’ë³´ë‹¤ ë‚®ê±°ë‚˜ ìµœëŒ€ê°’ë³´ë‹¤ ë†’ì€ ìƒˆë¡œìš´ ê°’ì€ ê°ê° ê°€ì¥ ë‚®ê±°ë‚˜ ë†’ì€ ì„¸ê·¸ë¨¼íŠ¸ì— ì¶”ê°€ë©ë‹ˆë‹¤.

`discretize_get_bins`ê°€ ë°˜í™˜í•œ ë°ì´í„° í”„ë ˆì„ì€ ìƒˆë¡œìš´ ë°ì´í„°ì— ì ìš©í•˜ê¸° ìœ„í•´ ì €ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ ì´ì‚°í™” ê³¼ì •ì´ ìƒˆë¡œìš´ ë°ì´í„°ì™€ í•¨ê»˜ ì‹¤í–‰ë  ì˜ë„ê°€ ì—†ë‹¤ë©´, ë‘ ê°œì˜ í•¨ìˆ˜ë¥¼ ê°€ì§ˆ ì´ìœ ê°€ ì—†ìœ¼ë©° í•˜ë‚˜ë©´ ì¶©ë¶„í•  ê²ƒì…ë‹ˆë‹¤. ë˜í•œ `discretize_get_bins`ì˜ ê²°ê³¼ë¥¼ ì €ì¥í•  í•„ìš”ë„ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ 2ë‹¨ê³„ ì ‘ê·¼ ë°©ì‹ì„ í†µí•´ ë‘ ê°€ì§€ ê²½ìš°ë¥¼ ëª¨ë‘ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### 2ë‹¨ê³„ ì´ì‚°í™”ì— ëŒ€í•œ ê²°ë¡ 

`discretize_get_bins` + `discretize_df`ì˜ ì‚¬ìš©ì€ ë°”ë¡œ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ëœ ê¹¨ë—í•œ ë°ì´í„° í”„ë ˆì„ì„ í†µí•´ ë¹ ë¥¸ ë°ì´í„° ì¤€ë¹„ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê° ì„¸ê·¸ë¨¼íŠ¸ê°€ ì–´ë””ì„œ ì‹œì‘í•˜ê³  ëë‚˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ë³´ì—¬ì£¼ë©°, í†µê³„ ë³´ê³ ì„œë¥¼ ì‘ì„±í•  ë•Œ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ìƒˆë¡œìš´ ë°ì´í„°ì—ì„œ ìƒˆë¡œìš´ ìµœì†Œê°’/ìµœëŒ€ê°’ì„ ëŒ€í•  ë•Œ _ì‹¤íŒ¨í•˜ì§€ ì•Šê¸°ë¡œ_ ê²°ì •í•œ ê²ƒì€ **ë‹¨ìˆœí•œ ê²°ì •**ì¼ ë¿ì…ë‹ˆë‹¤. ì–´ë–¤ ë¬¸ë§¥ì—ì„œëŠ” ì‹¤íŒ¨í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•œ í–‰ë™ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ì¸ê°„ì˜ ê°œì…**: ë°ì´í„° í”„ë ˆì„ì„ ì´ì‚°í™”í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ ì˜ˆì œì—ì„œ ë³¸ ê²ƒì²˜ëŸ¼ ëª¨ë“  ë³€ìˆ˜ì— ë™ì¼í•œ ìˆ˜ì˜ êµ¬ê°„ì„ ì ìš©í•˜ëŠ” ê²ƒì´ì§€ë§Œ, íŠœë‹ì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ì¼ë¶€ ë³€ìˆ˜ì— **ë‹¤ë¥¸ ìˆ˜ì˜ êµ¬ê°„**ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¶„ì‚°ì´ ì ì€ ë³€ìˆ˜ëŠ” ì ì€ ìˆ˜ì˜ êµ¬ê°„ìœ¼ë¡œë„ ì˜ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì„¸ê·¸ë¨¼íŠ¸ ìˆ˜ì˜ ì¼ë°˜ì ì¸ ê°’ì€ 3, 5, 10 ë˜ëŠ” 20(ê·¸ ì´ìƒì€ ì•„ë‹˜)ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²°ì •ì€ ë°ì´í„° ê³¼í•™ìì˜ ëª«ì…ë‹ˆë‹¤.


#### ë³´ë„ˆìŠ¤ íŠ¸ë™: íŠ¸ë ˆì´ë“œì˜¤í”„ì˜ ì˜ˆìˆ  âš–ï¸

- ë§ì€ ìˆ˜ì˜ êµ¬ê°„ => ë” ë§ì€ ë…¸ì´ì¦ˆ í¬ì°©.
- ì ì€ ìˆ˜ì˜ êµ¬ê°„ => ê³¼ë„í•œ ë‹¨ìˆœí™”, ë³€ë™ì„± ê°ì†Œ.

ì´ ìš©ì–´ë“¤ì´ ë¨¸ì‹ ëŸ¬ë‹ì˜ ë‹¤ë¥¸ ìš©ì–´ë“¤ê³¼ ë¹„ìŠ·í•˜ê²Œ ë“¤ë¦¬ë‚˜ìš”?

ì •ë‹µì€: **ë„¤!** ì…ë‹ˆë‹¤. ë‹¨ í•œ ê°€ì§€ ì˜ˆë§Œ ë“¤ìë©´, ì˜ˆì¸¡ ëª¨ë¸ì—ì„œ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì œê±°í•˜ëŠ” ì‚¬ì´ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ì™€ ê°™ìŠµë‹ˆë‹¤.

- ë” ë§ì€ ë³€ìˆ˜: ê³¼ì í•©(overfitting) ê²½ê³  (ë„ˆë¬´ ìƒì„¸í•œ ì˜ˆì¸¡ ëª¨ë¸).
- ë” ì ì€ ë³€ìˆ˜: ê³¼ì†Œì í•©(underfitting) ìœ„í—˜ (ì¼ë°˜ì ì¸ íŒ¨í„´ì„ í¬ì°©í•˜ê¸°ì— ì •ë³´ ë¶€ì¡±).

_ìˆ˜ì²œ ë…„ ë™ì•ˆ ë™ì–‘ ì² í•™ì´ ì§€ì í•´ ì™”ë“¯ì´, í•˜ë‚˜ì˜ ê°€ì¹˜ì™€ ê·¸ ë°˜ëŒ€ ì‚¬ì´ì—ì„œ ì˜¬ë°”ë¥¸ ê· í˜•ì„ ì°¾ëŠ” ê²ƒì€ í•˜ë‚˜ì˜ ì˜ˆìˆ ì…ë‹ˆë‹¤._



### ìµœì¢… ìƒê°

ë³´ì•˜ë“¯ì´, ì´ì‚°í™”ë‚˜ ë°ì´í„° ì¤€ë¹„ì— ìˆì–´ **ê³µì§œ ì ì‹¬ì€ ì—†ìŠµë‹ˆë‹¤**. _ìë™í™”ëœ ì‹œìŠ¤í…œì´ë‚˜ ì§€ëŠ¥í˜• ì‹œìŠ¤í…œ_ì´ ì¸ê°„ì˜ ê°œì…ì´ë‚˜ ë¶„ì„ ì—†ì´ ì´ëŸ¬í•œ ëª¨ë“  ìƒí™©ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì´ë¼ ìƒê°í•˜ë‚˜ìš”?

ë¬¼ë¡  ì¼ë¶€ ì‘ì—…ì€ ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ì— ìœ„ì„í•  ìˆ˜ ìˆì§€ë§Œ, ì²˜ë¦¬í•  ì˜¬ë°”ë¥¸ ì…ë ¥ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” **ë°ì´í„° ì¤€ë¹„ ë‹¨ê³„ì—ì„œ ì¸ê°„ì€ í•„ìˆ˜ì **ì…ë‹ˆë‹¤.

ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë‘ ê°€ì§€ ë°ì´í„° ìœ í˜•ì¸ ë²”ì£¼í˜• ë˜ëŠ” ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì€ ë°ì´í„°ì˜ ì„±ê²©ê³¼ ì„ íƒëœ ì•Œê³ ë¦¬ì¦˜(ì¼ë¶€ëŠ” í•œ ê°€ì§€ ë°ì´í„° ìœ í˜•ë§Œ ì§€ì›)ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

ì´ ë³€í™˜ì€ ë¶„ì„ì— **ì•½ê°„ì˜ í¸í–¥ì„ ë„ì…**í•©ë‹ˆë‹¤. ê²°ì¸¡ê°’ì„ ë‹¤ë£° ë•Œë„ ë¹„ìŠ·í•œ ì‚¬ë¡€ê°€ ìˆìŠµë‹ˆë‹¤: [ê²°ì¸¡ ë°ì´í„°ì˜ ì²˜ë¦¬ ë° ëŒ€ì¹˜](#missing_data).

ë²”ì£¼í˜• ë³€ìˆ˜ë¡œ ì‘ì—…í•  ë•Œ, íƒ€ê²Ÿ ë³€ìˆ˜ì— ë”°ë¼ ì¹´í…Œê³ ë¦¬ë¥¼ ì¬ë°°ì¹˜í•˜ì—¬ **ê´€ê³„ë¥¼ ë” ì˜ ë“œëŸ¬ë‚´ë„ë¡** ë¶„í¬ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹„ì„ í˜• ë³€ìˆ˜ ê´€ê³„ë¥¼ ì„ í˜• ê´€ê³„ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ì£ .
 

### ë³´ë„ˆìŠ¤ íŠ¸ë™ ğŸ’¥

ì´ì‚°í™” ë³€ìˆ˜ ì„¹ì…˜ìœ¼ë¡œ ëŒì•„ê°€ì„œ ì§€ê¸ˆê¹Œì§€ ì‚´í´ë³¸ ëª¨ë“  ë³€í™˜ì„ í”Œë¡¯í•´ ë³´ê² ìŠµë‹ˆë‹¤.


``` r
grid.arrange(p2, p3, p4, ncol = 3)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/discretization-methods-1.png" alt="ë™ì¼í•œ ë°ì´í„°, ë‹¤ë¥¸ ì‹œê°í™”" width="864"  />
<p class="caption">(\#fig:discretization-methods)ë™ì¼í•œ ë°ì´í„°, ë‹¤ë¥¸ ì‹œê°í™”</p>
</div>

ì…ë ¥ ë°ì´í„°ëŠ” í•­ìƒ ë™ì¼í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ëª¨ë“  ë°©ë²•ì€ **ë™ì¼í•œ ê²ƒì— ëŒ€í•´ ë‹¤ë¥¸ ê´€ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤**.

**ì˜ˆì¸¡ ëª¨ë¸ë§**ì„ ìœ„í•œ **ë™ì¼ ë¹ˆë„** ì‚¬ìš©ê³¼ ê°™ì´ íŠ¹ì • ìƒí™©ì— ë” ì í•©í•œ ê´€ì ë“¤ì´ ìˆìŠµë‹ˆë‹¤.

ì´ ì‚¬ë¡€ëŠ” í•˜ë‚˜ì˜ ë³€ìˆ˜ë§Œ ê³ ë ¤í•˜ê³  ìˆì§€ë§Œ, ì—¬ëŸ¬ ë³€ìˆ˜ë¥¼ ë™ì‹œì— ê°€ì§„ ê²½ìš°, ì¦‰ `N-ì°¨ì›` ê³µê°„ì—ì„œë„ ë…¼ë¦¬ëŠ” ë™ì¼í•©ë‹ˆë‹¤.

ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•  ë•Œ, ì‚¬ëŒë“¤ì´ ì–´ë–¤ ëŒ€ìƒì— ëŒ€í•´ ì˜ê²¬ì„ ë‚´ëŠ” ê²ƒê³¼ ê°™ì´ ë™ì¼í•œ ì ì˜ ë¬´ë¦¬ë¥¼ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.





![](introduction/spacer_bar.png)<!-- -->




## ê¸°ìˆ  í†µê³„ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜ {#high_cardinality_descriptive_stats}
  
### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?
  
**ê³ ì¹´ë””ë„ë¦¬í‹°(high cardinality)** ë³€ìˆ˜ëŠ” ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê°’ì´ _ë§¤ìš° ë§ì€_ ë³€ìˆ˜ë¥¼ ë§í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ êµ­ê°€(country)ê°€ ìˆìŠµë‹ˆë‹¤.

ì´ ì¥ì—ì„œëŠ” íŒŒë ˆí†  ë²•ì¹™(Pareto rule)ì— ê¸°ë°˜í•œ ì¹´ë””ë„ë¦¬í‹° ê°ì†Œë¥¼ ë‹¤ë£¨ë©°, ëŒ€ë¶€ë¶„ì˜ ê°’ì´ ì–´ë””ì— ì§‘ì¤‘ë˜ì–´ ìˆëŠ”ì§€ì™€ ë³€ìˆ˜ ë¶„í¬ë¥¼ ë¹ ë¥´ê²Œ ë³´ì—¬ì£¼ëŠ” `freq` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
 

### ê¸°ìˆ  í†µê³„ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹°

ë‹¤ìŒ ì˜ˆì œëŠ” `person`, `country`, `has_flu`ë¼ëŠ” 3ê°œì˜ ì—´ì„ ê°€ì§„ 910ê°œ ì‚¬ë¡€ì˜ ì„¤ë¬¸ì¡°ì‚¬ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. `has_flu`ëŠ” ì§€ë‚œ ë‹¬ì— í•´ë‹¹ ì§ˆë³‘ì„ ì•“ì•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.


``` r
library(funModeling) 
```

`data_country` ë°ì´í„°ëŠ” `funModeling` íŒ¨í‚¤ì§€(ë²„ì „ 1.6 ì´ìƒ)ì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

`data_country`ì˜ ë¹ ë¥¸ í”„ë¡œíŒŒì¼ë§ (ì²˜ìŒ 10í–‰)


``` r
# ì²˜ìŒ 10í–‰ ì¶œë ¥
head(data_country, 10)
```

```
##     person     country has_flu
## 478    478      France      no
## 990    990      Brazil      no
## 606    606      France      no
## 575    575 Philippines      no
## 806    806      France      no
## 232    232      France      no
## 422    422      Poland      no
## 347    347     Romania      no
## 858    858     Finland      no
## 704    704      France      no
```

``` r
# ë°ì´í„° íƒìƒ‰, ì²˜ìŒ 10í–‰ë§Œ í‘œì‹œ
head(freq(data_country, "country"), 10)
```

```
## Warning: The `<scale>` argument of `guides()` cannot be `FALSE`. Use "none" instead as
## of ggplot2 3.3.4.
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-nominal-variable-1.png" alt="êµ­ê°€ ë¹ˆë„ ë¶„ì„" width="1500"  />
<p class="caption">(\#fig:data-preparation-nominal-variable)êµ­ê°€ ë¹ˆë„ ë¶„ì„</p>
</div>

```
##           country frequency percentage cumulative_perc
## 1          France       288      31.65           31.65
## 2          Turkey        67       7.36           39.01
## 3           China        65       7.14           46.15
## 4         Uruguay        63       6.92           53.07
## 5  United Kingdom        45       4.95           58.02
## 6       Australia        41       4.51           62.53
## 7         Germany        30       3.30           65.83
## 8          Canada        19       2.09           67.92
## 9     Netherlands        19       2.09           70.01
## 10          Japan        18       1.98           71.99
```


``` r
# ë°ì´í„° íƒìƒ‰
freq(data_country, "has_flu")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-nominal-variable-2-1.png" alt="ë…ê° ë°œìƒ ì—¬ë¶€ ë¹ˆë„ ë¶„ì„" width="480"  />
<p class="caption">(\#fig:data-preparation-nominal-variable-2)ë…ê° ë°œìƒ ì—¬ë¶€ ë¹ˆë„ ë¶„ì„</p>
</div>

```
##   has_flu frequency percentage cumulative_perc
## 1      no       827      90.88           90.88
## 2     yes        83       9.12          100.00
```


ë§ˆì§€ë§‰ í…Œì´ë¸”ì€ `has_flu="yes"`ì¸ í–‰ì´ 83ê°œë¿ì„ì„ ë³´ì—¬ì£¼ë©°, ì´ëŠ” ì „ì²´ ì¸ì›ì˜ ì•½ 9%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ë“¤ ì¤‘ ë‹¤ìˆ˜ëŠ” ë°ì´í„°ì—ì„œ ê±°ì˜ ë¹„ì¤‘ì„ ì°¨ì§€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ê²ƒì´ _ë¡± í…Œì¼(long tail)_ í˜„ìƒì´ë©°, ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ ë°ì´í„° ê³µìœ ì˜ ë†’ì€ ë¹„ìœ¨(ì˜ˆ: 70, 80 ë˜ëŠ” 90%)ì„ ì°¨ì§€í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë“¤ë§Œ ìœ ì§€í•˜ëŠ” íŒŒë ˆí†  ë²•ì¹™ì„ ì ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


``` r
# 'funModeling' íŒ¨í‚¤ì§€ì˜ 'freq' í•¨ìˆ˜ëŠ” ì ˆë‹¨ ì§€ì ì„ ì„¤ì •í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ëˆ„ì  ë°±ë¶„ìœ¨(cumulative_percentage)ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. 
country_freq = freq(data_country, 'country', plot = F)

# 'country_freq'ëŠ” ë¹ˆë„ì— ë”°ë¼ ì •ë ¬ëœ í…Œì´ë¸”ì´ë¯€ë¡œ, ê°€ì¥ ë†’ì€ ë¹„ì¤‘ì„ ì°¨ì§€í•˜ëŠ” ì²˜ìŒ 10ê°œ í–‰ì„ ì‚´í´ë´…ì‹œë‹¤.
country_freq %>% slice_head(n = 10)
```

```
##           country frequency percentage cumulative_perc
## 1          France       288      31.65           31.65
## 2          Turkey        67       7.36           39.01
## 3           China        65       7.14           46.15
## 4         Uruguay        63       6.92           53.07
## 5  United Kingdom        45       4.95           58.02
## 6       Australia        41       4.51           62.53
## 7         Germany        30       3.30           65.83
## 8          Canada        19       2.09           67.92
## 9     Netherlands        19       2.09           70.01
## 10          Japan        18       1.98           71.99
```


ë”°ë¼ì„œ 10ê°œ êµ­ê°€ê°€ ì‚¬ë¡€ì˜ 70% ì´ìƒì„ ëŒ€í‘œí•©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ì‚¬ë¡€ë“¤ì— `other` ì¹´í…Œê³ ë¦¬ë¥¼ í• ë‹¹í•˜ê³  í”Œë¡¯ì„ ê·¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
data_country$country_2 = ifelse(data_country$country %in% pull(country_freq[1:10, ], country), data_country$country, 'other')
freq(data_country, 'country_2')
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-profiling-nominal-variable-2-1.png" alt="ìˆ˜ì •ëœ êµ­ê°€ ë³€ìˆ˜ - ë¹ˆë„ ë¶„ì„" width="403.2"  />
<p class="caption">(\#fig:data-preparation-profiling-nominal-variable-2)ìˆ˜ì •ëœ êµ­ê°€ ë³€ìˆ˜ - ë¹ˆë„ ë¶„ì„</p>
</div>

```
##         country_2 frequency percentage cumulative_perc
## 1          France       288      31.65           31.65
## 2           other       255      28.02           59.67
## 3          Turkey        67       7.36           67.03
## 4           China        65       7.14           74.17
## 5         Uruguay        63       6.92           81.09
## 6  United Kingdom        45       4.95           86.04
## 7       Australia        41       4.51           90.55
## 8         Germany        30       3.30           93.85
## 9          Canada        19       2.09           95.94
## 10    Netherlands        19       2.09           98.03
## 11          Japan        18       1.98          100.00
```


### ìµœì¢… ì½”ë©˜íŠ¸

ëŒ€í‘œì„±ì´ ë‚®ì€ ì¹´í…Œê³ ë¦¬ëŠ” ê°€ë” `Egypt`, `Eggypt.`ì™€ ê°™ì´ ë°ì´í„° ì˜¤ë¥˜ì¸ ê²½ìš°ê°€ ìˆìœ¼ë©°, ì´ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë‚˜ìœ ìŠµê´€ì´ë‚˜ ì†ŒìŠ¤ì—ì„œ ìˆ˜ì§‘í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜¤ë¥˜ì˜ ì¦ê±°ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°ì´í„°ë¥¼ ì¶•ì†Œí•˜ëŠ” ì¼ë°˜ì ì¸ ê·œì¹™ì€ ì—†ìœ¼ë©°, ê° ì‚¬ë¡€ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.


**ë‹¤ìŒ ê¶Œì¥ ì¥:** [ì˜ˆì¸¡ ëª¨ë¸ë§ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜](#high_cardinality_predictive_modeling).



![](introduction/spacer_bar.png)<!-- -->



## High Cardinality Variable in Predictive Modeling {#high_cardinality_predictive_modeling}

### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?

ì§€ë‚œ ì¥ì¸ [ê¸°ìˆ  í†µê³„ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹°](#high_cardinality_descriptive_stats)ì—ì„œ ë³´ì•˜ë“¯ì´, ìš°ë¦¬ëŠ” ì£¼ìš” ëŒ€í‘œì„±ì„ ê°€ì§„ ì¹´í…Œê³ ë¦¬ë“¤ë§Œ ìœ ì§€í•˜ì§€ë§Œ, ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆì¸¡í•  ë‹¤ë¥¸ ë³€ìˆ˜ê°€ ìˆë‹¤ë©´ ì–´ë–¨ê¹Œìš”? ì¦‰, `country`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `has_flu`ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì´ì „ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ë³€ìˆ˜ì˜ ì •ë³´ê°€ íŒŒê´´ë˜ì–´ **ì˜ˆì¸¡ë ¥ì„ ìƒê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ ì¥ì—ì„œëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ë°©ë²•ì„ ë” ë°œì „ì‹œì¼œ, ìë™ ê·¸ë£¹í™” í•¨ìˆ˜ì¸ `auto_grouping`ì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ì˜ êµ¬ì¡°ë¥¼ íƒìƒ‰í•˜ê³  ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì•„ì´ë””ì–´ë¥¼ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë” ì¤‘ìš”í•œ ê²ƒì€ ë…ìê°€ ìì‹ ë§Œì˜ ìµœì í™”ë¥¼ ìˆ˜í–‰í•˜ë„ë¡ ì¥ë ¤í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë‹¤ë¥¸ ë¬¸í—Œì—ì„œëŠ” ì´ëŸ¬í•œ ì¬ê·¸ë£¹í™”ë¥¼ ì¹´ë””ë„ë¦¬í‹° ê°ì†Œ ë˜ëŠ” **ì¸ì½”ë”©(encoding)**ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.


**ì´ ì¥ì—ì„œ ë¬´ì—‡ì„ ê²€í† í• ê¹Œìš”?**

* ë°ì´í„° ëŒ€í‘œì„±ì˜ ê°œë… (ìƒ˜í”Œ í¬ê¸°).
* íƒ€ê²Ÿ ë˜ëŠ” ê²°ê³¼ ë³€ìˆ˜ê°€ ìˆëŠ” ìƒ˜í”Œ í¬ê¸°.
* Rì—ì„œ: ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ê³  ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ í”„ë¡œíŒŒì¼ë§í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ë°©ë²• ì œì‹œ.
* ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì¸ ì „í›„ì˜ ì‹¤ìš©ì ì¸ ì‚¬ë¡€ì™€ ì¸ì‚¬ì´íŠ¸ ì¶”ì¶œ.
* ëœë¤ í¬ë ˆìŠ¤íŠ¸ë‚˜ ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹ ê³¼ ê°™ì€ ë‹¤ì–‘í•œ ëª¨ë¸ì´ ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•.


### í•˜ì§€ë§Œ ë³€ìˆ˜ë¥¼ ì¬ê·¸ë£¹í™”í•˜ëŠ” ê²ƒì´ í•„ìš”í• ê¹Œìš”?

ì‚¬ë¡€ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ ê°€ì¥ ë¹ ë¥¸ ëŒ€ë‹µì€ "ì˜ˆ"ì…ë‹ˆë‹¤. ì´ ì¥ì—ì„œ ìš°ë¦¬ëŠ” ì´ëŸ¬í•œ ë°ì´í„° ì¤€ë¹„ê°€ ì „ì²´ ì •í™•ë„(ROC ê³¡ì„  ì•„ë˜ ë©´ì ìœ¼ë¡œ ì¸¡ì •)ë¥¼ ë†’ì´ëŠ” í•œ ì‚¬ë¡€ë¥¼ ë³´ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

**ë°ì´í„°ì˜ í‘œí˜„ë ¥**(ê° ì¹´í…Œê³ ë¦¬ê°€ ê°€ì§„ í–‰ì˜ ìˆ˜)ê³¼ ê° ì¹´í…Œê³ ë¦¬ê°€ ê²°ê³¼ ë³€ìˆ˜ì™€ ì–¼ë§ˆë‚˜ ê´€ë ¨ì´ ìˆëŠ”ì§€ ì‚¬ì´ì—ëŠ” íŠ¸ë ˆì´ë“œì˜¤í”„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì˜ˆ: ì¼ë¶€ êµ­ê°€ëŠ” ë‹¤ë¥¸ êµ­ê°€ë³´ë‹¤ ë…ê° ì‚¬ë¡€ì— ë” ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
# ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” funModeling >=1.6ì„ ë¡œë“œí•©ë‹ˆë‹¤. 
library(funModeling)
library(dplyr)
```

`funModeling` íŒ¨í‚¤ì§€ì— í¬í•¨ëœ `data_country`ë¥¼ í”„ë¡œíŒŒì¼ë§í•©ë‹ˆë‹¤ (ë²„ì „ 1.6.5 ì´ìƒìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”).

`data_country`ì˜ ë¹ ë¥¸ í”„ë¡œíŒŒì¼ë§ (ì²˜ìŒ 10í–‰)


``` r
# ì²˜ìŒ 10í–‰ ì¶œë ¥
head(data_country, 10)
```

```
##     person     country has_flu country_2
## 478    478      France      no    France
## 990    990      Brazil      no     other
## 606    606      France      no    France
## 575    575 Philippines      no     other
## 806    806      France      no    France
## 232    232      France      no    France
## 422    422      Poland      no     other
## 347    347     Romania      no     other
## 858    858     Finland      no     other
## 704    704      France      no    France
```

``` r
# ë°ì´í„° íƒìƒ‰, ì²˜ìŒ 10í–‰ë§Œ í‘œì‹œ
head(freq(data_country, "country"), 10)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/high-cardinality-variable-1.png" alt="ì²˜ìŒ 10ê°œ êµ­ê°€" width="1200"  />
<p class="caption">(\#fig:high-cardinality-variable)ì²˜ìŒ 10ê°œ êµ­ê°€</p>
</div>

```
##           country frequency percentage cumulative_perc
## 1          France       288      31.65           31.65
## 2          Turkey        67       7.36           39.01
## 3           China        65       7.14           46.15
## 4         Uruguay        63       6.92           53.07
## 5  United Kingdom        45       4.95           58.02
## 6       Australia        41       4.51           62.53
## 7         Germany        30       3.30           65.83
## 8          Canada        19       2.09           67.92
## 9     Netherlands        19       2.09           70.01
## 10          Japan        18       1.98           71.99
```


``` r
# ë°ì´í„° íƒìƒ‰
freq(data_country, "has_flu")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-high-cardinality-variable-1.png" alt="ë…ê° ë¶„í¬" width="508.8"  />
<p class="caption">(\#fig:data-preparation-high-cardinality-variable)ë…ê° ë¶„í¬</p>
</div>

```
##   has_flu frequency percentage cumulative_perc
## 1      no       827      90.88           90.88
## 2     yes        83       9.12          100.00
```



### ì‚¬ë¡€ ğŸ” {#analyze-binary-outcome-vs-categorical-variable}

ì˜ˆì¸¡ ëª¨ë¸ì€ íŠ¹ì • ê°’ì„ íŠ¹ì • ê²°ê³¼ì™€ ë§¤í•‘í•˜ë ¤ê³  ì‹œë„í•  ê²ƒì´ë©°, ìš°ë¦¬ì˜ ê²½ìš° íƒ€ê²Ÿ ë³€ìˆ˜ëŠ” ì´ì§„í˜•ì…ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” `categ_analysis`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íƒ€ê²Ÿ ë³€ìˆ˜ `has_flu`ì— ëŒ€í•œ `country`ì˜ ì™„ì „í•œ í”„ë¡œíŒŒì¼ë§ì„ ê³„ì‚°í•  ê²ƒì…ë‹ˆë‹¤.

ê° í–‰ì€ `input` ë³€ìˆ˜ì˜ ê³ ìœ í•œ ì¹´í…Œê³ ë¦¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê° í–‰ ë‚´ì—ì„œ ëŒ€í‘œì„±ê³¼ ê°€ëŠ¥ì„± ì¸¡ë©´ì—ì„œ ê° ì¹´í…Œê³ ë¦¬ë¥¼ ì •ì˜í•˜ëŠ” ì†ì„±ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



``` r
# `categ_analysis`ëŠ” "funModeling" >= v1.6ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš© ì „ ì„¤ì¹˜í•´ ì£¼ì„¸ìš”.
country_profiling=categ_analysis(data=data_country, input="country", target = "has_flu")
```

```
## Warning: `summarise_()` was deprecated in dplyr 0.7.0.
## â„¹ Please use `summarise()` instead.
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

```
## Warning: `group_by_()` was deprecated in dplyr 0.7.0.
## â„¹ Please use `group_by()` instead.
## â„¹ See vignette('programming') for more help
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

``` r
# 70ê°œ êµ­ê°€ ì¤‘ ì²˜ìŒ 15ê°œ í–‰(êµ­ê°€) ì¶œë ¥.
head(country_profiling, 15)
```


<div class="figure">
<img src="data_preparation/country_profiling.png" alt="íƒ€ê²Ÿ vs. ì…ë ¥ ë¶„ì„" width="75%"  />
<p class="caption">(\#fig:data-preparation-in-predictivemodeling)íƒ€ê²Ÿ vs. ì…ë ¥ ë¶„ì„</p>
</div>



* ì°¸ê³  1: _ì²« ë²ˆì§¸ ì—´ì˜ ì´ë¦„ì€ `input` ë³€ìˆ˜ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì¡°ì •ë©ë‹ˆë‹¤._
* ì°¸ê³  2: _`has_flu` ë³€ìˆ˜ëŠ” `yes`ì™€ `no` ê°’ì„ ê°€ì§‘ë‹ˆë‹¤. `categ_analysis`ëŠ” í‰ê· , í•©ê³„ ë° ë°±ë¶„ìœ¨ì„ ê³„ì‚°í•˜ê¸° ìœ„í•´ ëŒ€í‘œì„±ì´ ë‚®ì€ í´ë˜ìŠ¤(ì´ ê²½ìš° `yes`)ì— ë‚´ë¶€ì ìœ¼ë¡œ ìˆ«ì **1**ì„ í• ë‹¹í•©ë‹ˆë‹¤._

ì´ë“¤ì€ `categ_analysis`ê°€ ë°˜í™˜í•˜ëŠ” ì§€í‘œë“¤ì…ë‹ˆë‹¤:

* `country`: `input` ë³€ìˆ˜ì˜ ê° ì¹´í…Œê³ ë¦¬ ì´ë¦„.
* `mean_target`: `sum_target / q_rows`, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ `has_flu="yes"`ì˜ í‰ê·  ìˆ˜. ì´ê²ƒì´ ê°€ëŠ¥ì„±(likelihood)ì…ë‹ˆë‹¤.
* `sum_target`: ê° ì¹´í…Œê³ ë¦¬ì— ìˆëŠ” `has_flu="yes"` ê°’ì˜ ìˆ˜ëŸ‰.
* `perc_target`: `sum_target`ê³¼ ë™ì¼í•˜ì§€ë§Œ ë°±ë¶„ìœ¨ë¡œ í‘œì‹œë©ë‹ˆë‹¤. `ê° ì¹´í…Œê³ ë¦¬ì˜ sum_target / ì „ì²´ sum_target`. ì´ ì—´ì˜ í•©ì€ `1.00`ì…ë‹ˆë‹¤.
* `q_rows`: `has_flu` ë³€ìˆ˜ì™€ ê´€ê³„ì—†ì´ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•œ í–‰ì˜ ìˆ˜ëŸ‰. `input`ì˜ ë¶„í¬ì…ë‹ˆë‹¤. ì´ ì—´ì˜ í•©ì€ ë¶„ì„ëœ ì „ì²´ í–‰ ìˆ˜ì…ë‹ˆë‹¤.
* `perc_rows`: `q_rows`ì™€ ê´€ë ¨ë˜ì–´ ê° ì¹´í…Œê³ ë¦¬ì˜ ì ìœ ìœ¨ ë˜ëŠ” ë°±ë¶„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ì—´ì˜ í•©ì€ `1.00`ì…ë‹ˆë‹¤.


#### ì—¬ê¸°ì„œ ì–´ë–¤ ê²°ë¡ ì„ ë‚´ë¦´ ìˆ˜ ìˆì„ê¹Œìš”?

ì²« ë²ˆì§¸ `France` í–‰ì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆì œë¥¼ ì½ì–´ë´…ì‹œë‹¤:

* 41ëª…ì´ ë…ê°ì— ê±¸ë ¸ìŠµë‹ˆë‹¤ (`sum_target=41`). ì´ 41ëª…ì€ ë…ê°ì— ê±¸ë¦° ì „ì²´ ì¸ì›ì˜ ê±°ì˜ 50%ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ (`perc_target=0.494`).
* í”„ë‘ìŠ¤ì—ì„œ ë…ê°ì— ê±¸ë¦´ í™•ë¥ ì€ 14.2%ì…ë‹ˆë‹¤ (`mean_target=0.142`).
* í”„ë‘ìŠ¤ì˜ ì „ì²´ í–‰ = 288ê°œ (910ê°œ ì¤‘). ì´ê²ƒì´ `q_rows` ë³€ìˆ˜ì´ë©°, `perc_rows`ëŠ” ë™ì¼í•œ ìˆ˜ì¹˜ë¥¼ ë°±ë¶„ìœ¨ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì…ë‹ˆë‹¤.

êµ­ê°€ë³„ í•„í„°ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒì„ ì–»ìŠµë‹ˆë‹¤:

* `sum_target` ì—´ì˜ í•©ì€ ë°ì´í„°ì— ìˆëŠ” ë…ê° í™˜ìì˜ ì´í•©ì…ë‹ˆë‹¤.
* `perc_target` ì—´ì˜ í•©ì€ `1.00` ë˜ëŠ” 100%ì…ë‹ˆë‹¤.
* `q_rows` ì—´ì˜ í•©ì€ `data_country` ë°ì´í„° í”„ë ˆì„ì— ìˆëŠ” ì´ í–‰ ìˆ˜ì…ë‹ˆë‹¤.
* `perc_rows` ì—´ì˜ í•©ì€ `1.00` ë˜ëŠ” 100%ì…ë‹ˆë‹¤.



### ì˜ˆì¸¡ ëª¨ë¸ë§ì„ ìœ„í•œ ë¶„ì„ ğŸ”®

ì˜ˆì¸¡ ëª¨ë¸ì„ ê°œë°œí•  ë•Œ, ìš°ë¦¬ëŠ” íŠ¹ì • ì´ë²¤íŠ¸ì˜ ê°€ëŠ¥ì„±ì„ ë†’ì´ëŠ” ê°’ë“¤ì— ê´€ì‹¬ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ì˜ ê²½ìš°:

**ë…ê° í™˜ìë¥¼ ì°¾ì„ ê°€ëŠ¥ì„±ì„ ìµœëŒ€í™”í•˜ëŠ” êµ­ê°€ëŠ” ì–´ë””ì¸ê°€ìš”?**

ì‰½ìŠµë‹ˆë‹¤. `country_profiling`ì„ `mean_target` ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ë©´ ë©ë‹ˆë‹¤:


``` r
# country_profilingì„ mean_targetìœ¼ë¡œ ì •ë ¬í•œ ë‹¤ìŒ ì²˜ìŒ 6ê°œ êµ­ê°€ ê°€ì ¸ì˜¤ê¸°
country_profiling %>% arrange(desc(mean_target)) %>% head()
```

```
##          country mean_target sum_target perc_target q_rows perc_rows
## 1       Malaysia       1.000          1       0.012      1     0.001
## 2         Mexico       0.667          2       0.024      3     0.003
## 3       Portugal       0.200          1       0.012      5     0.005
## 4 United Kingdom       0.178          8       0.096     45     0.049
## 5        Uruguay       0.175         11       0.133     63     0.069
## 6         Israel       0.167          1       0.012      6     0.007
```


ì¢‹ìŠµë‹ˆë‹¤! ë…ê°ì— ê±¸ë¦´ í™•ë¥ ì´ ê°€ì¥ ë†’ì€ êµ­ê°€ë¡œ `Malasyia`ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤! ê·¸ê³³ ì‚¬ëŒë“¤ì˜ 100%ê°€ ë…ê°ì— ê±¸ë ¸ìŠµë‹ˆë‹¤ (`mean_has_flu=1.000`).

í•˜ì§€ë§Œ ìš°ë¦¬ì˜ ìƒì‹ì€ _ì•„ë§ˆë„_ ë¬´ì–¸ê°€ ì˜ëª»ë˜ì—ˆë‹¤ê³  ì¡°ì–¸í•©ë‹ˆë‹¤...

ë§ë ˆì´ì‹œì•„ì˜ í–‰ ìˆ˜ëŠ” ëª‡ ê°œì¸ê°€ìš”? ì •ë‹µ: 1. -ì—´: `q_rows=1`
ë§ë ˆì´ì‹œì•„ì˜ ì–‘ì„± ì‚¬ë¡€ëŠ” ëª‡ ê°œì¸ê°€ìš”? ì •ë‹µ: 1. -ì—´: `sum_target=1`

ìƒ˜í”Œì„ ëŠ˜ë ¤ ì´ ë¹„ìœ¨ì´ ë†’ê²Œ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì´ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì—ì„œ **ê³¼ì í•©(overfit)**ì„ ìœ ë°œí•˜ê³  í¸í–¥ì„ ë§Œë“¤ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

`Mexico`ëŠ” ì–´ë–¨ê¹Œìš”? 3ëª… ì¤‘ 2ëª…ì´ ë…ê°... ì—¬ì „íˆ ë‚®ì•„ ë³´ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ `Uruguay`ëŠ” 17.3%ì˜ í™•ë¥ (63ê±´ ì¤‘ 11ê±´)ì„ ë³´ì´ë©°, ì´ 63ê±´ì€ ì „ì²´ ì¸êµ¬ì˜ ê±°ì˜ 7%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤ (`perc_row=0.069`). ì´ ë¹„ìœ¨ì€ ì¢€ ë” ì‹ ë¢°í•  ìˆ˜ ìˆì–´ ë³´ì…ë‹ˆë‹¤.

ë‹¤ìŒì€ ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ëª‡ ê°€ì§€ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤:


#### ì‚¬ë¡€ 1: ëŒ€í‘œì„±ì´ ë‚®ì€ ê°’ì„ ì¬ë²”ì£¼í™”í•˜ì—¬ ì¤„ì´ê¸° {#reduce_cardinality_by_re_categorizing_less_representative_values}

ë°ì´í„°ì—ì„œ ì¼ì • ë¹„ìœ¨ ì´ìƒì˜ ì ìœ ìœ¨ì„ ê°€ì§„ ì‚¬ë¡€ë§Œ ë‚¨ê¹ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë°ì´í„°ì—ì„œ ì ìœ ìœ¨ì´ 1% ë¯¸ë§Œì¸ êµ­ê°€ë“¤ì˜ ì´ë¦„ì„ `other`ë¡œ ë°”ê¿‰ë‹ˆë‹¤.


``` r
country_profiling=categ_analysis(data=data_country, input="country", target = "has_flu")

countries_high_rep=filter(country_profiling, perc_rows>0.01) %>% pull(country)

# ë§Œì•½ countries_high_repì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ `other` ì¹´í…Œê³ ë¦¬ í• ë‹¹
data_country$country_new=ifelse(data_country$country %in% countries_high_rep, data_country$country, "other")
```

ë…ê° í™•ë¥ ì„ ë‹¤ì‹œ í™•ì¸í•´ ë´…ì‹œë‹¤.


``` r
country_profiling_new=categ_analysis(data=data_country, input="country_new", target = "has_flu")
country_profiling_new
```

```
##       country_new mean_target sum_target perc_target q_rows perc_rows
## 1  United Kingdom       0.178          8       0.096     45     0.049
## 2         Uruguay       0.175         11       0.133     63     0.069
## 3          Canada       0.158          3       0.036     19     0.021
## 4          France       0.142         41       0.494    288     0.316
## 5         Germany       0.100          3       0.036     30     0.033
## 6       Australia       0.098          4       0.048     41     0.045
## 7         Romania       0.091          1       0.012     11     0.012
## 8           Spain       0.091          1       0.012     11     0.012
## 9          Sweden       0.083          1       0.012     12     0.013
## 10    Netherlands       0.053          1       0.012     19     0.021
## 11          other       0.041          7       0.084    170     0.187
## 12         Turkey       0.030          2       0.024     67     0.074
## 13        Belgium       0.000          0       0.000     15     0.016
## 14         Brazil       0.000          0       0.000     13     0.014
## 15          China       0.000          0       0.000     65     0.071
## 16          Italy       0.000          0       0.000     10     0.011
## 17          Japan       0.000          0       0.000     18     0.020
## 18         Poland       0.000          0       0.000     13     0.014
```



êµ­ê°€ì˜ ìˆ˜ê°€ ê¸‰ê²©íˆ ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤ -**74% ê°ì†Œ**- ë‹¨ì§€ 1% ë¯¸ë§Œì˜ ë‚®ì€ ëŒ€í‘œì„± êµ­ê°€ë“¤ì„ ì¤„ì„ìœ¼ë¡œì¨ 70ê°œ êµ­ê°€ ì¤‘ 18ê°œë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.

`other` ì¹´í…Œê³ ë¦¬ì—ì„œ íƒ€ê²Ÿ ë³€ìˆ˜ì˜ í™•ë¥ ì´ ì¢€ ë” ì•ˆì •í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì˜ˆì¸¡ ëª¨ë¸ì´ `Malaysia`ë¥¼ ë³´ê²Œ ë˜ë©´ **100%ì˜ í™•ë¥ ì„ ë¶€ì—¬í•˜ëŠ” ëŒ€ì‹  4.1%** (`mean_has_flu=0.041`)ë¥¼ ë¶€ì—¬í•˜ê²Œ ë©ë‹ˆë‹¤.

**ì´ ë§ˆì§€ë§‰ ë°©ë²•ì— ëŒ€í•œ ì¡°ì–¸:**

ì´ ê¸°ìˆ ì„ ë§¹ëª©ì ìœ¼ë¡œ ì ìš©í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”. ë•Œë•Œë¡œ **ë§¤ìš° ë¶ˆê· í˜•í•œ(highly unbalanced)** íƒ€ê²Ÿ ì˜ˆì¸¡(ì˜ˆ: **ì´ìƒ íƒì§€, anomaly detection**)ì—ì„œëŠ” ì´ìƒ ì§•í›„ê°€ ë°ì´í„°ì˜ 1% ë¯¸ë§Œì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.


``` r
# ë°ì´í„° ë³µì œ
d_abnormal=data_country

# ì¼ë¶€ êµ­ê°€ì—ì„œ ë¹„ì •ìƒì ì¸ ë™ì‘ ì‹œë®¬ë ˆì´ì…˜
d_abnormal$abnormal=ifelse(d_abnormal$country %in% c("Brazil", "Chile"), 'yes', 'no')

# ë²”ì£¼í˜• ë¶„ì„
ab_analysis=categ_analysis(d_abnormal, input = "country", target = "abnormal")

# ì²˜ìŒ 6ê°œ ìš”ì†Œë§Œ í‘œì‹œ
head(ab_analysis)
```

```
##               country mean_target sum_target perc_target q_rows perc_rows
## 1              Brazil           1         13       0.867     13     0.014
## 2               Chile           1          2       0.133      2     0.002
## 3           Argentina           0          0       0.000      9     0.010
## 4 Asia/Pacific Region           0          0       0.000      1     0.001
## 5           Australia           0          0       0.000     41     0.045
## 6             Austria           0          0       0.000      1     0.001
```

``` r
# ë¶„í¬ ê²€ì‚¬, 'no' ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ” ë¹„ì¤‘ì´ ë§¤ìš° ë‚®ìŒ
freq(d_abnormal, "abnormal", plot = F)
```

```
##   abnormal frequency percentage cumulative_perc
## 1       no       895      98.35           98.35
## 2      yes        15       1.65          100.00
```

_ì´ìƒ ìˆ˜ì¹˜ê°€ ì–¼ë§ˆë‚˜ ìˆë‚˜ìš”?_

ë‹¨ 15ê°œë¿ì´ë©°, ì „ì²´ ë°ì´í„°ì˜ 1.65%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.

`categ_analysis`ê°€ ë°˜í™˜í•œ í…Œì´ë¸”ì„ ë³´ë©´, ì´ _ì´ìƒ ì§•í›„_ëŠ” ì°¸ì—¬ë„ê°€ ë§¤ìš° ë‚®ì€ ì¹´í…Œê³ ë¦¬ì—ì„œ**ë§Œ** ë°œìƒí•¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `Brazil`ì€ 1.4%, `Chile`ì€ 0.2%ì— ë¶ˆê³¼í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ë°ì´í„° ë¶„í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `other` ì¹´ë°ê³ ë¦¬ë¥¼ ë§Œë“œëŠ” ê²ƒì€ ì¢‹ì€ ìƒê°ì´ ì•„ë‹™ë‹ˆë‹¤.

**ê²°ë¡ :**

ë¹„ë¡ ì´ê²ƒì€ ì¤€ë¹„ëœ ì˜ˆì œì´ì§€ë§Œ, ì •í™•ë„ ì¸¡ë©´ì—ì„œ ì •ë§ ìœ ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë°ì´í„° ì¤€ë¹„ ê¸°ìˆ ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë“¤ì€ ì „ë¬¸ê°€ì˜ ê°ë…ì´ í•„ìš”í•˜ë©°, ì•Œê³ ë¦¬ì¦˜ì´ ì´ëŸ¬í•œ ê°ë…ì„ ë„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


#### ì‚¬ë¡€ 2: ìë™ ê·¸ë£¹í™”ë¥¼ í†µí•œ ì¤„ì´ê¸°

ì´ ì ˆì°¨ëŠ” `kmeans` í´ëŸ¬ìŠ¤í„°ë§ ê¸°ìˆ ê³¼ `categ_analysis`ê°€ ë°˜í™˜í•œ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì¸¡ë©´ì—ì„œ ìœ ì‚¬í•œ í–‰ë™ì„ ë³´ì´ëŠ” ì¹´í…Œê³ ë¦¬ë“¤ì„ ê·¸ë£¹(í´ëŸ¬ìŠ¤í„°)ìœ¼ë¡œ ë¬¶ìŠµë‹ˆë‹¤.

* `perc_rows`
* `perc_target`

ë‘ ê°€ì§€ë¥¼ ê²°í•©í•˜ë©´ ê°€ëŠ¥ì„±ê³¼ ëŒ€í‘œì„±ì„ ëª¨ë‘ ê³ ë ¤í•œ ê·¸ë£¹ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


**R ì‹¤ìŠµ:**

ìš°ë¦¬ëŠ” ì›í•˜ëŠ” ê·¸ë£¹ì˜ ìˆ˜ì¸ `n_groups` ë§¤ê°œë³€ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì´ ìˆ«ìëŠ” ë°ì´í„°ì™€ ì „ì²´ ì¹´í…Œê³ ë¦¬ ìˆ˜ì— ë”°ë¼ ìƒëŒ€ì ì´ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ 3ì—ì„œ 10 ì‚¬ì´ì˜ ìˆ«ìê°€ ì ë‹¹í•©ë‹ˆë‹¤.

`auto_grouping` í•¨ìˆ˜ëŠ” `funModeling` ë²„ì „ 1.6 ì´ìƒì—ì„œ ì œê³µë©ë‹ˆë‹¤. `target` ë§¤ê°œë³€ìˆ˜ëŠ” ë¹„ì´ì§„(non binary) ë³€ìˆ˜ë§Œ ì§€ì›í•œë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.

_ì°¸ê³ : `seed` ë§¤ê°œë³€ìˆ˜ëŠ” ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ, ìˆ«ìë¥¼ ì§€ì •í•˜ë©´ í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤._


``` r
# ì¹´ë””ë„ë¦¬í‹° ì¤„ì´ê¸°
country_groups=auto_grouping(data = data_country, input = "country", target="has_flu", n_groups=9, seed = 999)
```

```
## Warning: `select_()` was deprecated in dplyr 0.7.0.
## â„¹ Please use `select()` instead.
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

```
## Warning: `arrange_()` was deprecated in dplyr 0.7.0.
## â„¹ Please use `arrange()` instead.
## â„¹ See vignette('programming') for more help
## â„¹ The deprecated feature was likely used in the funModeling package.
##   Please report the issue at <https://github.com/pablo14/funModeling/issues>.
## This warning is displayed once per session.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.
```

``` r
country_groups$df_equivalence
```

```
##                      country country_rec
## 1                   Bulgaria     group_1
## 2                    Denmark     group_1
## 3                  Hong Kong     group_1
## 4                  Indonesia     group_1
## 5                      Italy     group_1
## 6                     Norway     group_1
## 7                Philippines     group_1
## 8                  Singapore     group_1
## 9               South Africa     group_1
## 10                   Ukraine     group_1
## 11       Asia/Pacific Region     group_2
## 12                   Austria     group_2
## 13                Bangladesh     group_2
## 14    Bosnia and Herzegovina     group_2
## 15                  Cambodia     group_2
## 16                     Chile     group_2
## 17                Costa Rica     group_2
## 18                   Croatia     group_2
## 19                    Cyprus     group_2
## 20            Czech Republic     group_2
## 21        Dominican Republic     group_2
## 22                     Egypt     group_2
## 23                   Finland     group_2
## 24                     Ghana     group_2
## 25                    Greece     group_2
## 26                  Honduras     group_2
## 27 Iran, Islamic Republic of     group_2
## 28                   Ireland     group_2
## 29               Isle of Man     group_2
## 30        Korea, Republic of     group_2
## 31                    Latvia     group_2
## 32                 Lithuania     group_2
## 33                Luxembourg     group_2
## 34                     Malta     group_2
## 35      Moldova, Republic of     group_2
## 36                Montenegro     group_2
## 37                   Morocco     group_2
## 38               New Zealand     group_2
## 39                  Pakistan     group_2
## 40     Palestinian Territory     group_2
## 41                      Peru     group_2
## 42        Russian Federation     group_2
## 43              Saudi Arabia     group_2
## 44                   Senegal     group_2
## 45                  Slovenia     group_2
## 46                    Taiwan     group_2
## 47                  Thailand     group_2
## 48                   Vietnam     group_2
## 49                     China     group_3
## 50                    Turkey     group_3
## 51                    France     group_4
## 52                 Australia     group_5
## 53                 Argentina     group_6
## 54                    Israel     group_6
## 55                  Malaysia     group_6
## 56                    Mexico     group_6
## 57                  Portugal     group_6
## 58                   Romania     group_6
## 59                     Spain     group_6
## 60                    Sweden     group_6
## 61               Switzerland     group_6
## 62                   Belgium     group_7
## 63                    Brazil     group_7
## 64                     Japan     group_7
## 65               Netherlands     group_7
## 66                    Poland     group_7
## 67            United Kingdom     group_8
## 68                   Uruguay     group_8
## 69                    Canada     group_9
## 70                   Germany     group_9
```

`auto_grouping`ì€ 3ê°œì˜ ê°ì²´ë¥¼ í¬í•¨í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

* `df_equivalence`: ê¸°ì¡´ ê°’ê³¼ ìƒˆë¡œìš´ ê°’ì„ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì´ í¬í•¨ëœ ë°ì´í„° í”„ë ˆì„.
* `fit_cluster`: ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©ëœ k-means ëª¨ë¸ (ê°’ì€ ìŠ¤ì¼€ì¼ë§ë¨).
* `recateg_results`: íƒ€ê²Ÿ ë³€ìˆ˜ì— ëŒ€í•œ ê° ê·¸ë£¹ì˜ í”„ë¡œíŒŒì¼ë§ì„ í¬í•¨í•˜ëŠ” ë°ì´í„° í”„ë ˆì„ìœ¼ë¡œ, ì²« ë²ˆì§¸ ì—´ì€ ì…ë ¥ ë³€ìˆ˜ì˜ ì´ë¦„ì„ ë”°ë¦…ë‹ˆë‹¤ (ì´ ê²½ìš° `country_rec`). ê° ê·¸ë£¹ì€ ì…ë ¥ ë³€ìˆ˜ì˜ í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ì¹´í…Œê³ ë¦¬ì— ëŒ€ì‘í•©ë‹ˆë‹¤ (`df_equivalence`ì—ì„œ í™•ì¸ ê°€ëŠ¥).

ìƒˆë¡œìš´ ê·¸ë£¹ë“¤ì´ ì–´ë–»ê²Œ í–‰ë™í•˜ëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤. ì˜ˆì¸¡ ëª¨ë¸ì´ ë³´ê²Œ ë  ì •ë³´ì…ë‹ˆë‹¤.


``` r
country_groups$recateg_results
```

```
##   country_rec mean_target sum_target perc_target q_rows perc_rows
## 1     group_8       0.176         19       0.229    108     0.119
## 2     group_6       0.156         10       0.120     64     0.070
## 3     group_4       0.142         41       0.494    288     0.316
## 4     group_9       0.122          6       0.072     49     0.054
## 5     group_5       0.098          4       0.048     41     0.045
## 6     group_3       0.015          2       0.024    132     0.145
## 7     group_7       0.013          1       0.012     78     0.086
## 8     group_1       0.000          0       0.000     75     0.082
## 9     group_2       0.000          0       0.000     75     0.082
```

ìœ„ í…Œì´ë¸”ì€ `mean_target`ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì–´, í™•ë¥ ì„ ìµœëŒ€í™”í•˜ê±°ë‚˜ ìµœì†Œí™”í•˜ëŠ” ê·¸ë£¹ì„ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


* `group_2`ê°€ ê°€ì¥ í”í•˜ë©°, 31.6%ì˜ ë¹„ì¤‘ì„ ì°¨ì§€í•˜ê³  `mean_target`(í™•ë¥ )ì€ 14.2%ì…ë‹ˆë‹¤.
* `group_8`ì´ ê°€ì¥ ë†’ì€ í™•ë¥ (17.6%)ì„ ë³´ì…ë‹ˆë‹¤. ê·¸ ë’¤ë¥¼ ì´ì–´ `group_6`ê°€ 15.6%ì˜ ì–‘ì„±(`has_flu="yes"`) í™•ë¥ ì„ ê°€ì§‘ë‹ˆë‹¤.
* `group_4`, `group_5`, `group_9`ì€ ë¹„ìŠ·í•´ ë³´ì…ë‹ˆë‹¤. ëª¨ë“  ì‚¬ë¡€ì—ì„œ í™•ë¥ ì´ 0ì´ë¯€ë¡œ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* `group_7`ê³¼ `group_3`ì€ ì–‘ì„± ì‚¬ë¡€ê°€ ìˆëŠ” êµ­ê°€ê°€ 1~2ê°œë¿ì…ë‹ˆë‹¤. ì´ ìˆ˜ì¹˜ë“¤ì„ ë™ì¼í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆìœ¼ë©°, ê²°êµ­ ê°€ì¥ ë‚®ì€ í™•ë¥ ì„ ê°€ì§„ êµ­ê°€ë“¤ì„ ë‚˜íƒ€ë‚´ê²Œ ë©ë‹ˆë‹¤.


ë¨¼ì € ì›ë³¸ ë°ì´í„°ì…‹ì— ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ ì—´ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.


``` r
data_country_2=data_country %>% inner_join(country_groups$df_equivalence, by="country")
```

ì´ì œ ë‹¤ìŒìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ì¶”ê°€ ë³€í™˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

* `group_4`, `group_5`, `group_9`ì€ `low_likelihood`ê°€ ë©ë‹ˆë‹¤ (ì–‘ì„± ì‚¬ë¡€ê°€ ì—†ê±°ë‚˜ íƒ€ê²Ÿ ë¹„ì¤‘ì´ ë‚®ì€ êµ­ê°€ë“¤).
* `group_7`ê³¼ `group_3`ì€ `low_target_share`ê°€ ë©ë‹ˆë‹¤.


``` r
data_country_2$country_rec=
  ifelse(data_country_2$country_rec %in% 
           c("group_4", "group_5", "group_9"), 
          "low_likelihood", 
          data_country_2$country_rec
          )

data_country_2$country_rec=
  ifelse(data_country_2$country_rec %in% 
           c("group_7", "group_3"),
          "low_target_share", 
          data_country_2$country_rec
          )
```

ìµœì¢… ê·¸ë£¹í™”(`country_rec` ë³€ìˆ˜)ë¥¼ í™•ì¸í•´ ë´…ì‹œë‹¤.


``` r
categ_analysis(data=data_country_2, input="country_rec", target = "has_flu")
```

```
##        country_rec mean_target sum_target perc_target q_rows perc_rows
## 1          group_8       0.176         19       0.229    108     0.119
## 2          group_6       0.156         10       0.120     64     0.070
## 3   low_likelihood       0.135         51       0.614    378     0.415
## 4 low_target_share       0.014          3       0.036    210     0.231
## 5          group_1       0.000          0       0.000     75     0.082
## 6          group_2       0.000          0       0.000     75     0.082
```

`sum_target` ë¶„í¬ë¥¼ ë³´ì•˜ì„ ë•Œ ê° ê·¸ë£¹ì´ ì ì ˆí•œ ìƒ˜í”Œ í¬ê¸°ë¥¼ ê°€ì§„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë³€í™˜ ê²°ê³¼ `low_likelihood`ëŠ” ì „ì²´ ì‚¬ë¡€ì˜ 21%ë¥¼ ì°¨ì§€í•˜ë©´ì„œë„ ì—¬ì „íˆ ì–‘ì„± ì‚¬ë¡€ëŠ” 0ê°œ(`sum_target`=0)ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  `low_target_share`ëŠ” 3ê°œì˜ ì–‘ì„± ì‚¬ë¡€ë¥¼ ê°€ì§€ë©° ì „ì²´ ì–‘ì„± ì‚¬ë¡€ì˜ 3.6%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.

ëª¨ë“  ê·¸ë£¹ì´ ì¢‹ì€ ëŒ€í‘œì„±ì„ ê°€ì§„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ëŠ” `perc_rows` ë³€ìˆ˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, ëª¨ë“  ì‚¬ë¡€ê°€ 7% ì´ìƒì˜ ë¹„ì¤‘ì„ ì°¨ì§€í•©ë‹ˆë‹¤.

ë” ì ì€ ìˆ˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì‹œë„í•˜ë©´ ì´ëŸ¬í•œ ìˆ˜ë™ ì‘ì—…ì„ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¤ì–‘í•œ ì¹´í…Œê³ ë¦¬ê°€ ë§ì€ ë³€ìˆ˜ë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ì˜ˆì œì˜€ìŠµë‹ˆë‹¤.


 
### ì˜ˆì¸¡ ëª¨ë¸ì´ ìš´ì˜ í™˜ê²½ì— ìˆì„ ë•Œ ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬í•˜ê¸°

ìƒˆë¡œìš´ êµ­ê°€ì¸ `new_country_hello_world`ê°€ ë‚˜íƒ€ë‚¬ë‹¤ê³  ìƒìƒí•´ ë´…ì‹œë‹¤. ì˜ˆì¸¡ ëª¨ë¸ì€ ê³ ì •ëœ ê°’ìœ¼ë¡œ í•™ìŠµë˜ì—ˆê¸° ë•Œë¬¸ì— ì‹¤íŒ¨í•  ê²ƒì…ë‹ˆë‹¤. í•œ ê°€ì§€ ë°©ë²•ì€ `mean_target=0`ì¸ ê·¸ë£¹ì„ í• ë‹¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì´ëŠ” ì§€ë‚œ ì˜ˆì œì˜ ì‚¬ë¡€ì™€ ìœ ì‚¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì°¨ì´ì ì€ `group_5`ì— ìˆëŠ”ë°, ì´ ì¹´í…Œê³ ë¦¬ëŠ” ì™„ì „íˆ ìƒˆë¡œìš´ ê°’ë³´ë‹¤ëŠ” ì¤‘ê°„ í™•ë¥  ê·¸ë£¹ì— ë” ì˜ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì–¼ë§ˆ í›„ì—ëŠ” ëª¨ë“  ìƒˆë¡œìš´ ê°’ì„ í¬í•¨í•˜ì—¬ ëª¨ë¸ì„ ë‹¤ì‹œ êµ¬ì¶•í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `new_country_hello_world`ê°€ ì¢‹ì€ í™•ë¥ ì„ ê°€ì§€ê³  ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ë¶ˆì´ìµì„ ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ìš”ì•½í•˜ìë©´:

_ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ê°€ ë‚˜íƒ€ë‚¬ë‚˜ìš”? ê°€ì¥ ì˜ë¯¸ê°€ ì ì€ ê·¸ë£¹ìœ¼ë¡œ ë³´ë‚´ì„¸ìš”. ì ì‹œ í›„ ê·¸ ì˜í–¥ì„ ì¬ë¶„ì„í•˜ì„¸ìš”. ì¤‘ê°„ ë˜ëŠ” ë†’ì€ í™•ë¥ ì„ ë³´ì´ë‚˜ìš”? ê°€ì¥ ì í•©í•œ ê·¸ë£¹ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”._



### ì˜ˆì¸¡ ëª¨ë¸ì´ ê³ ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì²˜ë¦¬í•˜ë‚˜ìš”? íŒŒíŠ¸ 1

ë„¤, ê·¸ë¦¬ê³  ì•„ë‹ˆì˜¤ì…ë‹ˆë‹¤. ì¼ë¶€ ëª¨ë¸ì€ ë‹¤ë¥¸ ëª¨ë¸ë³´ë‹¤ ê³ ì¹´ë””ë„ë¦¬í‹° ë¬¸ì œë¥¼ ë” ì˜ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì–´ë–¤ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì´ëŸ¬í•œ ë°ì´í„° ì¤€ë¹„ê°€ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ ì±…ì€ ì´ ë¬¸ì œë¥¼ ë…¸ì¶œí•˜ë ¤ê³  ë…¸ë ¥í•˜ë©°, ë•Œë•Œë¡œ ì´ê²ƒì´ ë” ë‚˜ì€ ëª¨ë¸ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

ì´ì œ ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹ (Gradient Boosting Machine)ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ê°œì˜ ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•´ ë³´ê² ìŠµë‹ˆë‹¤. GBMì€ ë‹¤ì–‘í•œ ë°ì´í„° ì…ë ¥ì— ëŒ€í•´ ë§¤ìš° ê°•ë ¥í•œ íŠ¹ì„±ì„ ë³´ì…ë‹ˆë‹¤.

ì²« ë²ˆì§¸ ëª¨ë¸ì€ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê³ , ë‘ ë²ˆì§¸ ëª¨ë¸ì€ `funModeling` íŒ¨í‚¤ì§€ì˜ í•¨ìˆ˜ë¡œ ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ROC ì˜ì—­ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë°€ë„ë¥¼ ì¸¡ì •í•˜ë©°, ë²”ìœ„ëŠ” 0.5ì—ì„œ 1 ì‚¬ì´ì…ë‹ˆë‹¤. ìˆ«ìê°€ ë†’ì„ìˆ˜ë¡ ëª¨ë¸ì˜ ì„±ëŠ¥ì´ ì¢‹ìŠµë‹ˆë‹¤. ê°’ì— ëŒ€í•´ _í™•ì‹ _ì„ ê°–ê¸° ìœ„í•´ êµì°¨ ê²€ì¦(cross-validation)ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. êµì°¨ ê²€ì¦ ê²°ê³¼ì˜ ì¤‘ìš”ì„±ì€ [ì˜¤ì°¨ ì•Œê¸°](#knowing_the_error) ì¥ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.


``` r
# ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ì§€ ì•Šê³  ì²« ë²ˆì§¸ ëª¨ë¸ êµ¬ì¶•
library(caret)
if(!requireNamespace("gbm", quietly = TRUE)) install.packages("gbm")
fitControl <- trainControl(method = "cv",
                           number = 4,
                           classProbs = TRUE,
                           summaryFunction = twoClassSummary)


fit_gbm_1 <- train(has_flu ~ country,
                   data = data_country_2,
                   method = "gbm",
                   trControl = fitControl,
                   verbose = FALSE,
                   metric = "ROC")


# ìµœê³  ROC ê°’ ê°€ì ¸ì˜¤ê¸°
roc=round(max(fit_gbm_1$results$ROC),2)
```

ROC ê³¡ì„  ì•„ë˜ ì˜ì—­ì€ (`roc`): 0.67ì…ë‹ˆë‹¤.

ì´ì œ ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ì „ì— ìˆ˜í–‰í•œ ë°ì´í„° ì¤€ë¹„ê°€ ëœ ë°ì´í„°ë¡œ ë™ì¼í•œ ëª¨ë¸ì„ ë§Œë“­ë‹ˆë‹¤.


``` r
# country_rec ë³€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‘ ë²ˆì§¸ ëª¨ë¸ êµ¬ì¶•
fit_gbm_2 <- train(has_flu ~ country_rec,
                   data = data_country_2,
                   method = "gbm",
                   trControl = fitControl,
                   verbose = FALSE,
                   metric = "ROC")

# ìƒˆë¡œìš´ ìµœê³  ROC ê°’ ê°€ì ¸ì˜¤ê¸°
new_roc=round(max(fit_gbm_2$results$ROC),2)
```



ìƒˆë¡œìš´ ROC ê³¡ì„ ì€ (`new_roc`): 0.72ì…ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì²« ë²ˆì§¸ roc ê°’ì— ëŒ€í•œ ê°œì„  ë¹„ìœ¨ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

**ê°œì„ ë„: ~ 7.46%**. âœ…

ë‚˜ì˜ì§€ ì•Šì£ ?

**ë§ˆì§€ë§‰ í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ ì§§ì€ í‰:**

ê°€ì¥ ê°•ë ¥í•œ ëª¨ë¸ ì¤‘ í•˜ë‚˜ì¸ **ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹ **ì„ ì‚¬ìš©í–ˆìŒì—ë„ ì„±ëŠ¥ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ì €ë¶„í•œ ë°ì´í„°ì— ë” ë¯¼ê°í•œ [ë¡œì§€ìŠ¤í‹± íšŒê·€(logistic regression)](https://en.wikipedia.org/wiki/Logistic_regression)ì™€ ê°™ì€ ë‹¤ë¥¸ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë©´ ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì˜€ì„ ë•Œì™€ ê·¸ë ‡ì§€ ì•Šì•˜ì„ ë•Œì˜ ì°¨ì´ê°€ ë” ì»¤ì§ˆ ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” `verbose=FALSE` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚­ì œí•˜ê³  `method=glm`ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`glm`ì€ ë¡œì§€ìŠ¤í‹± íšŒê·€ë¥¼ í¬í•¨í•©ë‹ˆë‹¤).

_ì¶”ê°€ ì½ê¸°_ ì¥ì—ëŠ” ë²”ì£¼í˜• ë³€ìˆ˜ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì²˜ë¦¬ ë°©ë²•ê³¼ ê° ë°©ë²•ì´ ì •í™•ë„ë¥¼ ì–´ë–»ê²Œ ë†’ì´ê±°ë‚˜ ë‚®ì¶”ëŠ”ì§€ì— ëŒ€í•œ ë²¤ì¹˜ë§ˆí¬ê°€ ìˆìŠµë‹ˆë‹¤.


### ì˜ˆì¸¡ ëª¨ë¸ì´ ê³ ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šë‚˜ìš”? íŒŒíŠ¸ 2 {#high_cardinality_in_predictive_models_part_2}

ì¼ë¶€ ëª¨ë¸ì´ ì´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ê²€í† í•´ ë³´ê² ìŠµë‹ˆë‹¤.

**ì˜ì‚¬ê²°ì • íŠ¸ë¦¬ (Decision Trees)**: ì¹´ë””ë„ë¦¬í‹°ê°€ ë†’ì€ ë³€ìˆ˜ë¥¼ ìƒë‹¨ì—ì„œ ì„ íƒí•˜ì—¬ ì •ë³´ íšë“ëŸ‰(information gain)ì„ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ë¥¸ ë³€ìˆ˜ë³´ë‹¤ ë” í° ì¤‘ìš”ë„ë¥¼ ë¶€ì—¬í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ì´ëŠ” ê³¼ì í•©ì˜ ì¦ê±°ì…ë‹ˆë‹¤. ì´ ëª¨ë¸ì€ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜ë¥¼ ì¤„ì˜€ì„ ë•Œì™€ ê·¸ë ‡ì§€ ì•Šì•˜ì„ ë•Œì˜ ì°¨ì´ë¥¼ í™•ì¸í•˜ê¸°ì— ì¢‹ìŠµë‹ˆë‹¤.

**ëœë¤ í¬ë ˆìŠ¤íŠ¸ (Random Forest)**: -ì ì–´ë„ R êµ¬í˜„ì²´ì—ì„œëŠ”- ìµœì†Œ 53ê°œ ì´ìƒì˜ ì„œë¡œ ë‹¤ë¥¸ ë²”ì£¼ë¥¼ ê°€ì§„ ë²”ì£¼í˜• ë³€ìˆ˜ë§Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì œí•œì€ ê³¼ì í•©ì„ í”¼í•˜ê¸° ìœ„í•œ ê²ƒì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì´ ì ì€ ì•Œê³ ë¦¬ì¦˜ì˜ ë³¸ì§ˆ(ìˆ˜ë§ì€ íŠ¸ë¦¬ë¥¼ ìƒì„±í•¨)ê³¼ ê²°í•©í•˜ì—¬ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜ë¥¼ ì„ íƒí•  ë•Œ ë‹¨ì¼ ì˜ì‚¬ê²°ì • íŠ¸ë¦¬ì˜ íš¨ê³¼ë¥¼ ì¤„ì—¬ì¤ë‹ˆë‹¤.

**ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹  (Gradient Boosting Machine)** ë° **ë¡œì§€ìŠ¤í‹± íšŒê·€ (Logistic Regression)**: ë‚´ë¶€ì ìœ¼ë¡œ ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ í”Œë˜ê·¸(flag) ë˜ëŠ” ë”ë¯¸(dummy) ë³€ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. êµ­ê°€ì— ëŒ€í•œ ì˜ˆì œì—ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ 70ê°œì˜ í”Œë˜ê·¸ ë³€ìˆ˜ê°€ ìƒì„±ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤ (`caret`ì´ ê³µì‹ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì´ë©°, ë”ë¯¸ ì—†ì´ ì›ë˜ ë³€ìˆ˜ë¥¼ ìœ ì§€í•˜ë ¤ë©´ ê³µì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤).
ì´ì „ì— ë§Œë“  ëª¨ë¸ì„ í™•ì¸í•´ ë´…ì‹œë‹¤.


``` r
# ì²« ë²ˆì§¸ ëª¨ë¸ í™•ì¸...
fit_gbm_1$finalModel
```

```
## A gradient boosted model with bernoulli loss function.
## 50 iterations were performed.
## There were 69 predictors of which 10 had non-zero influence.
```

ì¦‰, 69ê°œì˜ ì…ë ¥ ë³€ìˆ˜ê°€ êµ­ê°€ë¥¼ ë‚˜íƒ€ë‚´ê³  ìˆì§€ë§Œ, í”Œë˜ê·¸ ì—´ë“¤ì€ ëª¨ë¸ ì˜ˆì¸¡ì— ê´€ë ¨ì„±ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ëŠ” **íŠ¹ì„± ê³µí•™(Feature engineering)**ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ [ìµœì  ë³€ìˆ˜ ì„ íƒ](#general_aspects_selecting_best_variables)ê³¼ë„ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ê°€ì¥ ë§ì€ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ë³€ìˆ˜ë¥¼ ì„ íƒí•œ ë‹¤ìŒ ì˜ˆì¸¡ ëª¨ë¸ì„ ë§Œë“œëŠ” ê²ƒì´ ê¶Œì¥ë˜ëŠ” ê´€í–‰ì…ë‹ˆë‹¤.

**ê²°ë¡ : ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ë©´ ì´ëŸ¬í•œ ëª¨ë¸ì—ì„œ ë³€ìˆ˜ì˜ ìˆ˜ë„ ì¤„ì–´ë“­ë‹ˆë‹¤.**



### ìˆ˜ì¹˜í˜• ë˜ëŠ” ë‹¤ì¤‘ ê³µì„ ì„± íƒ€ê²Ÿ ë³€ìˆ˜ ğŸ“

ì´ ì±…ì€ íƒ€ê²Ÿì´ ì´ì§„ ë³€ìˆ˜ì¸ ê²½ìš°ë§Œ ë‹¤ë£¨ì—ˆìœ¼ë©°, í–¥í›„ ìˆ˜ì¹˜í˜• ë° ë‹¤ì¤‘ê°’ íƒ€ê²Ÿì„ ë‹¤ë£° ê³„íšì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì—¬ê¸°ê¹Œì§€ ì½ìœ¼ì…¨ë‹¤ë©´, ë™ì¼í•œ ì•„ì´ë””ì–´ë¥¼ ì—¼ë‘ì— ë‘ê³  ì§ì ‘ íƒìƒ‰í•´ë³´ê³  ì‹¶ìœ¼ì‹¤ ê²ƒì…ë‹ˆë‹¤. ì›¹ì‚¬ì´íŠ¸ì˜ `í˜ì´ì§€ ë°©ë¬¸ ìˆ˜`ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì—ì„œëŠ” ì…ë ¥ ë³€ìˆ˜ì˜ íŠ¹ì • ì¹´í…Œê³ ë¦¬ê°€ ë†’ì€ ë°©ë¬¸ ìˆ˜ì™€ ë” ê´€ë ¨ì´ ìˆëŠ” ë°˜ë©´, ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ëŠ” ë‚®ì€ ê°’ê³¼ ë” ìƒê´€ê´€ê³„ê°€ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

ë‹¤ì¤‘ ê³µì„ ì„± ì¶œë ¥ ë³€ìˆ˜ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤. íŠ¹ì • ê°’ê³¼ ë” ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë“¤ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë„ì‹œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìœ í–‰ ìˆ˜ì¤€(`high`, `mid`, `low`)ì„ ì˜ˆì¸¡í•  ë•Œ, ë‹¤ë¥¸ ë„ì‹œë³´ë‹¤ ë†’ì€ ìœ í–‰ ìˆ˜ì¤€ê³¼ ë” ìƒê´€ê´€ê³„ê°€ ìˆëŠ” ë„ì‹œë“¤ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.


### ê·¸ë£¹í™”ì—ì„œ ì–»ì€ "ì¶”ê°€ ì„ ë¬¼ ğŸ"ì€ ë¬´ì—‡ì¸ê°€ìš”?

ì¹´í…Œê³ ë¦¬ê°€ ì–´ë–»ê²Œ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆëŠ”ì§€ ì•„ëŠ” ê²ƒì€ ì¼ë¶€ ì‚¬ë¡€ì—ì„œ ë³´ê³ í•˜ê¸° ì¢‹ì€ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê·¸ë£¹ ë‚´ì˜ ê° ì¹´í…Œê³ ë¦¬ëŠ” ëŒ€í‘œì„±ê³¼ ì˜ˆì¸¡ë ¥ ì¸¡ë©´ì—ì„œ ìœ ì‚¬í•œ í–‰ë™ì„ ê³µìœ í•˜ê²Œ ë©ë‹ˆë‹¤.

ë§Œì•½ `Argentina`ì™€ `Chile`ê°€ `group_1`ì— ìˆë‹¤ë©´, ì´ë“¤ì€ ë™ì¼í•˜ë©° ëª¨ë¸ë„ ê·¸ë ‡ê²Œ _ë³´ê²Œ_ ë©ë‹ˆë‹¤.


### ëŒ€í‘œì„± ë˜ëŠ” ìƒ˜í”Œ í¬ê¸°

ì´ ê°œë…ì€ ëª¨ë“  ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ë¶„ì„ì— í•´ë‹¹ë˜ì§€ë§Œ, ë°ì´í„° ê³¼í•™ê³¼ í†µê³„ì—ì„œ ë§¤ìš° í”í•œ ì£¼ì œì¸ **[ìƒ˜í”Œ í¬ê¸°(sample size)](https://en.wikipedia.org/wiki/Sample_size_determination)**ì™€ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. íŒ¨í„´ì´ _ì¶©ë¶„íˆ ë°œë‹¬ëœ_ ê²ƒìœ¼ë¡œ ë³´ë ¤ë©´ ì–¼ë§ˆë‚˜ ë§ì€ ë°ì´í„°ê°€ í•„ìš”í• ê¹Œìš”?

ë²”ì£¼í˜• ë³€ìˆ˜ì—ì„œ: "X" ê°’ê³¼ íƒ€ê²Ÿ ê°’ ì‚¬ì´ì˜ ìƒê´€ê´€ê³„ë¥¼ ì‹ ë¢°í•˜ë ¤ë©´ ì¹´í…Œê³ ë¦¬ "X"ì˜ ì‚¬ë¡€ê°€ ëª‡ ê°œë‚˜ í•„ìš”í• ê¹Œìš”? ì´ê²ƒì´ ìš°ë¦¬ê°€ ë¶„ì„í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ìš´ ì´ë²¤íŠ¸ì¼ìˆ˜ë¡ ë” ë§ì€ ì‚¬ë¡€ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ì±… ë’¤ì—ì„œ ë‹¤ë¥¸ ê´€ì ì—ì„œ ì´ ì£¼ì œë¥¼ ë‹¤ë£¨ë©° ì´ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ë§í¬í•  ê²ƒì…ë‹ˆë‹¤.


### ìµœì¢… ìƒê°

* ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì´ëŠ” ë‘ ê°€ì§€ ì‚¬ë¡€ë¥¼ ë³´ì•˜ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ëŠ” íƒ€ê²Ÿ ë³€ìˆ˜ë¥¼ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë° ì´ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì—ì„œ ìœ„í—˜í•  ìˆ˜ ìˆê³ , ë‘ ë²ˆì§¸ëŠ” íƒ€ê²Ÿ ë³€ìˆ˜ë¥¼ ê³ ë ¤í•©ë‹ˆë‹¤. íƒ€ê²Ÿ ë³€ìˆ˜ì— ëŒ€í•œ ê° ì…ë ¥ ì¹´í…Œê³ ë¦¬ì˜ ë™ì§ˆì„±(ë° ëŒ€í‘œì„±)ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

* í•µì‹¬ ê°œë…: ê° ì¹´í…Œê³ ë¦¬ ìì²´ ë° ì˜ˆì¸¡ë˜ëŠ” ì´ë²¤íŠ¸ì— ëŒ€í•œ ì¹´í…Œê³ ë¦¬ì˜ **ëŒ€í‘œì„±**. í†µê³„ì  í…ŒìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ë¥¼ ë¶„ì„í•˜ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

* ë°ì´í„° ì¤€ë¹„ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ **ì…ë ¥ ë³€ìˆ˜ì˜ ì •ë³´ë¥¼ íŒŒê´´í•˜ëŠ” ê²ƒ**ì€ ê²°ê³¼ì ì¸ ê·¸ë£¹í™”ê°€ ê·¸ë£¹ ê°„ì— ë™ì¼í•œ ë¹„ìœ¨ì„ ê°€ì§ì„ ì˜ë¯¸í•©ë‹ˆë‹¤(ì´ì§„ ë³€ìˆ˜ ì…ë ¥ ì‹œ).

* _ìš°ë¦¬ëŠ” í•­ìƒ ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¤„ì—¬ì•¼ í• ê¹Œìš”?_ ìƒí™©ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ê°„ë‹¨í•œ ë°ì´í„°ì— ëŒ€í•œ ë‘ ë²ˆì˜ í…ŒìŠ¤íŠ¸ë§Œìœ¼ë¡œ ëª¨ë“  ì‚¬ë¡€ë¥¼ ì¼ë°˜í™”í•˜ê¸°ì—ëŠ” ë¶€ì¡±í•©ë‹ˆë‹¤. ë…ìê°€ ìì‹ ì˜ í”„ë¡œì íŠ¸ì—ì„œ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ë  ë•Œ ì§ì ‘ ìµœì í™”ë¥¼ ì‹œì‘í•˜ëŠ” ì¢‹ì€ ê³„ê¸°ê°€ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤. 



### ì¶”ê°€ ì½ê¸°

* ë‹¤ìŒ ë§í¬ëŠ” ë²”ì£¼í˜• ë³€ìˆ˜ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì²˜ë¦¬ì— ë”°ë¥¸ ì •í™•ë„ ê²°ê³¼ë“¤ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤: [Beyond One-Hot: an exploration of categorical variables](http://www.kdnuggets.com/2015/12/beyond-one-hot-exploration-categorical-variables.html).




![](introduction/spacer_bar.png)<!-- -->



## ì´ìƒì¹˜ ì²˜ë¦¬ (Treatment of outliers) {#treatment_outliers}

### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?

ì‹¬ì¥ ì§ˆí™˜ ì˜ˆì¸¡ ë“± ë¨¸ì‹ ëŸ¬ë‹ì˜ ë‹¤ë¥¸ ì£¼ì œë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ê·¹ë‹¨ê°’(extreme values) ê°œë…ì€ ì´ ë¶„ì•¼ì—ë§Œ êµ­í•œëœ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì˜¤ëŠ˜ì˜ ì´ìƒì¹˜ê°€ ë‚´ì¼ì€ ì•„ë‹ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì •ìƒê³¼ ë¹„ì •ìƒ í–‰ë™ ì‚¬ì´ì˜ ê²½ê³„ëŠ” ëª¨í˜¸í•˜ì§€ë§Œ, ë°˜ë©´ì— ê·¹ë‹¨ì— ì„œëŠ” ê²ƒì€ ì‰½ìŠµë‹ˆë‹¤.


<img src="data_preparation/outlier_intuition.png" alt="" width="100%"  />

_ì´ë¯¸ì§€ ì œì‘: [Guillermo Mesyngier](https://dribbble.com/gmesyngier)_


**ì´ ì¥ì—ì„œ ë¬´ì—‡ì„ ê²€í† í• ê¹Œìš”?**

* ì´ìƒì¹˜ë€ ë¬´ì—‡ì¸ê°€? ì² í•™ì  ë° ì‹¤ìš©ì  ì ‘ê·¼ ë°©ì‹
* ì°¨ì› ë° ë°ì´í„° ìœ í˜•(ìˆ˜ì¹˜í˜• ë˜ëŠ” ë²”ì£¼í˜•)ì— ë”°ë¥¸ ì´ìƒì¹˜
* Rì—ì„œ ì´ìƒì¹˜ë¥¼ ê°ì§€í•˜ëŠ” ë°©ë²• (ìƒ/í•˜ìœ„ X%, Tukey ë° Hampel ë°©ë²•)
* Rì˜ í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„
* Rì˜ ì˜ˆì¸¡ ëª¨ë¸ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„




### ì´ìƒì¹˜ì— ëŒ€í•œ ì§ê´€

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ë¶„í¬ë¥¼ ìƒê°í•´ ë³´ì‹­ì‹œì˜¤.
  

``` r
# ë¶„í¬ ì‹œê°í™”ë¥¼ ìœ„í•´ ggplot2 ë¡œë“œ
library(ggplot2)

# ìƒ˜í”Œ ë°ì´í„°ì…‹ ìƒì„±
set.seed(31415)
df_1=data.frame(var=round(10000*rbeta(1000,0.15,2.5)))

# í”Œë¡¯íŒ…
ggplot(df_1, aes(var, fill=var)) + geom_histogram(bins=20) + theme_light()
```

```
## Warning: The following aesthetics were dropped during statistical transformation: fill.
## â„¹ This can happen when ggplot fails to infer the correct grouping structure in
##   the data.
## â„¹ Did you forget to specify a `group` aesthetic or to convert a numerical
##   variable into a factor?
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/dealing-with-outliers-1.png" alt="ê¸´ ê¼¬ë¦¬ë¥¼ ê°€ì§„ ìƒ˜í”Œ ë¶„í¬" width="672"  />
<p class="caption">(\#fig:dealing-with-outliers)ê¸´ ê¼¬ë¦¬ë¥¼ ê°€ì§„ ìƒ˜í”Œ ë¶„í¬</p>
</div>

ë³€ìˆ˜ê°€ ì™¼ìª½ìœ¼ë¡œ ì¹˜ìš°ì³ ìˆê³ , ì˜¤ë¥¸ìª½ì— ì¼ë¶€ ì´ìƒì¹˜ ì ë“¤ì´ ë³´ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ë“¤ì„ _ì²˜ë¦¬_í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤ (ğŸ˜). ê·¸ë ‡ë‹¤ë©´ ì§ˆë¬¸ì´ ìƒê¹ë‹ˆë‹¤: _ê·¹ë‹¨ì˜ ì„ê³„ê°’ì„ ì–´ë””ì— ì„¤ì •í•´ì•¼ í• ê¹Œìš”?_ ì§ê´€ì ìœ¼ë¡œëŠ” ìƒìœ„ 1%ë¡œ ì„¤ì •í•˜ê±°ë‚˜, ìƒìœ„ 1%ë¥¼ ì œê±°í•œ í›„ í‰ê· ì˜ ë³€í™”ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ê²½ìš° ëª¨ë‘ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ë‹¤ë¥¸ ìˆ«ì(ì˜ˆ: 2% ë˜ëŠ” 0.1%)ë¥¼ ì„ê³„ê°’ìœ¼ë¡œ ì·¨í•˜ëŠ” ê²ƒë„ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹œê°í™”í•´ ë´…ì‹œë‹¤.


``` r
# ìƒìœ„ 3%, 1%, 0.1% ë°±ë¶„ìœ„ìˆ˜ ê³„ì‚°
percentile_var=quantile(df_1$var, c(0.98, 0.99, 0.999), na.rm = T)
df_p=data.frame(value=percentile_var, percentile=c("a_98th", "b_99th", "c_99.9th"))

# ë™ì¼í•œ ë¶„í¬ì— ë°±ë¶„ìœ„ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ í”Œë¡¯íŒ…
ggplot(df_1, aes(var)) + geom_histogram(bins=20) + geom_vline(data=df_p, aes(xintercept=value,  colour = percentile), show.legend = TRUE, linetype="dashed") + theme_light()
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/dealing-with-outliers-4-1.png" alt="ì´ìƒì¹˜ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì„ê³„ê°’" width="672"  />
<p class="caption">(\#fig:dealing-with-outliers-4)ì´ìƒì¹˜ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì„ê³„ê°’</p>
</div>

ë°±ë¶„ìœ„ìˆ˜ì— ëŒ€í•´ ë” ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ [ë¶€ë¡ 1: ë°±ë¶„ìœ„ìˆ˜ì˜ ë§ˆë²•](#appendix-percentiles) ì¥ì„ ì°¸ì¡°í•˜ì„¸ìš”.

ì§€ê¸ˆì€ ìƒìœ„ 1%(99ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜)ë¥¼ ì„ê³„ê°’ìœ¼ë¡œ ìœ ì§€í•˜ì—¬ ê·¸ ì´í›„ì˜ ëª¨ë“  ì ì„ ì´ìƒì¹˜ë¡œ í‘œì‹œí•˜ê² ìŠµë‹ˆë‹¤.
  
<div class="figure">
<img src="02_data_preparation_files/figure-html/dealing-with-outliers-2-1.png" alt="ìƒìœ„ 1%ë¥¼ ì´ìƒì¹˜ë¡œ í‘œì‹œ" width="384"  />
<p class="caption">(\#fig:dealing-with-outliers-2)ìƒìœ„ 1%ë¥¼ ì´ìƒì¹˜ë¡œ í‘œì‹œ</p>
</div>


ì—¬ê¸°ì„œ í¥ë¯¸ë¡œìš´ ê°œë…ì  ìš”ì†Œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ìš°ë¦¬ê°€ **ë¹„ì •ìƒ**(ë˜ëŠ” ì´ìƒì§•í›„)ì„ ì •ì˜í•  ë•Œ, ê·¸ ë°˜ëŒ€ê¸‰ë¶€ë¡œ **ì •ìƒ ê°œë…ì´ ë¶€ìƒí•œë‹¤**ëŠ” ì ì…ë‹ˆë‹¤.

ì´ "ì •ìƒ" í–‰ë™ì€ ë…¹ìƒ‰ ì˜ì—­ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.


<div class="figure">
<img src="02_data_preparation_files/figure-html/dealing-with-outliers-3-1.png" alt="ë™ì¼í•œ ì„ê³„ê°’, ë‹¤ë¥¸ ê´€ì " width="384"  />
<p class="caption">(\#fig:dealing-with-outliers-3)ë™ì¼í•œ ì„ê³„ê°’, ë‹¤ë¥¸ ê´€ì </p>
</div>


ì–´ë ¤ìš´ ë¶€ë¶„ì€ ì •ìƒê³¼ ë¹„ì •ìƒì´ ê°ˆë¼ì§€ëŠ” ì§€ì ì„ ê²°ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ë‹¤ë£¨ëŠ” ë°ëŠ” ëª‡ ê°€ì§€ ì ‘ê·¼ ë°©ì‹ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ì¤‘ ëª‡ ê°€ì§€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.



### ë¥ê³  ì¶”ìš´ ë‚ ì”¨ì˜ ê²½ê³„ëŠ” ì–´ë””ì¼ê¹Œìš”?

ì´ ì„¹ì…˜ì€ ì¢€ ë” ì² í•™ì ìœ¼ë¡œ ì ‘ê·¼í•´ ë³´ê² ìŠµë‹ˆë‹¤. [í”¼íƒ€ê³ ë¼ìŠ¤](https://en.wikipedia.org/wiki/Pythagoras)ë‚˜ [ì•„ì´ì‘ ë‰´í„´](https://en.wikipedia.org/wiki/Isaac_Newton)ì²˜ëŸ¼ í›Œë¥­í•œ ìˆ˜í•™ìë“¤ ì¤‘ì—ëŠ” ì² í•™ìì´ê¸°ë„ í–ˆë˜ ì´ë“¤ì´ ìˆìŠµë‹ˆë‹¤.

ë”ìš´ ë‚ ì”¨ê°€ ì‹œì‘ë˜ëŠ” ì§€ì , ë°˜ëŒ€ë¡œ ì¶”ìš´ ë‚ ì”¨ê°€ ëë‚˜ëŠ” ì§€ì ì„ ë‚˜íƒ€ë‚´ëŠ” ì„ê³„ê°’ì„ ì–´ë””ì— ë‘ì–´ì•¼ í• ê¹Œìš”?


<div class="figure">
<img src="data_preparation/where_is_the_cutpoint.png" alt="ì ˆë‹¨ ì§€ì ì€ ì–´ë””ì¼ê¹Œìš”?" width="30%"  />
<p class="caption">(\#fig:Finding-the-cutpoint)ì ˆë‹¨ ì§€ì ì€ ì–´ë””ì¼ê¹Œìš”?</p>
</div>


ì ë„ ê·¼ì²˜ì—ì„œëŠ” ì•„ë§ˆë„ 10Â°C (50Â°F) ì •ë„ê°€ ê·¹ë„ë¡œ ë‚®ì€ ì˜¨ë„ê² ì§€ë§Œ, ë‚¨ê·¹ì—ì„œëŠ” í•´ìˆ˜ìš•ì„ ì¦ê¸¸ ë§Œí•œ ë‚ ì”¨ì¼ ê²ƒì…ë‹ˆë‹¤!
â˜ƒï¸ ğŸ–ï¸

ğŸ‘º: _"ì˜¤! í•˜ì§€ë§Œ ê·¸ê±´ ì„œë¡œ ë‹¤ë¥¸ ë‘ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•œ ê·¹ë‹¨ì ì¸ ì˜ˆì‹œì–ì•„ìš”!"_

ë¬¸ì œì—†ìŠµë‹ˆë‹¤! í”„ë™íƒˆì²˜ëŸ¼ ì–´ë–¤ ë„ì‹œë¥¼ í™•ëŒ€í•´ ë³´ë”ë¼ë„, í•œ ë‚ ì”¨ê°€ ì‹œì‘ë˜ê³  ë‹¤ë¥¸ ë‚ ì”¨ê°€ ëë‚˜ëŠ” ê²½ê³„ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì´ ë§í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ê°’ì€ ì—†ì„ ê²ƒì…ë‹ˆë‹¤: _"ì¢‹ì•„ìš”, ë”ìš´ ë‚ ì”¨ëŠ” 25.5Â°C (78Â°F)ë¶€í„° ì‹œì‘ë©ë‹ˆë‹¤."_

ê·¸ê²ƒì€ ìƒëŒ€ì ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ 60Â°C (140Â°F)ì™€ ê°™ì€ ì˜¨ë„ë¥¼ ê³ ë ¤í•  ë•Œì²˜ëŸ¼ ë¶ˆí™•ì‹¤ì„±ì´ ê±°ì˜ 0ìœ¼ë¡œ ì¤„ì–´ë“œëŠ” ê·¹ë‹¨ì— ì„œëŠ” ê²ƒì€ ê½¤ ì‰½ìŠµë‹ˆë‹¤.

ğŸ¤”: _"ì¢‹ì•„ìš”. í•˜ì§€ë§Œ ì´ëŸ° ê°œë…ë“¤ì´ ë¨¸ì‹ ëŸ¬ë‹ê³¼ ë¬´ìŠ¨ ìƒê´€ì´ ìˆì£ ?"_

ìš°ë¦¬ëŠ” ì—¬ê¸°ì„œ ìˆ˜ì¹˜ ë³€ìˆ˜(ì˜¨ë„)ë¥¼ ë ˆì´ë¸”(ë¥ë‹¤/ì¶¥ë‹¤)ë¡œ ê³ ë ¤í•  ë•Œ ì¡´ì¬í•˜ëŠ” ìƒëŒ€ì„±ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìˆ˜ì…ê³¼ "ì •ìƒ", "ë¹„ì •ìƒ" ë ˆì´ë¸”ê³¼ ê°™ì€ ë‹¤ë¥¸ ìˆ˜ì¹˜ ë³€ìˆ˜ì—ë„ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê·¹ë‹¨ê°’(extreme values)**ì„ ì´í•´í•˜ëŠ” ê²ƒì€ **íƒìƒ‰ì  ë°ì´í„° ë¶„ì„**ì˜ ì²« ë²ˆì§¸ ì‘ì—… ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ê·¸ë˜ì•¼ ë¬´ì—‡ì´ ì •ìƒ ë°ì´í„°ì¸ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [í”„ë¡œíŒŒì¼ë§](#profiling) ì¥ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.

ê°’ì„ ì´ìƒì¹˜ë¡œ í‘œì‹œí•˜ëŠ” ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ì˜¨ë„ë¥¼ ë¶„ì„í•˜ëŠ” ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ì´ í‘œì‹œëŠ” _ìƒëŒ€ì _ì´ë©° ëª¨ë“  ë°©ë²•ì´ ë§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ ë¹ ë¥¸ ë°©ë²•ì€ ìƒìœ„ ë° í•˜ìœ„ X%ë¥¼ ì´ìƒì¹˜ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë” ê²¬ê³ í•œ ë°©ë²•ì€ ë°±ë¶„ìœ„ìˆ˜(Tukey ë°©ë²•)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í‘œì¤€ í¸ì°¨ë¥¼ í†µí•œ ê°’ì˜ í™•ì‚°(Hampel ë°©ë²•)ì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ì˜ ë¶„í¬ë¥¼ ê³ ë ¤í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê²½ê³„ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒì€ ë¨¸ì‹ ëŸ¬ë‹ì—ì„œ ê°€ì¥ í”í•œ ì‘ì—… ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. _ì™œì¼ê¹Œìš”? ì–¸ì œì¼ê¹Œìš”?_ ë‘ ê°€ì§€ ì˜ˆë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

* ì˜ˆì‹œ 1: íŠ¹ì • ê³ ê°ì—ê²Œ ì „í™”ë¥¼ ê±¸ì§€ ë§ì§€ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ í™•ë¥ ì„ ë°˜í™˜í•˜ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì„ ê°œë°œí•  ë•Œ, ìµœì¢… ë ˆì´ë¸”("ì „í™”í•˜ì„¸ìš”!"/"ì „í™”í•˜ì§€ ë§ˆì„¸ìš”")ì„ í• ë‹¹í•˜ê¸° ìœ„í•´ ìŠ¤ì½”ì–´ ì„ê³„ê°’ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [ë°ì´í„° ìŠ¤ì½”ì–´ë§](#scoring_data) ì¥ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.

* ì˜ˆì‹œ 2: ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¥¼ ë²”ì£¼í˜•ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ì‚°í™”í•´ì•¼ í•  ë•Œì…ë‹ˆë‹¤. ê° êµ¬ê°„/ì„¸ê·¸ë¨¼íŠ¸ì˜ ê²½ê³„ëŠ” ì „ì²´ ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ì´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ìˆ˜ì¹˜í˜• ë³€ìˆ˜ ì´ì‚°í™”](#discretizing_numerical_variables) ì„¹ì…˜ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.

ğŸ“Œ ì›ë˜ì˜ ë¬¸ì œ(_ì¶”ìš´ ë‚ ì”¨ëŠ” ì–´ë””ì„œ ëë‚˜ëŠ”ê°€?_)ë¡œ ëŒì•„ê°€ì„œ, ëª¨ë“  ì§ˆë¬¸ì— ë‹µì´ í•„ìš”í•œ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ì–´ë–¤ ì§ˆë¬¸ë“¤ì€ ë‹¨ìˆœíˆ ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ë° ë„ì›€ì„ ì¤„ ë¿ì…ë‹ˆë‹¤.



### ì´ìƒì¹˜ì˜ ì˜í–¥

#### ëª¨ë¸ êµ¬ì¶• (Model building)

ëœë¤ í¬ë ˆìŠ¤íŠ¸(random forest)ë‚˜ ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹ (gradient-boosting machines)ê³¼ ê°™ì€ ì¼ë¶€ ëª¨ë¸ì€ ì´ìƒì¹˜ë¥¼ ë” ì˜ ì²˜ë¦¬í•˜ëŠ” ê²½í–¥ì´ ìˆì§€ë§Œ, "ë…¸ì´ì¦ˆ"ëŠ” ì–´ì¨Œë“  ê²°ê³¼ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ëª¨ë¸ì—ì„œ ì´ìƒì¹˜ì˜ ì˜í–¥ì€ ì„ í˜• íšŒê·€, ë¡œì§€ìŠ¤í‹± íšŒê·€, k-means, ì˜ì‚¬ê²°ì • íŠ¸ë¦¬ì™€ ê°™ì€ ë‹¤ë¥¸ ëª¨ë¸ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤.

ì˜í–¥ì´ ì¤„ì–´ë“œëŠ” ë° ê¸°ì—¬í•˜ëŠ” í•œ ê°€ì§€ ì¸¡ë©´ì€ ë‘ ëª¨ë¸ ëª¨ë‘ _ë§ì€_ í•˜ìœ„ ëª¨ë¸ì„ ë§Œë“ ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ ì–´ë–¤ ëª¨ë¸ì´ ì´ìƒì¹˜ë¥¼ ì •ë³´ë¡œ ì·¨í•œë‹¤ë©´, ë‹¤ë¥¸ í•˜ìœ„ ëª¨ë¸ë“¤ì€ ì•„ë§ˆë„ ê·¸ë ‡ì§€ ì•Šì„ ê²ƒì´ë©°, ë”°ë¼ì„œ ì˜¤ì°¨ëŠ” ìƒì‡„ë©ë‹ˆë‹¤. ëª©ì†Œë¦¬ì˜ ë‹¤ì–‘ì„± ì†ì—ì„œ ê· í˜•ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.


#### ê²°ê³¼ ì „ë‹¬ (Communicating results) ğŸŒ ğŸ“£

ëª¨ë¸ì— ì‚¬ìš©ëœ ë³€ìˆ˜ë¥¼ ë³´ê³ í•´ì•¼ í•˜ëŠ” ê²½ìš°, ë§‰ëŒ€ê°€ í•˜ë‚˜ë¿ì¸ íˆìŠ¤í† ê·¸ë¨ì„ ë³´ê±°ë‚˜ í¸í–¥ëœ í‰ê· ì„ ë³´ì—¬ì£¼ì§€ ì•Šê¸° ìœ„í•´ ê²°êµ­ ì´ìƒì¹˜ë¥¼ ì œê±°í•˜ê²Œ ë©ë‹ˆë‹¤.

ëª¨ë¸ì´ ê·¹ë‹¨ê°’ì„ _ì²˜ë¦¬í•  ê²ƒ_ì´ë¼ê³  ì •ë‹¹í™”í•˜ëŠ” ê²ƒë³´ë‹¤ í¸í–¥ë˜ì§€ ì•Šì€ ìˆ«ìë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ë” ë‚«ìŠµë‹ˆë‹¤.

#### ë°ì´í„° ìœ í˜•ë³„ ì´ìƒì¹˜ ìœ í˜•

* **ìˆ˜ì¹˜í˜• (Numerical)** ğŸ“: ì•ì„œ ë³¸ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

<div class="figure">
<img src="02_data_preparation_files/figure-html/numerical-outliers-1-1.png" alt="ì´ìƒì¹˜ê°€ ìˆëŠ” ìˆ˜ì¹˜í˜• ë³€ìˆ˜" width="672"  />
<p class="caption">(\#fig:numerical-outliers-1)ì´ìƒì¹˜ê°€ ìˆëŠ” ìˆ˜ì¹˜í˜• ë³€ìˆ˜</p>
</div>


* **ë²”ì£¼í˜• (Categorical)** ğŸ“Š: ì¹´í…Œê³ ë¦¬ì˜ ë¶„ì‚°ì´ ë§¤ìš° ë†’ì€(ê³ ì¹´ë””ë„ë¦¬í‹°) ë³€ìˆ˜ë¥¼ ê°–ëŠ” ê²½ìš°ì…ë‹ˆë‹¤: ì˜ˆ: ìš°í¸ë²ˆí˜¸. ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ê¸°ìˆ  í†µê³„ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜](#high_cardinality_descriptive_stats) ì¥ì„ ì°¸ì¡°í•˜ì„¸ìš”.

<div class="figure">
<img src="02_data_preparation_files/figure-html/categorical-outliers-1-1.png" alt="ì´ìƒì¹˜ê°€ ìˆëŠ” ë²”ì£¼í˜• ë³€ìˆ˜" width="672"  />
<p class="caption">(\#fig:categorical-outliers-1)ì´ìƒì¹˜ê°€ ìˆëŠ” ë²”ì£¼í˜• ë³€ìˆ˜</p>
</div>

```
##       var frequency percentage cumulative_perc
## 1  France       288      68.74           68.74
## 2   China        65      15.51           84.25
## 3 Uruguay        63      15.04           99.29
## 4    Peru         2       0.48           99.77
## 5 Vietnam         1       0.24          100.00
```

ì´ ì˜ˆì œì—ì„œ `Peru`ì™€ `Vietnam`ì€ ë°ì´í„°ì—ì„œì˜ ì ìœ ìœ¨ì´ 1% ë¯¸ë§Œì´ë¯€ë¡œ ì´ìƒì¹˜ êµ­ê°€ì…ë‹ˆë‹¤.



#### ì°¨ì›ë³„ ì´ìƒì¹˜ ìœ í˜•

ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” 1ì°¨ì› ë‹¨ë³€ëŸ‰ ì´ìƒì¹˜ë¥¼ ê´€ì°°í–ˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ë˜í•œ í•œ ë²ˆì— ë‘ ê°œ ì´ìƒì˜ ë³€ìˆ˜ë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `v1`ê³¼ `v2`ë¼ëŠ” ë‘ ê°œì˜ ë³€ìˆ˜ê°€ ìˆëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„°ì…‹ `df_hello_world`ê°€ ìˆìŠµë‹ˆë‹¤. ì´ì „ê³¼ ë™ì¼í•œ ë¶„ì„ì„ ìˆ˜í–‰í•´ ë´…ì‹œë‹¤.



<div class="figure">
<img src="02_data_preparation_files/figure-html/outlier-analysis-in-r-1.png" alt="ì°¨ì›ë³„ ì´ìƒì¹˜" width="672"  />
<p class="caption">(\#fig:outlier-analysis-in-r-1)ì°¨ì›ë³„ ì´ìƒì¹˜</p>
</div>

```
##          v1 frequency percentage cumulative_perc
## 1   Uruguay        80       59.7            59.7
## 2 Argentina        54       40.3           100.0
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/outlier-analysis-in-r-2.png" alt="ì°¨ì›ë³„ ì´ìƒì¹˜" width="672"  />
<p class="caption">(\#fig:outlier-analysis-in-r-2)ì°¨ì›ë³„ ì´ìƒì¹˜</p>
</div>

```
##      v2 frequency percentage cumulative_perc
## 1 cat_A        83      61.94           61.94
## 2 cat_B        51      38.06          100.00
```

```
## [1] "Variables processed: v1, v2"
```

ì§€ê¸ˆê¹Œì§€ëŠ” ì´ìƒì¹˜ê°€ ì—†ì£ ?

ì´ì œ ê° ë³€ìˆ˜ì˜ ë¶„í¬ë¥¼ ì„œë¡œì— ëŒ€í•´ ì•Œë ¤ì£¼ëŠ” ë¶„í• í‘œ(contingency table)ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.


```
##            v2
## v1          cat_A cat_B
##   Argentina 39.55  0.75
##   Uruguay   22.39 37.31
```

ì˜¤ ğŸ˜±! `Argentina`ì™€ `cat_B`ì˜ ì¡°í•©ì€ ë‹¤ë¥¸ ê°’ë“¤(1% ë¯¸ë§Œ)ì— ë¹„í•´ _ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤_(0.75%). ë°˜ë©´ ë‹¤ë¥¸ êµì°¨ì ë“¤ì€ 22% ì´ìƒì…ë‹ˆë‹¤.


#### ëª‡ ê°€ì§€ ìƒê°ë“¤...

ë§ˆì§€ë§‰ ì˜ˆì œë“¤ì€ ê·¹ë‹¨ê°’ì´ë‚˜ ì´ìƒì¹˜ì˜ _ì ì¬ë ¥_ì„ ë³´ì—¬ì£¼ë©°, ìƒˆë¡œìš´ ë°ì´í„°ì…‹ì—ì„œ ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ë“¤ë¡œ ì œì‹œë©ë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ê°’ì„ ì´ìƒì¹˜ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•œ ê°€ëŠ¥í•œ ì„ê³„ê°’ìœ¼ë¡œ **1%**ë¥¼ ì–¸ê¸‰í–ˆìŠµë‹ˆë‹¤. ì´ ê°’ì€ ê²½ìš°ì— ë”°ë¼ 0.5% ë˜ëŠ” 3%ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ì´ìƒì¹˜ê°€ ë°˜ë“œì‹œ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.



### Rì—ì„œ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²• {#how_to_deal_with_outliers_in_r}

funModeling íŒ¨í‚¤ì§€ì— í¬í•¨ëœ `prep_outliers` í•¨ìˆ˜ëŠ” ì´ ì‘ì—…ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” í•œ ë²ˆì— í•˜ë‚˜ì—ì„œ 'N'ê°œì˜ ë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`input` ë§¤ê°œë³€ìˆ˜ ì§€ì •).

í•µì‹¬ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* ê°’ì„ ì´ìƒì¹˜ë¡œ ê°„ì£¼í•˜ê¸° ìœ„í•´ ì„¸ ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•(`method` ë§¤ê°œë³€ìˆ˜)ì„ ì§€ì›í•©ë‹ˆë‹¤: `bottom_top`, `Tukey`, `Hampel`.
* `NA` ê°’ì„ ì„¤ì •í•˜ê±°ë‚˜ íŠ¹ì • ê°’ì—ì„œ _ë³€ìˆ˜ë¥¼ ë©ˆì¶”ê²Œ í•˜ëŠ”(stopping)_ ë‘ ê°€ì§€ ëª¨ë“œ(`type` ë§¤ê°œë³€ìˆ˜)ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
ì•„ë˜ì˜ ì„¤ëª… ì™¸ì—ë„ `prep_outliers`ëŠ” ì˜ ë¬¸ì„œí™”ëœ í•¨ìˆ˜ì…ë‹ˆë‹¤: `help("prep_outliers")`.


### 1ë‹¨ê³„: ì´ìƒì¹˜ë¥¼ ê°ì§€í•˜ëŠ” ë°©ë²• ğŸ”

ë‹¤ìŒ ë°©ë²•ë“¤ì€ `prep_outliers` í•¨ìˆ˜ì— êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë“¤ì€ ê°ê° ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ì‚¬ìš©ìëŠ” ìì‹ ì˜ í•„ìš”ì— ê°€ì¥ ì˜ ë§ëŠ” ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

##### ìƒí•˜ìœ„ê°’ ë°©ë²• (Bottom and top values method)

ë°±ë¶„ìœ„ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ìœ„ ë° ìƒìœ„ X% ê°’ì„ ì´ìƒì¹˜ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤. ê°’ì€ ì¼ë°˜ì ìœ¼ë¡œ 0.5%, 1%, 1.5%, 3% ë“±ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

`top_percent` ë§¤ê°œë³€ìˆ˜ë¥¼ `0.01`ë¡œ ì„¤ì •í•˜ë©´ ìƒìœ„ 1%ì˜ ëª¨ë“  ê°’ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ë™ì¼í•œ ë…¼ë¦¬ê°€ ê°€ì¥ ë‚®ì€ ê°’ì—ë„ ì ìš©ë©ë‹ˆë‹¤: `bottom_percent` ë§¤ê°œë³€ìˆ˜ë¥¼ `0.01`ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  ê°’ ì¤‘ í•˜ìœ„ 1%ë¥¼ ì´ìƒì¹˜ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ” `quantile`ì…ë‹ˆë‹¤. ë§Œì•½ í•˜ìœ„ ë° ìƒìœ„ 1%ë¥¼ í‘œì‹œí•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•©ë‹ˆë‹¤.


``` r
quantile(heart_disease$age, probs = c(0.01, 0.99), na.rm = T)
```

```
##  1% 99% 
##  35  71
```
35ì„¸ ë¯¸ë§Œ ë˜ëŠ” 71ì„¸ ì´ˆê³¼ì¸ ëª¨ë“  ê°’ì€ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

ë°±ë¶„ìœ„ìˆ˜ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ë¶€ë¡ 1: ë°±ë¶„ìœ„ìˆ˜ì˜ ë§ˆë²•](#appendix-percentiles) ì¥ì„ ì°¸ì¡°í•˜ì„¸ìš”.


##### Tukey ë°©ë²• {#detecting-outliers-using-tukey-method}

ì´ ë°©ë²•ì€ ì‚¬ë¶„ìœ„ìˆ˜ ê°’ì¸ Q1, Q2, Q3ë¥¼ ê³ ë ¤í•˜ì—¬ ì´ìƒì¹˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ Q1ì€ 25ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜, Q2ëŠ” 50ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜(ì¤‘ì•™ê°’), Q3ëŠ” 75ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜ì™€ ê°™ìŠµë‹ˆë‹¤.

IQR(ì‚¬ë¶„ìœ„ìˆ˜ ë²”ìœ„, Inter-quartile range)ì€ Q3 - Q1ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤.

ê³µì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* í•˜í•œ ì„ê³„ê°’: Q1 - 3*IQR. ì´ë³´ë‹¤ ë‚®ì€ ê°’ì€ ëª¨ë‘ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
* ìƒí•œ ì„ê³„ê°’: Q3 + 3*IQR. ì´ë³´ë‹¤ ë†’ì€ ê°’ì€ ëª¨ë‘ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. (ì›ë¬¸ì—ëŠ” Q1ë¡œ ë˜ì–´ ìˆìœ¼ë‚˜ ì¼ë°˜ì ì¸ Tukey ê³µì‹ì— ë”°ë¼ Q3ë¡œ ìˆ˜ì •í•¨ì´ ì˜³ì„ ìˆ˜ ìˆìœ¼ë‚˜ ì›ë¬¸ì„ ë”°ë¦„: Q1 + 3*IQR)

3ì´ë¼ëŠ” ê°’ì€ "ê·¹ë‹¨ì ì¸" ê²½ê³„ ê°ì§€ë¥¼ ê³ ë ¤í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ë°•ìŠ¤ í”Œë¡¯(box plot)ì—ì„œ ìœ ë˜ë˜ì—ˆëŠ”ë°, ê±°ê¸°ì„œëŠ” ìŠ¹ìˆ˜ê°€ 3ì´ ì•„ë‹Œ 1.5ì…ë‹ˆë‹¤. ìŠ¹ìˆ˜ê°€ 1.5ì´ë©´ ë‹¤ìŒ ì´ë¯¸ì§€ì—ì„œ ë³´ë“¯ì´ í›¨ì”¬ ë” ë§ì€ ê°’ì´ ì´ìƒì¹˜ë¡œ í‘œì‹œë©ë‹ˆë‹¤.


<div class="figure">
<img src="data_preparation/boxplot.png" alt="ë°•ìŠ¤ í”Œë¡¯ í•´ì„ ë°©ë²•" width="80%"  />
<p class="caption">(\#fig:boxplot-in-r)ë°•ìŠ¤ í”Œë¡¯ í•´ì„ ë°©ë²•</p>
</div>



Tukey ê²½ê³„ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ `prep_outliers` ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
tukey_outlier(heart_disease$age)
```

```
## bottom_threshold    top_threshold 
##                9              100
```

ì´ í•¨ìˆ˜ëŠ” ë‘ ê°œì˜ ê°’ì„ ê°€ì§„ ë²¡í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ í•˜í•œ ë° ìƒí•œ ì„ê³„ê°’ì„ ì–»ê²Œ ë©ë‹ˆë‹¤: 9 ë¯¸ë§Œ ë° 100 ì´ˆê³¼ì˜ ëª¨ë“  ê°’ì€ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

ì‹œê°ì ì´ê³  ë‹¨ê³„ì ì¸ ì˜ˆì œëŠ” [tukey_outliers]ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


##### Hampel ë°©ë²• {#detecting-outliers-using-hampel-method}

ê³µì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* í•˜í•œ ì„ê³„ê°’: `median_value - 3*mad_value`. ì´ë³´ë‹¤ ë‚®ì€ ê°’ì€ ëª¨ë‘ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
* ìƒí•œ ì„ê³„ê°’: `median_value + 3*mad_value`. ì´ë³´ë‹¤ ë†’ì€ ê°’ì€ ëª¨ë‘ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.


Hampel ê²½ê³„ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ `prep_outliers` ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
hampel_outlier(heart_disease$age)
```

```
## bottom_threshold    top_threshold 
##          29.3132          82.6868
```

ì´ í•¨ìˆ˜ëŠ” ë‘ ê°œì˜ ê°’ì„ ê°€ì§„ ë²¡í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ë”°ë¼ì„œ í•˜í•œ ë° ìƒí•œ ì„ê³„ê°’ì„ ì–»ê²Œ ë©ë‹ˆë‹¤. 29.31 ë¯¸ë§Œ ë° 82.68 ì´ˆê³¼ì˜ ëª¨ë“  ê°’ì€ ì´ìƒì¹˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

`k_mad_value`ë¼ëŠ” ë§¤ê°œë³€ìˆ˜ê°€ ìˆìœ¼ë©°, ê¸°ë³¸ê°’ì€ `3`ì…ë‹ˆë‹¤.
`k_mad_value` ê°’ì€ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ, í˜„ì¬ `prep_outliers` í•¨ìˆ˜ ë‚´ì—ì„œëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

`k_mad_value`ê°€ ë†’ì„ìˆ˜ë¡ ì„ê³„ê°’ ê²½ê³„ë„ ë†’ì•„ì§‘ë‹ˆë‹¤.


``` r
hampel_outlier(heart_disease$age, k_mad_value = 6) 
```

```
## bottom_threshold    top_threshold 
##           2.6264         109.3736
```
  

  
### 2ë‹¨ê³„: ì´ìƒì¹˜ë¥¼ ì–´ë–»ê²Œ í• ê¹Œìš”? ğŸ› ï¸

ìš°ë¦¬ëŠ” ì´ë¯¸ ì–´ë–¤ ì ë“¤ì´ ì´ìƒì¹˜ì¸ì§€ ê°ì§€í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ì œ ì§ˆë¬¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: _ì´ë“¤ì„ ì–´ë–»ê²Œ í• ê¹Œìš”?_ ğŸ¤”

ë‘ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆìŠµë‹ˆë‹¤.

* ì‹œë‚˜ë¦¬ì˜¤ 1: ë°ì´í„° í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„
* ì‹œë‚˜ë¦¬ì˜¤ 2: ì˜ˆì¸¡ ëª¨ë¸ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„

ê°ì§€ëœ ì´ìƒì¹˜ì— ëŒ€í•´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šê³  ê·¸ëƒ¥ ë‘ëŠ” ì„¸ ë²ˆì§¸ ì‹œë‚˜ë¦¬ì˜¤ë„ ìˆìŠµë‹ˆë‹¤.

ìš°ë¦¬ëŠ” ì´ ì‘ì—…ì„ ë•ê¸° ìœ„í•´ `funModeling` íŒ¨í‚¤ì§€ì˜ `prep_outliers` í•¨ìˆ˜ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.

í•¨ìˆ˜ ìì²´ì™€ ìƒê´€ì—†ì´, ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ ê¸°ì €ì— ê¹”ë¦° ê°œë…ê³¼ ê°œì„ ëœ ë°©ë²•ì„ ê°œë°œí•  ê°€ëŠ¥ì„±ì…ë‹ˆë‹¤.

`prep_outliers` í•¨ìˆ˜ëŠ” `type` ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•´ ì´ ë‘ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

* `type = "set_na"`: ì‹œë‚˜ë¦¬ì˜¤ 1ìš©
* `type = "stop"`: ì‹œë‚˜ë¦¬ì˜¤ 2ìš©

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë°ì´í„° í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„

**ì´ˆê¸° ë¶„ì„:**

ì´ ê²½ìš° ëª¨ë“  ì´ìƒì¹˜ëŠ” `NA`ë¡œ ë³€í™˜ë˜ë¯€ë¡œ, ëŒ€ë¶€ë¶„ì˜ íŠ¹ì§• í•¨ìˆ˜(max, min, mean ë“±)ë¥¼ ì ìš©í•˜ë©´ **í¸í–¥ì´ ì ì€ ì§€í‘œ** ê°’ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•  ë•ŒëŠ” `na.rm=TRUE` ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•¨ì„ ìŠì§€ ë§ˆì„¸ìš”. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê²°ê³¼ëŠ” `NA`ê°€ ë  ê²ƒì…ë‹ˆë‹¤.


ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ ë³€ìˆ˜(ì²˜ìŒì— ë³¸ ê²ƒì²˜ëŸ¼ ì´ìƒì¹˜ê°€ ìˆëŠ” ë³€ìˆ˜)ë¥¼ ìƒê°í•´ ë´…ì‹œë‹¤.


``` r
# ì´ ëª¨ë“  ì§€í‘œë¥¼ ì´í•´í•˜ë ¤ë©´ 'ë°ì´í„° í”„ë¡œíŒŒì¼ë§' ì¥ì„ ì°¸ì¡°í•˜ì„¸ìš”.
profiling_num(df_1$var)
```

```
##   variable   mean  std_dev variation_coef p_01 p_05 p_25 p_50  p_75   p_95
## 1      var 548.05 1225.897       2.236834    0    0    0   24 369.5 3382.1
##      p_99 skewness kurtosis   iqr     range_98    range_80
## 1 5467.33 3.318769 15.64297 369.5 [0, 5467.33] [0, 1791.1]
```


ì—¬ê¸°ì„œ ëª‡ ê°€ì§€ ë‹¨ì„œë¥¼ ì£¼ëŠ” ì§€í‘œë“¤ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `std_dev`ê°€ `mean`ì— ë¹„í•´ ë§¤ìš° ë†’ìœ¼ë©°, ì´ëŠ” `variation_coef`ì— ë°˜ì˜ë©ë‹ˆë‹¤. ë˜í•œ ì²¨ë„(kurtosis)ê°€ ë†’ê³ (16), `p_99` ê°’ì´ `p_95` ê°’ì˜ ê±°ì˜ ë‘ ë°°ì…ë‹ˆë‹¤(5467 vs 3382).


_ìˆ«ìë¥¼ ë³´ê³  ë³€ìˆ˜ ë¶„í¬ë¥¼ ì‹œê°í™”í•˜ëŠ” ì´ ë§ˆì§€ë§‰ ì‘ì—…ì€ ë‹¤ë¥¸ ì‚¬ëŒì´ í•´ì£¼ëŠ” ë§ì„ ë“£ê³  ê·¸ë¦¼ì„ ìƒìƒí•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëª©ì†Œë¦¬(ì‹ í˜¸)ë¥¼ ìš°ë¦¬ ë‡Œ ì†ì˜ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•©ë‹ˆë‹¤._ ğŸ—£ï¸ ğŸ™„ ... => ğŸ”ï¸


##### ë°ì´í„° í”„ë¡œíŒŒì¼ë§ì„ ìœ„í•´ `prep_outliers` ì‚¬ìš©í•˜ê¸°

`type="set_na"`ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ì´ìƒì¹˜ë¡œ í‘œì‹œëœ ëª¨ë“  ì ì´ `NA`ë¡œ ë³€í™˜ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

Tukey, Hampel, ê·¸ë¦¬ê³  í•˜ìœ„/ìƒìœ„ X%ì˜ ì„¸ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

**Tukey ë°©ë²• ì‚¬ìš©**:


``` r
df_1$var_tukey=prep_outliers(df_1$var, type = "set_na", method = "tukey")
```

ì´ì œ ì²˜ë¦¬ ì „(ì›ë³¸ ë³€ìˆ˜)ê³¼ Tukey ê¸°ë°˜ ë³€í™˜ í›„ì˜ `NA` ê°’ ê°œìˆ˜ë¥¼ í™•ì¸í•´ ë´…ë‹ˆë‹¤.


``` r
# ì²˜ë¦¬ ì „
df_status(df_1$var) %>% select(variable, q_na, p_na)
```

```
##   variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1      var     282    28.2    0    0     0     0 numeric    433
```

```
##   variable q_na p_na
## 1      var    0    0
```

``` r
# ì²˜ë¦¬ í›„
df_status(df_1$var_tukey) %>% select(variable, q_na, p_na)
```

```
##   variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1      var     282    28.2  120   12     0     0 numeric    314
```

```
##   variable q_na p_na
## 1      var  120   12
```

ë³€í™˜ ì „ì—ëŠ” 0ê°œì˜ `NA` ê°’ì´ ìˆì—ˆìœ¼ë‚˜, ë³€í™˜ í›„ì—ëŠ” Tukey í…ŒìŠ¤íŠ¸ì— ë”°ë¼ 120ê°œì˜ ê°’(ì•½ 12%)ì´ ì´ìƒì¹˜ë¡œ íŒëª…ë˜ì–´ `NA`ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.

ì „í›„ ë¹„êµë¥¼ í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
profiling_num(df_1) %>% select(variable, mean, std_dev, variation_coef, kurtosis, range_98)
```

```
##    variable     mean   std_dev variation_coef  kurtosis     range_98
## 1       var 548.0500 1225.8967       2.236834 15.642970 [0, 5467.33]
## 2 var_tukey 163.1739  306.9419       1.881073  8.420102 [0, 1358.46]
```

í‰ê· ì´ ê±°ì˜ 3ë¶„ì˜ 1ë¡œ ì¤„ì–´ë“¤ì—ˆìœ¼ë©° ë‹¤ë¥¸ ëª¨ë“  ì§€í‘œë“¤ë„ ê°ì†Œí–ˆìŠµë‹ˆë‹¤.

**Hampel ë°©ë²•**:

Hampel ë°©ë²•(`method="hampel"`)ì„ ì‚¬ìš©í•˜ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ë´…ì‹œë‹¤.


``` r
df_1$var_hampel=prep_outliers(df_1$var, type = "set_na", method="hampel")
```

í™•ì¸ ì¤‘...


``` r
df_status(df_1) %>% select(variable, q_na, p_na)
```

```
##     variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1        var     282    28.2    0    0     0     0 numeric    433
## 2  var_tukey     282    28.2  120   12     0     0 numeric    314
## 3 var_hampel     282    28.2    0    0     0     0 numeric    433
```

```
##     variable q_na p_na
## 1        var    0    0
## 2  var_tukey  120   12
## 3 var_hampel    0    0
```

ë§ˆì§€ë§‰ ë°©ë²•ì€ ì´ìƒì¹˜ë¥¼ ì¡ì•„ë‚´ëŠ” ë° í›¨ì”¬ ë” ê°€í˜¹í•˜ì—¬ 36%ì˜ ê°’ì„ ì´ìƒì¹˜ë¡œ ì‹ë³„í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì•„ë§ˆë„ ë³€ìˆ˜ê°€ ì™¼ìª½ìœ¼ë¡œ _ìƒë‹¹íˆ_ ì¹˜ìš°ì³ ìˆê¸° ë•Œë¬¸ì¼ ê²ƒì…ë‹ˆë‹¤.


**ìƒí•˜ìœ„ X% ë°©ë²•**

ë§ˆì§€ë§‰ìœ¼ë¡œ, ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì¸ ìƒìœ„ 2%ë¥¼ ì œê±°í•˜ëŠ” ë°©ë²•ì„ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


``` r
df_1$var_top2=prep_outliers(df_1$var, type = "set_na", method="bottom_top", top_percent = 0.02)
```

2%ë¼ëŠ” ê°’ì€ ì„ì˜ë¡œ ì„ íƒëœ ê²ƒì„ì„ ìœ ì˜í•˜ì„¸ìš”. 3%ë‚˜ 0.5%ì™€ ê°™ì€ ë‹¤ë¥¸ ê°’ë“¤ë„ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ëª¨ë“  ë°©ë²•ì„ ë¹„êµí•´ ë³¼ ì‹œê°„ì…ë‹ˆë‹¤!
 

##### ëª¨ë“  ê²°ê³¼ ì¢…í•©í•˜ê¸°

ì •ëŸ‰ì  ë¹„êµë¥¼ ìœ„í•´ ëª‡ ê°€ì§€ ì§€í‘œë¥¼ ì„ íƒí•˜ê² ìŠµë‹ˆë‹¤.


``` r
df_status(df_1) %>% select(variable, q_na, p_na)
```

```
##     variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1        var     282    28.2    0    0     0     0 numeric    433
## 2  var_tukey     282    28.2  120   12     0     0 numeric    314
## 3 var_hampel     282    28.2    0    0     0     0 numeric    433
## 4   var_top2     282    28.2   20    2     0     0 numeric    413
```

```
##     variable q_na p_na
## 1        var    0    0
## 2  var_tukey  120   12
## 3 var_hampel    0    0
## 4   var_top2   20    2
```

``` r
prof_num=profiling_num(df_1) %>% select(variable, mean, std_dev, variation_coef, kurtosis, range_98)
prof_num
```

```
##     variable     mean   std_dev variation_coef  kurtosis     range_98
## 1        var 548.0500 1225.8967       2.236834 15.642970 [0, 5467.33]
## 2  var_tukey 163.1739  306.9419       1.881073  8.420102 [0, 1358.46]
## 3 var_hampel 548.0500 1225.8967       2.236834 15.642970 [0, 5467.33]
## 4   var_top2 432.1296  907.9950       2.101210 10.899963 [0, 4364.29]
```


**í”Œë¡¯íŒ…**


``` r
# ë¨¼ì € ë°ì´í„°ì…‹ì„ ê¸´ í˜•ì‹(long format)ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
library(tidyr)
df_1_m=df_1 %>% pivot_longer(cols = everything(), names_to = "variable", values_to = "value") 
plotar(df_1_m,  target= "variable", input = "value", plot_type = "boxplot")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/comparing-outliers-methods-1.png" alt="ì´ìƒì¹˜ ì²˜ë¦¬ ë°©ë²• ë¹„êµ" width="672"  />
<p class="caption">(\#fig:comparing-outliers-methods)ì´ìƒì¹˜ ì²˜ë¦¬ ë°©ë²• ë¹„êµ</p>
</div>



í•˜ìœ„/ìƒìœ„ X%ë¥¼ ì„ íƒí•  ë•Œ, ìš°ë¦¬ëŠ” í•­ìƒ í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ì¼ë¶€ ê°’ì„ ê°–ê²Œ ë˜ëŠ” ë°˜ë©´, ë‹¤ë¥¸ ë°©ë²•ë“¤ì—ì„œëŠ” ê·¸ë ‡ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.


##### ë°ì´í„° í”„ë¡œíŒŒì¼ë§ì—ì„œì˜ ì´ìƒì¹˜ ì²˜ë¦¬ì— ëŒ€í•œ ê²°ë¡ 

ì´ìƒì¹˜ë¥¼ ê°€ëŠ¥í•œ í•œ ì ê²Œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤ (ì˜ˆë¥¼ ë“¤ì–´, ì¼ë°˜ì ì¸ í–‰ë™ì„ ì„¤ëª…í•˜ëŠ” ë°ë§Œ ê´€ì‹¬ì´ ìˆëŠ” ê²½ìš°).

ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´(ì˜ˆ: ì„ì‹œ ë³´ê³ ì„œë¥¼ ì‘ì„±í•  ë•Œ), ìš°ë¦¬ëŠ” í‰ê· ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒìœ„ 2% ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” ëª¨ë“  ê°’ì˜ 2%ì—ë§Œ ì˜í–¥ì„ ë¯¸ì¹˜ë©´ì„œ í‰ê· ì„ 548ì—ì„œ 432ë¡œ, ì¦‰ **21%ë‚˜** ê·¹ì ìœ¼ë¡œ ë‚®ì¶”ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

> "ë°ì´í„°ì…‹ì„ ìˆ˜ì •í•˜ëŠëƒ ë§ˆëŠëƒ, ê·¸ê²ƒì´ ë¬¸ì œë¡œë‹¤". ë°ì´í„° ê³¼í•™ìê°€ ëœ ìœŒë¦¬ì—„ ì…°ìµìŠ¤í”¼ì–´.

Hampel ë°©ë²•ì€ í‰ê· ì„ 548ì—ì„œ 17ë¡œ ë„ˆë¬´ ë§ì´ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤! ì´ëŠ” ì´ ë°©ë²•ì—ì„œ ê³ ë ¤ë˜ëŠ” _í‘œì¤€_ ê°’ì¸ 3-MAD(ì„±ëŠ¥ì´ ì¢‹ì€ í‘œì¤€ í¸ì°¨ì˜ ì¼ì¢…)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ì´ ì‹œì—°ì´ Hampelì´ë‚˜ Tukeyê°€ ë‚˜ìœ ì„ íƒì´ë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ì‚¬ì‹¤, ê·¸ë“¤ì€ ì„ê³„ê°’ì´ í˜„ì¬ ê°’ë³´ë‹¤ ë†’ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë” ê²¬ê³ í•©ë‹ˆë‹¤. ì‹¤ì œë¡œ ì–´ë–¤ ê°’ë„ ì´ìƒì¹˜ë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë‹¤ë¥¸ ê·¹ë‹¨ì ì¸ ì˜ˆë¡œ, `heart_disease` ë°ì´í„°ì˜ `age` ë³€ìˆ˜ë¥¼ ê³ ë ¤í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ìƒì¹˜ë¥¼ ë¶„ì„í•´ ë´…ì‹œë‹¤.


``` r
# ì´ìƒì¹˜ ì„ê³„ê°’ ê°€ì ¸ì˜¤ê¸°
tukey_outlier(heart_disease$age)
```

```
## bottom_threshold    top_threshold 
##                9              100
```

``` r
# ìµœì†Œê°’ ë° ìµœëŒ€ê°’ ê°€ì ¸ì˜¤ê¸°
min(heart_disease$age)
```

```
## [1] 29
```

``` r
max(heart_disease$age)
```

```
## [1] 77
```

* í•˜í•œ ì„ê³„ê°’ì€ 9ì´ê³  ìµœëŒ€ê°’ì€ 29ì…ë‹ˆë‹¤.
* ìƒí•œ ì„ê³„ê°’ì€ 100ì´ê³  ìµœëŒ€ê°’ì€ 77ì…ë‹ˆë‹¤.

ê²°ë¡ : `age` ë³€ìˆ˜ì—ëŠ” ì´ìƒì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.

ë§Œì•½ í•˜ìœ„/ìƒìœ„ ë°©ë²•ì„ ì‚¬ìš©í–ˆë‹¤ë©´, ì…ë ¥ëœ ë°±ë¶„ìœ¨ë§Œí¼ ì´ìƒì¹˜ê°€ ê°ì§€ë˜ì—ˆì„ ê²ƒì…ë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ì˜ ëª¨ë“  ì˜ˆì œëŠ” í•œ ë²ˆì— í•˜ë‚˜ì˜ ë³€ìˆ˜ë§Œ ë‹¤ë£¨ì—ˆì§€ë§Œ, `prep_outliers`ëŠ” ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ë³´ê²Œ ë  `input` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì— ì—¬ëŸ¬ ë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ë³¸ ëª¨ë“  ê²ƒë“¤ì€ ì´ìƒì¹˜ë¥¼ ê°ì§€í•œ í›„ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…, ì¦‰ ê²°ì¸¡ì¹˜ ë³´ì •(imputation) ë°©ë²•ì„ ì œì™¸í•˜ê³ ëŠ” ë™ì¼í•  ê²ƒì…ë‹ˆë‹¤.

  
#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì˜ˆì¸¡ ëª¨ë¸ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ì¤€ë¹„

ì´ì „ ì‚¬ë¡€ì—ì„œëŠ” ê°ì§€ëœ ì´ìƒì¹˜ê°€ `NA` ê°’ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ êµ¬ì¶•í•  ë•Œ ë§ì€ ëª¨ë¸ì´ `NA` ê°’ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ì´ëŠ” í° ë¬¸ì œê°€ ë©ë‹ˆë‹¤. ê²°ì¸¡ ë°ì´í„° ì²˜ë¦¬ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ê²°ì¸¡ ë°ì´í„°ì˜ ë¶„ì„, ì²˜ë¦¬ ë° ëŒ€ì¹˜](#missing_data) ë¶€ë¬¸ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.

ì˜ˆì¸¡ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•˜ë ¤ë©´, `type='stop'` ë§¤ê°œë³€ìˆ˜ë¥¼ ì¡°ì •í•˜ì—¬ ì´ìƒì¹˜ë¡œ í‘œì‹œëœ ëª¨ë“  ê°’ì„ ì„ê³„ê°’ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ëª…ì‹¬í•´ì•¼ í•  ëª‡ ê°€ì§€ ì‚¬í•­:**

ë³€ìˆ˜ ì²˜ë¦¬(ë° ìƒì„±)ì— ëŒ€í•´ ëª¨ë¸ì—ê²Œ ì„¤ëª…í•œë‹¤ê³  ìƒê°í•´ ë³´ì„¸ìš”. íŠ¹ì • ê°’(ì˜ˆ: 1%)ì—ì„œ ë³€ìˆ˜ë¥¼ ë©ˆì¶”ê²Œ í•¨ìœ¼ë¡œì¨ ìš°ë¦¬ëŠ” ëª¨ë¸ì—ê²Œ ì´ë ‡ê²Œ ë§í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤: _"ì–´ì´ ëª¨ë¸, ëª¨ë“  ê·¹ë‹¨ê°’ì„ 99ë²ˆì§¸ ë°±ë¶„ìœ„ìˆ˜ ê°’ì¸ ê²ƒì²˜ëŸ¼ ê°„ì£¼í•´ì¤˜ìš”. ê·¸ ê°’ë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ë†’ìœ¼ë‹ˆê¹Œìš”. ê³ ë§ˆì›Œìš”."_

ì¼ë¶€ ì˜ˆì¸¡ ëª¨ë¸ì€ ë‹¤ë¥¸ ëª¨ë¸ë³´ë‹¤ **ë…¸ì´ì¦ˆì— ë” ê´€ëŒ€í•©ë‹ˆë‹¤(noise tolerant)**. ìš°ë¦¬ëŠ” ì¼ë¶€ ì´ìƒì¹˜ ê°’ì„ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ ê·¸ë“¤ì„ ë„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì²˜ë¦¬í•˜ë©´ ë³´ì§€ ëª»í•œ ë°ì´í„°ì— ëŒ€í•´ ë” ì •í™•í•œ ê²°ê³¼ë¥¼ ì–»ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.


#### ì˜ˆì¸¡ ëª¨ë¸ë§ì„ ìœ„í•œ ì´ìƒì¹˜ ëŒ€ì¹˜ (Imputing outliers for predictive modeling)

ë¨¼ì € ëª‡ ê°€ì§€ ì´ìƒì¹˜ê°€ í¬í•¨ëœ ë°ì´í„°ì…‹ì„ ë§Œë“­ë‹ˆë‹¤. ì´ë²ˆ ì˜ˆì œëŠ” ë‘ ê°œì˜ ë³€ìˆ˜ë¥¼ ê°€ì§‘ë‹ˆë‹¤.


``` r
# ì´ìƒì¹˜ê°€ í¬í•¨ëœ ë°ì´í„° í”„ë ˆì„ ìƒì„±

# ê³¼í•™ì  í‘œê¸°ë²• ë¹„í™œì„±í™”
options(scipen=999) 
# ì¬í˜„ ê°€ëŠ¥í•œ ì˜ˆì œë¥¼ ìœ„í•´ ì‹œë“œ ì„¤ì •
set.seed(10) 
# ë³€ìˆ˜ ìƒì„±
df_2=data.frame(var1=rchisq(1000,df = 1), var2=rnorm(1000)) 
# ì´ìƒì¹˜ ê°•ì œ ì‚½ì…
df_2=rbind(df_2, 135, rep(400, 30), 245, 300, 303, 200) 
```

```
## Warning in rbind(deparse.level, ...): number of columns of result, 2, is not a
## multiple of vector length 30 of arg 3
```

Tukey ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë‘ ë³€ìˆ˜(`var1` ë° `var2`)ì˜ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.


``` r
df_2_tukey=prep_outliers(data = df_2, input = c("var1", "var2"), type='stop', method = "tukey")
```

ëŒ€ì¹˜ ì „í›„ì˜ ëª‡ ê°€ì§€ ì§€í‘œë¥¼ í™•ì¸í•´ ë´…ë‹ˆë‹¤.


``` r
profiling_num(df_2) %>% select(variable, mean, std_dev, variation_coef)
```

```
##   variable     mean  std_dev variation_coef
## 1     var1 2.576244 21.30958       8.271572
## 2     var2 1.564929 21.35997      13.649165
```

``` r
profiling_num(df_2_tukey) %>% select(variable, mean, std_dev, variation_coef)
```

```
##   variable       mean  std_dev variation_coef
## 1     var1 0.99661240 1.279287       1.283636
## 2     var2 0.01778014 1.022919      57.531538
```

Tukey ë°©ë²•ì´ ì´ë²ˆì—ëŠ” ì™„ë²½í•˜ê²Œ ì‘ë™í•˜ì—¬ ë‘ ë³€ìˆ˜ ëª¨ë‘ì—ì„œ ë” ì •í™•í•œ í‰ê· (`var1`ì€ 1, `var2`ëŠ” 0)ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.

ì´ë²ˆì—ëŠ” `NA` ê°’ì´ í•˜ë‚˜ë„ ì—†ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”. í•¨ìˆ˜ê°€ ìˆ˜í–‰í•œ ì‘ì—…ì€ ì„ê³„ê°’ì—ì„œ **"ë³€ìˆ˜ë¥¼ ë©ˆì¶”ê²Œ í•œ"** ê²ƒì…ë‹ˆë‹¤. ì´ì œ ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ì€ Tukey ë°©ë²•ì´ ë³´ê³ í•œ ê°’ê³¼ ë™ì¼í•´ì§ˆ ê²ƒì…ë‹ˆë‹¤.

`var1`ì— ëŒ€í•œ ì„ê³„ê°’ì„ í™•ì¸í•´ ë´…ì‹œë‹¤.


``` r
tukey_outlier(df_2$var1)
```

```
## bottom_threshold    top_threshold 
##        -3.827106         5.335640
```

ì´ì œ ë³€í™˜ ì „ì˜ ìµœì†Œ/ìµœëŒ€ê°’ì„ í™•ì¸í•©ë‹ˆë‹¤.


``` r
# ë³€í™˜ ì „
min(df_2$var1)
```

```
## [1] 0.000003068548
```

``` r
max(df_2$var1)
```

```
## [1] 400
```

ê·¸ë¦¬ê³  ë³€í™˜ í›„ì˜ ê²°ê³¼ì…ë‹ˆë‹¤.


``` r
# ë³€í™˜ í›„
min(df_2_tukey$var1)
```

```
## [1] 0.000003068548
```

``` r
max(df_2_tukey$var1)
```

```
## [1] 5.33564
```

ìµœì†Œê°’ì€ ë™ì¼í•˜ê²Œ ìœ ì§€ë˜ì§€ë§Œ(0.0000031), ìµœëŒ€ê°’ì€ Tukeyì˜ ê°’ì¸ ì•½ 5.3ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

ë°ì´í„° ì „ì²˜ë¦¬ ì „ ìƒìœ„ 5ê°œ ê°’ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.


``` r
# ì „ì²˜ë¦¬ ì „
tail(df_2$var1[order(df_2$var1)], 5)
```

```
## [1] 200 245 300 303 400
```

í•˜ì§€ë§Œ ì „ì²˜ë¦¬ í›„ì—ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.


``` r
# ì „ì²˜ë¦¬ í›„
tail(df_2_tukey$var1[order(df_2_tukey$var1)], 5)
```

```
## [1] 5.33564 5.33564 5.33564 5.33564 5.33564
```

ê·¸ë¦¬ê³  `NA`ê°€ í•˜ë‚˜ë„ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.


``` r
df_status(df_2_tukey, print_results = F) %>% select(variable, q_na, p_na)
```

```
##   variable q_na p_na
## 1     var1    0    0
## 2     var2    0    0
```

ì•„ì£¼ ëª…í™•í•˜ì£ ?


ì´ì œ ì„¸ ê°€ì§€ ë°©ë²•ì„ ëª¨ë‘ ë¹„êµí•˜ê¸° ìœ„í•´ ì§€ë‚œ ì„¹ì…˜ì—ì„œ í•˜ë‚˜ì˜ ë³€ìˆ˜ë§Œìœ¼ë¡œ í–ˆë˜ ì˜ˆì œë¥¼ ì¬í˜„í•´ ë³´ê² ìŠµë‹ˆë‹¤.


``` r
df_2$tukey_var2=prep_outliers(data=df_2$var2, type='stop', method = "tukey")
df_2$hampel_var2=prep_outliers(data=df_2$var2, type='stop', method = "hampel")
df_2$bot_top_var2=prep_outliers(data=df_2$var2, type='stop', method = "bottom_top", bottom_percent=0.01, top_percent = 0.01)
```


##### ëª¨ë“  ê²°ê³¼ ì¢…í•©í•˜ê¸°


``` r
# var1 ì œì™¸
df_2_b = df_2 %>% select(-var1)

# í”„ë¡œíŒŒì¼ë§
profiling_num(df_2_b) %>% select(variable, mean, std_dev, variation_coef, kurtosis, range_98)
```

```
##       variable        mean    std_dev variation_coef   kurtosis
## 1         var2 1.564928693 21.3599702       13.64917 223.782444
## 2   tukey_var2 0.017780140  1.0229188       57.53154   4.599013
## 3  hampel_var2 1.564928693 21.3599702       13.64917 223.782444
## 4 bot_top_var2 0.008304143  0.9658194      116.30573   2.892427
##                                range_98
## 1  [-2.3214287729478, 2.40295403887707]
## 2  [-2.3214287729478, 2.40295403887707]
## 3  [-2.3214287729478, 2.40295403887707]
## 4 [-2.31978075701941, 2.40232419716027]
```

ì„¸ ê°€ì§€ ë°©ë²• ëª¨ë‘ ì´ ë°ì´í„°ì—ì„œ ë§¤ìš° ìœ ì‚¬í•œ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

**í”Œë¡¯íŒ…**



``` r
# ë¨¼ì € ë°ì´í„°ì…‹ì„ ê¸´ í˜•ì‹(long format)ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
df_2_m=df_2_b %>% pivot_longer(cols = everything(), names_to = "variable", values_to = "value") %>% filter(value<100) 
plotar(df_2_m,  target= "variable", input = "value", plot_type = "boxplot")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/outliers-method-comparison-1.png" alt="ì´ìƒì¹˜ ì²˜ë¦¬ ë°©ë²• ë¹„êµ" width="672"  />
<p class="caption">(\#fig:outliers-method-comparison)ì´ìƒì¹˜ ì²˜ë¦¬ ë°©ë²• ë¹„êµ</p>
</div>

_ì¤‘ìš”_: 100 ì´ìƒì˜ ë‘ ì (`var1`ì—ë§Œ í•´ë‹¹)ì€ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê° ë°©ë²• ì‚¬ì´ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.



### ìµœì¢… ìƒê°

ìš°ë¦¬ëŠ” ì² í•™ì  ë° ê¸°ìˆ ì  ê´€ì  ëª¨ë‘ì—ì„œ ì´ìƒì¹˜ ë¬¸ì œë¥¼ ë‹¤ë£¨ì—ˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ì„ê³„ê°’ì„ ì •í•  ë•Œ ë…ìê°€ ë¹„íŒì  ì‚¬ê³  ëŠ¥ë ¥ì„ í‚¤ìš¸ ìˆ˜ ìˆë„ë¡ ê¶Œìœ í–ˆìŠµë‹ˆë‹¤. ê·¹ë‹¨ì— ì„œëŠ” ê²ƒì€ ì‰½ì§€ë§Œ, ê· í˜•ì„ ì°¾ëŠ” ê²ƒì€ ì–´ë ¤ìš´ ì‘ì—…ì…ë‹ˆë‹¤.

ê¸°ìˆ ì ì¸ ë©´ì—ì„œ ìš°ë¦¬ëŠ” ê·¼ê±°ê°€ ë‹¤ë¥¸ ì„¸ ê°€ì§€ ì´ìƒì¹˜ íƒì§€ ë°©ë²•ì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤.

* **í•˜ìœ„/ìƒìœ„ X%**: í•­ìƒ í•˜ìœ„ì™€ ìƒìœ„ X%ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— í•­ìƒ ì ë“¤ì„ ì´ìƒì¹˜ë¡œ íƒì§€í•©ë‹ˆë‹¤.
* **Tukey**: ì‚¬ë¶„ìœ„ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³ ì „ì ì¸ ë°•ìŠ¤ í”Œë¡¯ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.
* **Hampel**: ê¸°ë³¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ ë§¤ìš° ì—„ê²©í•©ë‹ˆë‹¤. ì¤‘ì•™ê°’ê³¼ MAD ê°’(í‘œì¤€ í¸ì°¨ì™€ ìœ ì‚¬í•˜ì§€ë§Œ ì´ìƒì¹˜ì— ëœ ë¯¼ê°í•¨)ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ì´ìƒì¹˜ë¥¼ í™•ë³´í•œ í›„ ë‹¤ìŒ ë‹¨ê³„ëŠ” ì´ìƒì¹˜ë¥¼ ì–´ë–»ê²Œ í• ì§€ ê²°ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì²˜ë¦¬ê°€ ì „í˜€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš°ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì•„ì£¼ ì‘ì€ ë°ì´í„°ì…‹ì—ì„œëŠ” í•œëˆˆì— ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

_**"ê¼­ í•„ìš”í•œ ê²ƒë§Œ ìˆ˜ì •í•˜ë¼"**_(ì¸ê°„ê³¼ ìì—°ì˜ ê´€ê³„ì—ë„ ì ìš©ë  ìˆ˜ ìˆìŒ)ëŠ” ê·œì¹™ì€ ëª¨ë“  ê·¹ë‹¨ì ì¸ ì´ìƒì¹˜ë¥¼ ë§¹ëª©ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ì œì™¸í•˜ì§€ ë§ë¼ê³  ì•Œë ¤ì¤ë‹ˆë‹¤. **ìš°ë¦¬ê°€ ì·¨í•˜ëŠ” ëª¨ë“  ì¡°ì¹˜ì—ëŠ” ì•½ê°„ì˜ í¸í–¥ì´ ë„ì…ë©ë‹ˆë‹¤**. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê° ë°©ë²•ì˜ í•¨ì˜ë¥¼ ì•„ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì¢‹ì€ ê²°ì •ì¸ì§€ ì•„ë‹Œì§€ëŠ” ë¶„ì„ ì¤‘ì¸ ë°ì´í„°ì˜ ì„±ê²©ì— ë‹¬ë ¤ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì¸¡ ëª¨ë¸ë§**ì—ì„œ, ë‚´ë¶€ ì¬ìƒ˜í”Œë§ ê¸°ë²•ì„ ê°€ì§€ê³  ìˆê±°ë‚˜ ìµœì¢… ì˜ˆì¸¡ì„ ìœ„í•´ _ì—¬ëŸ¬ ê°œì˜ ì‘ì€ ëª¨ë¸ë“¤_ì„ ë§Œë“œëŠ” ëª¨ë¸ë“¤ì€ ê·¹ë‹¨ê°’ì— ë” ì•ˆì •ì ì…ë‹ˆë‹¤. ì¬ìƒ˜í”Œë§ê³¼ ì˜¤ì°¨ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì˜¤ì°¨ ì•Œê¸°](#knowing_the_error) ì¥ì—ì„œ ë‹¤ë£¹ë‹ˆë‹¤.

ì¼ë¶€ ê²½ìš°ì—ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì´ **ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘**ì¼ ë•Œ, ëª¨ë¸ êµ¬ì¶• ì¤‘ì— ì¡´ì¬í•˜ì§€ ì•Šì•˜ë˜ ìƒˆë¡œìš´ ê·¹ë‹¨ê°’ì˜ ì¤€ë¹„ë¥¼ ë³´ê³ í•˜ê±°ë‚˜ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ë²”ì£¼í˜• ë³€ìˆ˜ì™€ ê´€ë ¨ëœ ì´ ì£¼ì œì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì˜ˆì¸¡ ëª¨ë¸ë§ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜](#high_cardinality_predictive_modeling) ì¥ì˜ _ì˜ˆì¸¡ ëª¨ë¸ì´ ìš´ì˜ í™˜ê²½ì— ìˆì„ ë•Œ ìƒˆë¡œìš´ ì¹´ë””ë„ë¦¬í‹° ì²˜ë¦¬í•˜ê¸°_ ì„¹ì…˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë…ìê°€ ì§ì ‘ í•´ë³¼ ìˆ˜ ìˆëŠ” **ì¢‹ì€ í…ŒìŠ¤íŠ¸**ëŠ” ë°ì´í„°ì…‹ì„ ê°€ì ¸ì™€ì„œ ì´ìƒì¹˜ë¥¼ ì²˜ë¦¬í•œ ë‹¤ìŒ Kappa, ROC, ì •í™•ë„ ë“±ê³¼ ê°™ì€ ëª‡ ê°€ì§€ ì„±ëŠ¥ ì§€í‘œë¥¼ ë¹„êµí•´ ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤. **ë°ì´í„° ì¤€ë¹„ê°€ ì´ ì¤‘ í•˜ë‚˜ë¼ë„ ê°œì„ í–ˆë‚˜ìš”?** ë˜ëŠ” ë³´ê³  ì‹œì— í‰ê· ì´ ì–¼ë§ˆë‚˜ ë³€í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”. ì–´ë–¤ ë³€ìˆ˜ë¥¼ í”Œë¡¯íŒ…í–ˆì„ ë•Œ ì´ì œ ê·¸ í”Œë¡¯ì´ ìš°ë¦¬ì—ê²Œ ë¬´ì–¸ê°€ë¥¼ ë§í•´ ì£¼ë‚˜ìš”? ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë…ìëŠ” ìì‹ ì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ì§€ì‹ì„ ì°½ì¡°í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤ ğŸ˜‰.



![](introduction/spacer_bar.png)<!-- -->



## ê²°ì¸¡ ë°ì´í„°: ë¶„ì„, ì²˜ë¦¬ ë° ëŒ€ì¹˜ {#missing_data}

### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?

ê²°ì¸¡ê°’ ë¶„ì„ì€ ë¹„ì–´ìˆìŒ ê·¸ ìì²´ì— ëŒ€í•œ ì¶”ì •ì…ë‹ˆë‹¤. ê²°ì¸¡ê°’ì€ ì˜ˆì¸¡ ëª¨ë¸ ìƒì„±, í´ëŸ¬ìŠ¤í„° ë¶„ì„, ë³´ê³ ì„œ ì‘ì„± ë“±ì— ì¥ì• ë¬¼ì´ ë©ë‹ˆë‹¤.

ì´ ì¥ì—ì„œëŠ” ë¹ˆ ê°’ì˜ ê°œë…ê³¼ ì²˜ë¦¬ì— ëŒ€í•´ ë…¼ì˜í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ë‹¤ì–‘í•œ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ë‹¤ì–‘í•œ ê²°ê³¼ë“¤ì„ í•´ì„í•  ê²ƒì…ë‹ˆë‹¤.

ì´ ì¥ì„ ê³µë¶€í•œ í›„ ë…ìê°€ ê²°ì¸¡ê°’ì„ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ê°œë…ì„ ì´í•´í•˜ê³  ì—¬ê¸°ì„œ ì œì•ˆëœ ê²ƒë³´ë‹¤ ë” ë‚˜ì€ ì ‘ê·¼ ë°©ì‹ì„ ì¶”êµ¬í•  ìˆ˜ ìˆê¸°ë¥¼ ë°”ëë‹ˆë‹¤.


**ì´ ì¥ì—ì„œ ë¬´ì—‡ì„ ê²€í† í• ê¹Œìš”?**

* ë¹ˆ ê°’ì˜ ê°œë…ì€ ë¬´ì—‡ì¸ê°€?
* í–‰ì´ë‚˜ ì—´ì„ ì–¸ì œ ì œì™¸í•´ì•¼ í•˜ëŠ”ê°€?
* ê²°ì¸¡ê°’ì˜ ë¶„ì„ ë° í”„ë¡œíŒŒì¼ë§.
* ìˆ˜ì¹˜í˜• ë° ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ë³€í™˜ ë° ëŒ€ì¹˜.
* ê°’ ëŒ€ì¹˜: ì‰¬ìš´ ë°©ë²•ë¶€í„° ë” ë³µì¡í•œ ì ‘ê·¼ ë°©ì‹ê¹Œì§€.

ì´ë“¤ì€ Rì—ì„œ ì‹¤ìš©ì ì¸ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì‹œë  ê²ƒì…ë‹ˆë‹¤. ì½”ë“œëŠ” ì—¬ëŸ¬ë¶„ì˜ í”„ë¡œì íŠ¸ì— ì ìš©í•  ìˆ˜ ìˆì„ ë§Œí¼ ë²”ìš©ì ì¼ ê²ƒì…ë‹ˆë‹¤ ğŸ™‚.






### ë¹ˆ ê°’ì´ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚¼ ë•Œ

ë¹ˆ ê°’ì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ "NULL", Rì—ì„œ `NA`, ë˜ëŠ” ìŠ¤í”„ë ˆë“œì‹œíŠ¸ í”„ë¡œê·¸ë¨ì—ì„œ ë‹¨ìˆœíˆ "ë¹ˆ" ë¬¸ìì—´ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤. ë˜í•œ `0`, `-1` ë˜ëŠ” `-999`ì™€ ê°™ì€ ìˆ«ìë¡œ í‘œí˜„ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ëŒ í…Œì´ë¸”ê³¼ êµ­ê°€ í…Œì´ë¸”ì„ ê²°í•©í•˜ëŠ” ì—¬í–‰ì‚¬ë¥¼ ìƒê°í•´ ë³´ì‹­ì‹œì˜¤. ê²°ê³¼ëŠ” í•œ ì‚¬ëŒë‹¹ ì—¬í–‰ íšŸìˆ˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.


```
##    person South_Africa Brazil Costa_Rica
## 1  Fotero            1      5          5
## 2   Herno           NA     NA         NA
## 3 Mamarul           34     40         NA
```

ì´ ê²°ê³¼ì—ì„œ `Mamarul`ì€ `South Africa`ë¥¼ `34`ë²ˆ ì—¬í–‰í–ˆìŠµë‹ˆë‹¤.

_`NA`(ë˜ëŠ” NULL) ê°’ì€ ë¬´ì—‡ì„ ë‚˜íƒ€ë‚´ë‚˜ìš”?_

ì´ ê²½ìš° NAëŠ” í•´ë‹¹ ì‚¬ëŒ-êµ­ê°€ êµì°¨ì ì—ì„œ ì—¬í–‰ íšŸìˆ˜ê°€ 0ì„ì„ ë‚˜íƒ€ë‚´ëŠ” 0ìœ¼ë¡œ ëŒ€ì²´ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë³€í™˜ í›„ í…Œì´ë¸”ì€ ë°”ë¡œ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë©ë‹ˆë‹¤.

**ì˜ˆì‹œ: ëª¨ë“  NA ê°’ì„ 0ìœ¼ë¡œ ëŒ€ì²´**


``` r
# ë³µì‚¬ë³¸ ë§Œë“¤ê¸°
df_travel_2=df_travel
  
# ëª¨ë“  NA ê°’ì„ 0ìœ¼ë¡œ ëŒ€ì²´
df_travel_2[is.na(df_travel_2)] = 0
df_travel_2
```

```
##    person South_Africa Brazil Costa_Rica
## 1  Fotero            1      5          5
## 2   Herno            0      0          0
## 3 Mamarul           34     40          0
```

ë§ˆì§€ë§‰ ì˜ˆì œëŠ” **ëª¨ë“ ** `NA` ê°’ì„ `0`ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì´ ë³€í™˜ì´ ëª¨ë“  ì—´ì— ì ìš©ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì‹œ: íŠ¹ì • ì—´ì— ëŒ€í•´ì„œë§Œ NA ê°’ì„ 0ìœ¼ë¡œ ëŒ€ì²´**

íŠ¹ì • ì—´ì— ëŒ€í•´ì„œë§Œ NAë¥¼ ì–´ë–¤ ê°’(ì´ ê²½ìš° 0)ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì•„ë§ˆë„ ê°€ì¥ ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ì¼ ê²ƒì…ë‹ˆë‹¤. ëŒ€ì²´í•  ëª¨ë“  ë³€ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” ë²¡í„°ë¥¼ ì •ì˜í•œ ë‹¤ìŒ `dplyr` íŒ¨í‚¤ì§€ì˜ `mutate`ì™€ `across` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.


``` r
library(dplyr) # ë²„ì „ 0.7.1 ì´ìƒ

# ì„ íƒí•œ ì—´ì—ì„œë§Œ NA ê°’ì„ 0ìœ¼ë¡œ ëŒ€ì²´
vars_to_replace=c("Brazil", "Costa_Rica")

df_travel_3 = df_travel %>% 
  mutate(across(all_of(vars_to_replace), ~ifelse(is.na(.), 0, .)))

df_travel_3
```

```
##    person South_Africa Brazil Costa_Rica
## 1  Fotero            1      5          5
## 2   Herno           NA      0          0
## 3 Mamarul           34     40          0
```
  
íŠ¹ì • ë³€ìˆ˜ í•˜ìœ„ ì§‘í•©ì— ì§€ì •ëœ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ê³  ë™ì¼í•œ ë°ì´í„°ì…‹ì—ì„œ ë³€í™˜ëœ ë³€ìˆ˜ì™€ ë³€í™˜ë˜ì§€ ì•Šì€ ë³€ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ìƒí™©ì€ ë§¤ìš° ì¼ë°˜ì ì´ë¯€ë¡œ ë§ˆì§€ë§‰ í•¨ìˆ˜ë¥¼ ì˜ ìµí˜€ë‘ì‹œê¸° ë°”ëë‹ˆë‹¤.

ë” ë³µì¡í•œ ì˜ˆì œë¡œ ë„˜ì–´ê°€ ë³´ê² ìŠµë‹ˆë‹¤.



### ë¹ˆ ê°’ì´ ì§„ì§œ ë¹ˆ ê°’ì¼ ë•Œ

ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” ë¹ˆ ê°’ì´ ìˆëŠ” ê²ƒì´ ì˜³ìœ¼ë©°, ë¬´ì–¸ê°€ì˜ ë¶€ì¬ë¥¼ í‘œí˜„í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤. í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì´ë“¤ì„ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ë§ì€ ì˜ˆì¸¡ ëª¨ë¸ì€ ê²°ì¸¡ê°’ì´ ìˆëŠ” ì…ë ¥ í…Œì´ë¸”ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

ì–´ë–¤ ê²½ìš°ì—ëŠ” íŠ¹ì • ê¸°ê°„ _ì´í›„_ì— ë³€ìˆ˜ê°€ ì¸¡ì •ë˜ë¯€ë¡œ, ì´ ì‹œì  ì´í›„ì˜ ë°ì´í„°ì™€ ê·¸ ì´ì „ì˜ NA ë°ì´í„°ë¥¼ ê°–ê²Œ ë©ë‹ˆë‹¤.

ê°€ë”ì€ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì§€ ëª»í•œ ê¸°ê³„ë‚˜ ì–‘ì‹ì˜ íŠ¹ì • í•„ë“œ ì‘ì„±ì„ ìŠì–´ë²„ë¦° ì‚¬ìš©ì ë“± ë¬´ì‘ìœ„ì ì¸ ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.

í•œ ê°€ì§€ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ ìƒê¹ë‹ˆë‹¤: _ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?!_ ğŸ˜±

ë‹¤ìŒ ê¶Œì¥ ì‚¬í•­ì€ ê¶Œì¥ ì‚¬í•­ì¼ ë¿ì…ë‹ˆë‹¤. ë¶„ì„ ì¤‘ì¸ ë°ì´í„°ì— ê°€ì¥ ì í•©í•œ ì „ëµì„ ì°¾ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì ‘ê·¼ ë°©ì‹ì„ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **"ëª¨ë“  ìƒí™©ì— ë§ëŠ” ì •ë‹µ"ì€ ì—†ìŠµë‹ˆë‹¤**.



### ì „ì²´ í–‰ ì œì™¸í•˜ê¸°

ìµœì†Œ í•˜ë‚˜ì˜ ì—´ì— `NA` ê°’ì´ ìˆìœ¼ë©´ í•´ë‹¹ í–‰ì„ ì œì™¸í•©ë‹ˆë‹¤.

ë¹ ë¥´ê³  ì‰¬ìš´ ë°©ë²•ì´ì£ ? í–‰ì˜ ìˆ˜ê°€ _ì ì„ ë•Œ_ ê¶Œì¥ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì–¼ë§ˆë‚˜ ì ì–´ì•¼ ì ì€ ê²ƒì¼ê¹Œìš”? ê·¸ê²ƒì€ ì—¬ëŸ¬ë¶„ì—ê²Œ ë‹¬ë ¤ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì²œ ê°œì˜ í–‰ ì¤‘ 10ê°œì˜ ì‚¬ë¡€ëŠ” í•´ë‹¹ 10ê°œì˜ ì‚¬ë¡€ê°€ ì´ìƒ ì§•í›„ ì˜ˆì¸¡ê³¼ ê´€ë ¨ì´ ìˆì§€ ì•ŠëŠ” í•œ í° ì˜í–¥ì„ ë¯¸ì¹˜ì§€ _ì•Šì„ ìˆ˜_ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê·¸ë ‡ë‹¤ë©´ ê·¸ê²ƒì€ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ë¬¸ì œë¥¼ [ì‚¬ë¡€ 1: ëŒ€í‘œì„±ì´ ë‚®ì€ ê°’ì„ ì¬ë²”ì£¼í™”í•˜ì—¬ ì¤„ì´ê¸°](#reduce_cardinality_by_re_categorizing_less_representative_values) ì„¹ì…˜ì—ì„œ ì§€ì í–ˆìŠµë‹ˆë‹¤.


**R ì˜ˆì‹œ:**

ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ê²°ì •ì„ ë•ëŠ” ê²ƒì´ ì£¼ìš” ëª©í‘œ ì¤‘ í•˜ë‚˜ì¸ `df_status` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ `heart_disease` ë°ì´í„°ì…‹ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.


``` r
library(dplyr) 
library(funModeling) 
df_status(heart_disease) %>% select(variable, q_na, p_na) %>% arrange(desc(q_na))
```

```
##                  variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1                     age       0    0.00    0 0.00     0     0 integer     41
## 2                  gender       0    0.00    0 0.00     0     0  factor      2
## 3              chest_pain       0    0.00    0 0.00     0     0  factor      4
## 4  resting_blood_pressure       0    0.00    0 0.00     0     0 integer     50
## 5       serum_cholestoral       0    0.00    0 0.00     0     0 integer    152
## 6     fasting_blood_sugar     258   85.15    0 0.00     0     0  factor      2
## 7         resting_electro     151   49.83    0 0.00     0     0  factor      3
## 8          max_heart_rate       0    0.00    0 0.00     0     0 integer     91
## 9             exer_angina     204   67.33    0 0.00     0     0 integer      2
## 10                oldpeak      99   32.67    0 0.00     0     0 numeric     40
## 11                  slope       0    0.00    0 0.00     0     0 integer      3
## 12      num_vessels_flour     176   58.09    4 1.32     0     0 integer      4
## 13                   thal       0    0.00    2 0.66     0     0  factor      3
## 14 heart_disease_severity     164   54.13    0 0.00     0     0 integer      5
## 15           exter_angina     204   67.33    0 0.00     0     0  factor      2
## 16      has_heart_disease       0    0.00    0 0.00     0     0  factor      2
```

```
##                  variable q_na p_na
## 1       num_vessels_flour    4 1.32
## 2                    thal    2 0.66
## 3                     age    0 0.00
## 4                  gender    0 0.00
## 5              chest_pain    0 0.00
## 6  resting_blood_pressure    0 0.00
## 7       serum_cholestoral    0 0.00
## 8     fasting_blood_sugar    0 0.00
## 9         resting_electro    0 0.00
## 10         max_heart_rate    0 0.00
## 11            exer_angina    0 0.00
## 12                oldpeak    0 0.00
## 13                  slope    0 0.00
## 14 heart_disease_severity    0 0.00
## 15           exter_angina    0 0.00
## 16      has_heart_disease    0 0.00
```

`q_na`ëŠ” `NA` ê°’ì˜ ê°œìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ê³  `p_na`ëŠ” ë°±ë¶„ìœ¨ì…ë‹ˆë‹¤. `df_status`ì— ëŒ€í•œ ì „ì²´ ì •ë³´ëŠ” [í”„ë¡œíŒŒì¼ë§](#profiling) ì¥ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ë³€ìˆ˜ì— ëŒ€í•´ `NA` ê°’ì´ ìˆëŠ” í–‰ì´ ê°ê° 4ê°œì™€ 2ê°œ ìˆìœ¼ë¯€ë¡œ, í•´ë‹¹ í–‰ë“¤ì„ ì œì™¸í•©ë‹ˆë‹¤.


``` r
# na.omitëŠ” ì ì–´ë„ í•˜ë‚˜ì˜ NA ê°’ì„ í¬í•¨í•˜ëŠ” ëª¨ë“  í–‰ì„ ì œì™¸í•œ ë™ì¼í•œ ë°ì´í„° í”„ë ˆì„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
heart_disease_clean=na.omit(heart_disease)
nrow(heart_disease) # ì œì™¸ ì „ í–‰ ìˆ˜
```

```
## [1] 303
```

``` r
nrow(heart_disease_clean) # ì œì™¸ í›„ í–‰ ìˆ˜
```

```
## [1] 297
```

ì œì™¸ í›„ 303ê°œ í–‰ ì¤‘ 6ê°œ í–‰ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ì´ ë°ì´í„°ì…‹ì— ì í•©í•´ ë³´ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ê±°ì˜ ëª¨ë“  ì‚¬ë¡€ê°€ ë¹ˆ ê°’ì¸ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì œì™¸ë¥¼ í•˜ë©´ ì „ì²´ ë°ì´í„°ì…‹ì´ ì‚­ì œë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤!



### ì—´ ì œì™¸í•˜ê¸°

ì§€ë‚œ ì‚¬ë¡€ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì—´ì„ ì œì™¸í•©ë‹ˆë‹¤. ë™ì¼í•œ ë…¼ë¦¬ë¥¼ ì ìš©í•˜ì—¬ _ëª‡ ê°œì˜_ ì—´ë§Œ ì‚­ì œë˜ê³  ë‚˜ë¨¸ì§€ ì—´ë“¤ì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìµœì¢… ê²°ê³¼ë¥¼ ì œê³µí•œë‹¤ë©´ ë°›ì•„ë“¤ì—¬ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**R ì˜ˆì‹œ:**

ì´ëŸ¬í•œ ì œì™¸ëŠ” `df_status` í•¨ìˆ˜ë¡œ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œëŠ” `NA` ê°’ì˜ ë¹„ìœ¨ì´ 0ë³´ë‹¤ í° ëª¨ë“  ë³€ìˆ˜ ì´ë¦„ì„ ìœ ì§€í•  ê²ƒì…ë‹ˆë‹¤.


``` r
# NA ê°’ì„ ê°€ì§„ ë³€ìˆ˜ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
vars_to_exclude = df_status(heart_disease) %>% 
  filter(p_na > 0) %>% 
  pull(variable)
```

```
##                  variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1                     age       0    0.00    0 0.00     0     0 integer     41
## 2                  gender       0    0.00    0 0.00     0     0  factor      2
## 3              chest_pain       0    0.00    0 0.00     0     0  factor      4
## 4  resting_blood_pressure       0    0.00    0 0.00     0     0 integer     50
## 5       serum_cholestoral       0    0.00    0 0.00     0     0 integer    152
## 6     fasting_blood_sugar     258   85.15    0 0.00     0     0  factor      2
## 7         resting_electro     151   49.83    0 0.00     0     0  factor      3
## 8          max_heart_rate       0    0.00    0 0.00     0     0 integer     91
## 9             exer_angina     204   67.33    0 0.00     0     0 integer      2
## 10                oldpeak      99   32.67    0 0.00     0     0 numeric     40
## 11                  slope       0    0.00    0 0.00     0     0 integer      3
## 12      num_vessels_flour     176   58.09    4 1.32     0     0 integer      4
## 13                   thal       0    0.00    2 0.66     0     0  factor      3
## 14 heart_disease_severity     164   54.13    0 0.00     0     0 integer      5
## 15           exter_angina     204   67.33    0 0.00     0     0  factor      2
## 16      has_heart_disease       0    0.00    0 0.00     0     0  factor      2
```

``` r
# ì œì™¸í•  ë³€ìˆ˜ í™•ì¸
vars_to_exclude
```

```
## [1] "num_vessels_flour" "thal"
```

``` r
# ì›ë³¸ ë°ì´í„°ì…‹ì—ì„œ ë³€ìˆ˜ ì œì™¸í•˜ê¸°
heart_disease_clean_2 = select(heart_disease, -any_of(vars_to_exclude))
```



### ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ë¹ˆ ê°’ ì²˜ë¦¬í•˜ê¸°

ëª…ëª© ë³€ìˆ˜ì˜ ë¹ˆ ê°’ì„ ì²˜ë¦¬í•˜ê³  ë³€í™˜í•˜ëŠ” ë‹¤ì–‘í•œ ê´€ì ì„ ë‹¤ë£¹ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œ ë°ì´í„°ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ì›¹ í˜ì´ì§€ì— ì–´ë–»ê²Œ ë“¤ì–´ì˜¤ëŠ”ì§€ì— ëŒ€í•œ í‘œì¤€ ì •ë³´ê°€ í¬í•¨ëœ `web_navigation_data`ì—ì„œ íŒŒìƒë˜ì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” `source_page`(ë°©ë¬¸ìê°€ ì˜¨ í˜ì´ì§€), `landing_page`(ì²˜ìŒ ë°©ë¬¸í•œ í˜ì´ì§€), `country`ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.


``` r
# ì˜ˆì œ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ na.strings ë§¤ê°œë³€ìˆ˜ì— ì£¼ì˜í•˜ì„¸ìš”.
web_navigation_data=
  read.delim(file="https://goo.gl/dz7zNx", 
             sep="\t", 
             header = T, 
             stringsAsFactors=F, 
             na.strings="")
```


#### ë°ì´í„° í”„ë¡œíŒŒì¼ë§


``` r
stat_nav_data=df_status(web_navigation_data)
```

```
##       variable q_zeros p_zeros q_na  p_na q_inf p_inf      type unique
## 1  source_page       0       0   50 51.55     0     0 character      5
## 2 landing_page       0       0    5  5.15     0     0 character      5
## 3      country       0       0    3  3.09     0     0 character     18
```

ì„¸ ë³€ìˆ˜ ëª¨ë‘ ë¹ˆ(`NA`) ê°’ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. `source_page` ê°’ì˜ ê±°ì˜ ì ˆë°˜ì´ ëˆ„ë½ë˜ì—ˆìœ¼ë©°, ë‹¤ë¥¸ ë‘ ë³€ìˆ˜ëŠ” 5%ì™€ 3%ì˜ `NA`ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

#### ì‚¬ë¡€ A: ë¹ˆ ê°’ì„ ë¬¸ìì—´ë¡œ ë³€í™˜

ë²”ì£¼í˜• ë˜ëŠ” ëª…ëª©í˜• ë³€ìˆ˜ì—ì„œ ê°€ì¥ ë¹ ë¥¸ ì²˜ë¦¬ëŠ” ë¹ˆ ê°’ì„ `unknown` ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì€ "ë¹ˆ" ê°’ì„ ë˜ ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¡œ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ "ë§Œì•½ ë³€ìˆ˜_X = unknownì´ë©´, ê²°ê³¼ = yes"ì™€ ê°™ì€ ê·œì¹™ìœ¼ë¡œ ìƒê°í•˜ì‹­ì‹œì˜¤.

ë‹¤ìŒìœ¼ë¡œ ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ ë‘ ê°€ì§€ ë°©ë²•ì„ ì œì•ˆí•©ë‹ˆë‹¤.

**R ì˜ˆì‹œ:**


``` r
library(tidyr)

# ë°©ë²• 1: í•˜ë‚˜ì˜ ë³€ìˆ˜ë§Œ ë³€í™˜
web_navigation_data_1 = web_navigation_data %>% 
  mutate(source_page = 
           replace_na(source_page, 
                      "unknown_source")
         )


# ë°©ë²• 2: íŠ¹ì • ë³€ìˆ˜ë“¤ì—ë§Œ í•¨ìˆ˜ë¥¼ ì ìš©í•œ ë‹¤ìŒ 
# ì›ë˜ì˜ ë°ì´í„° í”„ë ˆì„ì„ ë°˜í™˜í•˜ëŠ” ì¼ë°˜ì ì¸ ìƒí™©ì…ë‹ˆë‹¤.

# NA ê°’ì˜ ë¹„ìœ¨ì´ 6% ë¯¸ë§Œì¸ ëª¨ë“  ë³€ìˆ˜ë¥¼ 
# ë³€í™˜í•˜ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.
vars_to_process = stat_nav_data %>% 
  filter(p_na < 6) %>% 
  pull(variable)

vars_to_process
```

```
## [1] "landing_page" "country"
```

``` r
# ë³€í™˜ëœ ë³€ìˆ˜ë¡œ ìƒˆë¡œìš´ ë°ì´í„° í”„ë ˆì„ ìƒì„±
web_navigation_data_2 = web_navigation_data %>%
  mutate(across(all_of(vars_to_process), ~replace_na(., "other")))
```

ê²°ê³¼ í™•ì¸:


``` r
df_status(web_navigation_data_1)
```

```
##       variable q_zeros p_zeros q_na p_na q_inf p_inf      type unique
## 1  source_page       0       0    0 0.00     0     0 character      6
## 2 landing_page       0       0    5 5.15     0     0 character      5
## 3      country       0       0    3 3.09     0     0 character     18
```

``` r
df_status(web_navigation_data_2)
```

```
##       variable q_zeros p_zeros q_na  p_na q_inf p_inf      type unique
## 1  source_page       0       0   50 51.55     0     0 character      5
## 2 landing_page       0       0    0  0.00     0     0 character      6
## 3      country       0       0    0  0.00     0     0 character     19
```

ì°¸ê³ : íŠ¹ì • ì—´ì— í•¨ìˆ˜ë¥¼ ì ìš©í•˜ëŠ” ê²ƒì€ ëª¨ë“  ë°ì´í„° í”„ë¡œì íŠ¸ì—ì„œ ë§¤ìš° ë³´í¸ì ì¸ ì‘ì—…ì…ë‹ˆë‹¤. `dplyr`ì˜ `across` ì‚¬ìš©ë²•ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´: [how do I select certain columns and give new names to mutated columns?](https://stackoverflow.com/questions/27027347/mutate-each-summarise-each-in-dplyr-how-do-i-select-certain-columns-and-give)


#### ì‚¬ë¡€ B: ê°€ì¥ ë¹ˆë²ˆí•œ ì¹´í…Œê³ ë¦¬ í• ë‹¹

ì´ ë°©ë²•ì˜ ì´ë©´ì—ëŠ” _ë³€ìˆ˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ìœ„í•´ ë™ì¼í•œ ê²ƒì„ ë” ì¶”ê°€í•œë‹¤_ëŠ” ì§ê´€ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë•Œë•Œë¡œ ì˜í–¥ì„ ë¯¸ì¹  ë•Œë„ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ í”í•œ ê°’ì´ 90%ì˜ ë¹ˆë„ë¡œ ë‚˜íƒ€ë‚  ë•Œì™€ 10%ì¼ ë•Œì˜ ì˜í–¥ì€ ê°™ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì¦‰, ë¶„í¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.

k-NNê³¼ ê°™ì´ ë‹¤ë¥¸ ì˜ˆì¸¡ ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ê²°ì¸¡ê°’ì„ ëŒ€ì¹˜í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ë„ ìˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ê°€ì¥ ë¹ˆë²ˆí•œ ê°’ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒë³´ë‹¤ ë” ì í•©í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¶Œì¥ë˜ëŠ” ê¸°ìˆ ì€ _ì‚¬ë¡€ A: ë¹ˆ ê°’ì„ ë¬¸ìì—´ë¡œ ë³€í™˜_ì—ì„œ ë³¸ ë°©ë²•ì…ë‹ˆë‹¤.


#### ì‚¬ë¡€ C: ì¼ë¶€ ì—´ ì œì™¸ ë° ë‹¤ë¥¸ ì—´ ë³€í™˜

ì‰¬ìš´ ì‚¬ë¡€ëŠ” ì—´ì— ì˜ˆë¥¼ ë“¤ì–´ 50%ì˜ `NA` ì‚¬ë¡€ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ì‹ ë¢°í•  ìˆ˜ ì—†ì„ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ì€ ê²½ìš°ì…ë‹ˆë‹¤.

ì•ì„œ ë³¸ ì‚¬ë¡€ì—ì„œ `source_page`ëŠ” ì ˆë°˜ ì´ìƒì˜ ê°’ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ë³€ìˆ˜ë¥¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ë‘ ë³€ìˆ˜ë¥¼ ì´ì „ì— í–ˆë˜ ê²ƒì²˜ëŸ¼ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì œëŠ” ë²”ìš©ì ìœ¼ë¡œ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.


``` r
# ì„ê³„ê°’ ì„¤ì •
threshold_to_exclude=50 # 50ì€ 50%ë¥¼ ë‚˜íƒ€ëƒ„
vars_to_exclude=stat_nav_data %>% filter(p_na >= threshold_to_exclude) 
vars_to_keep=stat_nav_data %>% filter(p_na < threshold_to_exclude) 

# ë§ˆì§€ë§‰ìœ¼ë¡œ...
vars_to_exclude$variable
```

```
## [1] "source_page"
```

``` r
vars_to_keep$variable
```

```
## [1] "landing_page" "country"
```

``` r
# ë‹¤ìŒ ë¼ì¸ì€ ì„ê³„ê°’ ì´ìƒì˜ ë³€ìˆ˜ë¥¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ë³€ìˆ˜ë¥¼ ë³€í™˜í•©ë‹ˆë‹¤.
web_navigation_data_3 = web_navigation_data %>%
  select(-any_of(vars_to_exclude$variable)) %>%
  mutate(across(all_of(vars_to_keep$variable), ~replace_na(., "unknown")))


# NA ê°’ì´ ì—†ê³  NA ì„ê³„ê°’ ì´ìƒì˜ ë³€ìˆ˜ê°€ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
df_status(web_navigation_data_3)
```

```
##       variable q_zeros p_zeros q_na p_na q_inf p_inf      type unique
## 1 landing_page       0       0    0    0     0     0 character      6
## 2      country       0       0    0    0     0     0 character     19
```
  




### ê²°ì¸¡ê°’ì— ì–´ë–¤ íŒ¨í„´ì´ ìˆë‚˜ìš”?

ë¨¼ì €, ì˜í™” ë°ì´í„° ì˜ˆì œë¥¼ ë¡œë“œí•˜ê³  ë¹ ë¥¸ í”„ë¡œíŒŒì¼ë§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.


``` r
# Lock5Dataì—ëŠ” ì—°ìŠµí•˜ê¸° ì¢‹ì€ ë§ì€ ë°ì´í„° í”„ë ˆì„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
# install.packages("Lock5Data")
library(Lock5Data)

# ë°ì´í„° ë¡œë“œ
data("HollywoodMovies2011")

# í”„ë¡œíŒŒì¼ë§
df_status(HollywoodMovies2011)
```

```
##             variable q_zeros p_zeros q_na  p_na q_inf p_inf    type unique
## 1              Movie       0    0.00    0  0.00     0     0  factor    136
## 2         LeadStudio       0    0.00    0  0.00     0     0  factor     34
## 3     RottenTomatoes       0    0.00    2  1.47     0     0 integer     75
## 4      AudienceScore       0    0.00    1  0.74     0     0 integer     60
## 5              Story       0    0.00    0  0.00     0     0  factor     22
## 6              Genre       0    0.00    0  0.00     0     0  factor      9
## 7   TheatersOpenWeek       0    0.00   16 11.76     0     0 integer    118
## 8  BOAverageOpenWeek       0    0.00   16 11.76     0     0 integer    120
## 9      DomesticGross       0    0.00    2  1.47     0     0 numeric    130
## 10      ForeignGross       0    0.00   15 11.03     0     0 numeric    121
## 11        WorldGross       0    0.00    2  1.47     0     0 numeric    134
## 12            Budget       0    0.00    2  1.47     0     0 numeric     60
## 13     Profitability       1    0.74    2  1.47     0     0 numeric    134
## 14    OpeningWeekend       1    0.74    3  2.21     0     0 numeric    130
```

`p_na` ì—´ì— ìˆëŠ” ê°’ë“¤ì„ ì‚´í´ë´…ì‹œë‹¤. ê²°ì¸¡ê°’ì— ì–´ë–¤ íŒ¨í„´ì´ ìˆìŠµë‹ˆë‹¤: 4ê°œì˜ ë³€ìˆ˜ëŠ” 1.47%ì˜ NA ê°’ì„ ê°€ì§€ê³  ìˆê³ , ë‹¤ë¥¸ 4ê°œëŠ” ì•½ 11.7%ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ë°ì´í„° ì†ŒìŠ¤ë¥¼ í™•ì¸í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, í•´ë‹¹ ì‚¬ë¡€ë“¤ì— ê³µí†µì ì¸ ë¬¸ì œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
 


### ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì˜ ê²°ì¸¡ê°’ ì²˜ë¦¬í•˜ê¸°

ìš°ë¦¬ëŠ” ì¥ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ëª¨ë“  `NA` ê°’ì„ 0ìœ¼ë¡œ ë³€í™˜í•¨ìœ¼ë¡œì¨ ì´ ë¬¸ì œì— ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.

í•œ ê°€ì§€ í•´ê²°ì±…ì€ ë¹ˆ ê°’ì„ í•˜ë‚˜ë¡œ í‰ê· , ì¤‘ì•™ê°’ ë˜ëŠ” ë‹¤ë¥¸ ê¸°ì¤€ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¶„í¬ì˜ ë³€í™”ë¥¼ ì¸ì§€í•´ì•¼ í•©ë‹ˆë‹¤.

ë³€ìˆ˜ê°€ ë¹„ì–´ ìˆì§€ ì•Šì„ ê²½ìš° ìƒê´€ê´€ê³„ê°€ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤ë©´(ë²”ì£¼í˜•ê³¼ ë™ì¼), ëŒ€ì•ˆì ì¸ ë°©ë²•ì€ ë¹ˆ(bins)ì„ ìƒì„±í•˜ì—¬(ë²„í‚· ë˜ëŠ” ì„¸ê·¸ë¨¼íŠ¸ë¼ê³ ë„ í•¨) ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


#### ë°©ë²• 1: ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜í•˜ê¸°

`equal_freq` í•¨ìˆ˜ëŠ” ë³€ìˆ˜ë¥¼ ì›í•˜ëŠ” ë¹ˆìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ìˆ˜ì¹˜í˜• ë³€ìˆ˜(`TheatersOpenWeek`)ë¥¼ ë°›ì•„ì„œ ë“±ë¹ˆë„ ê¸°ì¤€ì— ë”°ë¼ ë²”ì£¼í˜• ë³€ìˆ˜(`TheatersOpenWeek_cat`)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

<div class="figure">
<img src="02_data_preparation_files/figure-html/na-missing-values-analysis-1.png" alt="ë²”ì£¼í˜• ë°ì´í„°ì˜ ê²°ì¸¡ê°’" width="576"  />
<p class="caption">(\#fig:na-missing-values-analysis)ë²”ì£¼í˜• ë°ì´í„°ì˜ ê²°ì¸¡ê°’</p>
</div>

```
##   TheatersOpenWeek_cat frequency percentage cumulative_perc
## 1          [   3,2408)        24      17.65           17.65
## 2          [2408,2904)        24      17.65           35.30
## 3          [2904,3114)        24      17.65           52.95
## 4          [3114,3507)        24      17.65           70.60
## 5          [3507,4375]        24      17.65           88.25
## 6                 <NA>        16      11.76          100.00
```

ë³´ì‹œë‹¤ì‹œí”¼, `TheatersOpenWeek_cat`ì€ ê°ê° 24ê°œì˜ ì‚¬ë¡€ë¥¼ ê°€ì§„ 5ê°œì˜ ë²„í‚·ì„ í¬í•¨í•˜ë©°, ê° ë²„í‚·ì€ ì „ì²´ ì‚¬ë¡€ì˜ ì•½ 18%ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. í•˜ì§€ë§Œ `NA` ê°’ì€ ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, NAë¥¼ `empty` ë¬¸ìì—´ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.

<img src="02_data_preparation_files/figure-html/unnamed-chunk-65-1.png" alt="" width="576" />

ì´ì œ ëìŠµë‹ˆë‹¤. ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì‚¬ìš©ì ì •ì˜ ì»· (Custom cuts)**:

ë“±ë¹ˆë„ì— ì˜í•´ ì œê³µë˜ëŠ” ë²„í‚· í¬ê¸° ëŒ€ì‹  ì‚¬ìš©ì ì •ì˜ í¬ê¸°ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ `cut` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ìˆ˜ì¹˜í˜• ë³€ìˆ˜ `TheatersOpenWeek`ë¥¼ ë°›ì•„ì„œ `TheatersOpenWeek_cat_cust`ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.


``` r
# í˜„ì¬ R ì„¸ì…˜ì—ì„œ ê³¼í•™ì  í‘œê¸°ë²• ë¹„í™œì„±í™”
options(scipen=999) 

# 1,000, 2,300 ë° ìµœëŒ€ 4,100ì˜ ì œí•œì„ ê°–ëŠ” ì‚¬ìš©ì ì •ì˜ ë²„í‚· ìƒì„±.
# 4,100ì„ ì´ˆê³¼í•˜ëŠ” ê°’ì€ NAë¡œ í• ë‹¹ë¨.

HollywoodMovies2011$TheatersOpenWeek_cat_cust=
  cut(HollywoodMovies2011$TheatersOpenWeek, 
      breaks = c(0, 1000, 2300, 4100), 
      include.lowest = T,
      dig.lab = 10)

freq(HollywoodMovies2011$TheatersOpenWeek_cat_cust, 
     plot = F)
```

```
##           var frequency percentage cumulative_perc
## 1 (2300,4100]        94      69.12           69.12
## 2        <NA>        19      13.97           83.09
## 3 (1000,2300]        14      10.29           93.38
## 4    [0,1000]         9       6.62          100.00
```


**ë“±ë¹ˆë„ ë¹„ë‹(equal frequency binning)**ì€ ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ê° ì„¸ê·¸ë¨¼íŠ¸ ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ì·¨í•˜ëŠ” ë“±ê°„ê²©(equal distance) ë¶„í• ë³´ë‹¤ ë” ê²¬ê³ í•œ ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ë“±ê°„ê²© ë¶„í• ì€ ê° ë²„í‚·ì— ì–¼ë§ˆë‚˜ ë§ì€ ì‚¬ë¡€ê°€ ë“¤ì–´ê°€ëŠ”ì§€ì™€ ë¬´ê´€í•˜ê²Œ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë“±ë¹ˆë„ëŠ” ì´ìƒì¹˜ ê°’ì„ ì ì ˆí•˜ê²Œ ì²« ë²ˆì§¸ ë˜ëŠ” ë§ˆì§€ë§‰ ë¹ˆì— ë„£ìŠµë‹ˆë‹¤. ì¼ë°˜ì ì¸ ê°’ì€ 3ê°œì—ì„œ 20ê°œì˜ ë²„í‚· ë²”ìœ„ë¡œ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë²„í‚· ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë…¸ì´ì¦ˆê°€ ì‹¬í•´ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ì •ë³´ëŠ” [cross_plot](#profiling_target_cross_plot) ì¥ì˜ í•¨ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.


#### ë°©ë²• 2: ë¹ˆ(NA) ê°’ì„ íŠ¹ì • ê°’ìœ¼ë¡œ ì±„ìš°ê¸°

ë²”ì£¼í˜• ë³€ìˆ˜ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, í‰ê· ì´ë‚˜ ì¤‘ì•™ê°’ ê°™ì€ ìˆ«ìë¡œ ê°’ì„ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê²½ìš° `NA`ë¥¼ í‰ê· ìœ¼ë¡œ ëŒ€ì²´í•˜ê³  ì „í›„ ê²°ê³¼ë¥¼ ë‚˜ë€íˆ ê·¸ë ¤ë³´ê² ìŠµë‹ˆë‹¤.


``` r
# ëª¨ë“  NA ê°’ì„ ë³€ìˆ˜ì˜ í‰ê· ìœ¼ë¡œ ì±„ìš°ê¸°
HollywoodMovies2011$TheatersOpenWeek_mean=
  ifelse(is.na(HollywoodMovies2011$TheatersOpenWeek), 
         mean(HollywoodMovies2011$TheatersOpenWeek, 
              na.rm = T), 
         HollywoodMovies2011$TheatersOpenWeek
         )

# ì›ë³¸ ë³€ìˆ˜ í”Œë¡¯íŒ…
p1=ggplot(HollywoodMovies2011, aes(x=TheatersOpenWeek)) +
  geom_histogram(colour="black", fill="white") + 
  ylim(0, 30)
 
# ë³€í™˜ëœ ë³€ìˆ˜ í”Œë¡¯íŒ…
p2=ggplot(HollywoodMovies2011, 
          aes(x=TheatersOpenWeek_mean)
          ) + 
  geom_histogram(colour="black", fill="white") + 
  ylim(0, 30)

# í”Œë¡¯ì„ ë‚˜ë€íˆ ë°°ì¹˜ 
library(gridExtra)
grid.arrange(p1, p2, ncol=2)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/unnamed-chunk-67-1.png" alt="NAë¥¼ í‰ê· ê°’ìœ¼ë¡œ ì±„ìš°ê¸°" width="576"  />
<p class="caption">(\#fig:unnamed-chunk-67)NAë¥¼ í‰ê· ê°’ìœ¼ë¡œ ì±„ìš°ê¸°</p>
</div>

ë³€í™˜ì˜ ê²°ê³¼ë¡œ `2828`ì—ì„œ ì •ì ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì´ ì§€ì  ì£¼ë³€ì— í¸í–¥ì„ ë„ì…í•©ë‹ˆë‹¤. ë§Œì•½ ì–´ë–¤ ì‚¬ê±´ì„ ì˜ˆì¸¡í•˜ê³  ìˆë‹¤ë©´, ì´ ê°’ ì£¼ë³€ì— íŠ¹ë³„í•œ ì‚¬ê±´ì´ ì—†ëŠ” ê²ƒì´ ë” ì•ˆì „í•  ê²ƒì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ì§„ ì´ë²¤íŠ¸ë¥¼ ì˜ˆì¸¡í•˜ê³  ìˆê³  ê°€ì¥ ëŒ€í‘œì„±ì´ ë–¨ì–´ì§€ëŠ” ì´ë²¤íŠ¸ê°€ `TheatersOpenWeek`ì—ì„œ í‰ê· ì¸ `3000`ì„ ê°–ëŠ” ê²ƒê³¼ ìƒê´€ê´€ê³„ê°€ ìˆë‹¤ë©´, ë” ë†’ì€ **ê±°ì§“ ì–‘ì„±ë¥ (False Positive rate)**ì„ ê°€ì§ˆ í™•ë¥ ì´ ë†’ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ [ì˜ˆì¸¡ ëª¨ë¸ë§ì—ì„œì˜ ê³ ì¹´ë””ë„ë¦¬í‹° ë³€ìˆ˜](#high_cardinality_predictive_modeling) ì¥ê³¼ì˜ ì—°ê²°ì…ë‹ˆë‹¤.

ë§ˆì§€ë§‰ ì‹œê°í™”ì™€ ê´€ë ¨í•´ì„œ í•˜ë‚˜ ë§ë¶™ì´ìë©´, í”Œë¡¯ì„ ë¹„êµ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ yì¶• ìµœëŒ€ê°’ì„ 30ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í–ˆìŠµë‹ˆë‹¤.

ë³´ì‹œë‹¤ì‹œí”¼, ëª¨ë“  ê°œë…ë“¤ ì‚¬ì´ì—ëŠ” ìƒí˜¸ ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤ ğŸ˜‰.

  
#### ì±„ìš¸ ì ì ˆí•œ ê°’ ì„ íƒí•˜ê¸°

ë§ˆì§€ë§‰ ì˜ˆì œëŠ” `NA`ë¥¼ í‰ê· ìœ¼ë¡œ ëŒ€ì²´í–ˆì§€ë§Œ, ë‹¤ë¥¸ ê°’ë“¤ì€ ì–´ë–¨ê¹Œìš”? ì´ëŠ” ë³€ìˆ˜ì˜ ë¶„í¬ì— ë‹¬ë ¤ ìˆìŠµë‹ˆë‹¤.

ìš°ë¦¬ê°€ ì‚¬ìš©í•œ ë³€ìˆ˜(`TheatersOpenWeek`)ëŠ” ì •ê·œ ë¶„í¬ë¥¼ ë”°ë¥´ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì˜€ìœ¼ë©°, ì´ê²ƒì´ ìš°ë¦¬ê°€ í‰ê· ì„ ì‚¬ìš©í•œ ì´ìœ ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë³€ìˆ˜ê°€ ë” ì¹˜ìš°ì³(skewed) ìˆë‹¤ë©´, ë‹¤ë¥¸ ì§€í‘œê°€ ì•„ë§ˆë„ ë” ì í•©í•  ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¤‘ì•™ê°’(median)ì€ ì´ìƒì¹˜ì— ëœ ë¯¼ê°í•©ë‹ˆë‹¤.



### ê³ ê¸‰ ëŒ€ì¹˜ ë°©ë²• (Advanced imputation methods)

ì´ì œ ìš°ë¦¬ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì„ ìƒì„±í•˜ëŠ” ì¢€ ë” ì •êµí•œ ëŒ€ì¹˜ ë°©ë²•ì— ëŒ€í•´ ë¹ ë¥´ê²Œ ê²€í† í•´ ë³´ê² ìŠµë‹ˆë‹¤.


#### ë°©ë²• 1: ëœë¤ í¬ë ˆìŠ¤íŠ¸(missForest) ì‚¬ìš©í•˜ê¸°

[missForest](https://cran.r-project.org/web/packages/missForest/missForest.pdf) íŒ¨í‚¤ì§€ì˜ ê¸°ëŠ¥ì€ ë°˜ë³µì ì¸ í”„ë¡œì„¸ìŠ¤ì—ì„œ ê° ê²°ì¸¡ê°’ì„ ì™„ì„±í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë²ˆì˜ ëœë¤ í¬ë ˆìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ë²”ì£¼í˜• ë° ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¥¼ ë™ì‹œì— ì²˜ë¦¬í•©ë‹ˆë‹¤.

ê²°ì¸¡ê°’ ëŒ€ì¹˜ì™€ ë¬´ê´€í•˜ê²Œ, ëœë¤ í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ì€ ì—¬ëŸ¬ ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ë°ì´í„°ì—ì„œ ìµœê³ ì˜ ì„±ëŠ¥ì„ ë‚´ëŠ” ëª¨ë¸ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
ë‹¤ìŒ ì˜ˆì œì—ì„œ ì´ì „ì— ì‘ì—…í•˜ë˜ `HollywoodMovies2011` ë°ì´í„°ë¥¼ ì™„ì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì´ ë°ì´í„°ëŠ” ìˆ˜ì¹˜í˜• ë° ë²”ì£¼í˜• ë³€ìˆ˜ ëª¨ë‘ì— `NA` ê°’ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.



``` r
# install.packages("missForest")
library(missForest)

# ë°ì´í„° ë³µì‚¬
df_holly=Lock5Data::HollywoodMovies2011

# TheatersOpenWeek_cat_cust ë‹¤ì‹œ ìƒì„±
df_holly$TheatersOpenWeek_cat_cust=
  cut(HollywoodMovies2011$TheatersOpenWeek, 
      breaks = c(0, 1000, 2300, 4100), 
      include.lowest = T,
      dig.lab = 10)

# ë” ë‚˜ì€ ì˜ˆì œë¥¼ ìœ„í•´ TheatersOpenWeek_3ì— 15%ì˜ NA ê°’ì„ ì¶”ê°€ë¡œ ë„ì…í•©ë‹ˆë‹¤.
# missForestì˜ prodNA í•¨ìˆ˜ê°€ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.

# í•­ìƒ ë™ì¼í•œ ìˆ˜ì˜ NA ê°’ì„ ì–»ê¸° ìœ„í•´ ì‹œë“œ ì„¤ì •
set.seed(31415) 

df_holly$TheatersOpenWeek_cat_cust = df_holly %>% 
  select(TheatersOpenWeek_cat_cust) %>%
  prodNA(0.15) %>%
  pull(1)

# ìœ ìš©í•˜ì§€ ì•Šì€ ë³€ìˆ˜ ì œì™¸
df_holly = df_holly %>% select(-Movie)

# ì´ì œ ë§ˆë²•ì´ í¼ì³ì§‘ë‹ˆë‹¤! ë°ì´í„° í”„ë ˆì„ ëŒ€ì¹˜
# xmis ë§¤ê°œë³€ìˆ˜ = ê²°ì¸¡ê°’ì´ ìˆëŠ” ë°ì´í„°
imputation_res=missForest(xmis = df_holly)

# ìµœì¢… ëŒ€ì¹˜ëœ ë°ì´í„° í”„ë ˆì„
df_imputed=imputation_res$ximp
```

ì°¸ê³ : `missForest`ëŠ” ë¬¸ìí˜•(character) ë³€ìˆ˜ê°€ ìˆìœ¼ë©´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.


ì´ì œ ëŒ€ì¹˜ëœ ì¼ë¶€ ë³€ìˆ˜ë“¤ì˜ ë¶„í¬ë¥¼ ë¹„êµí•´ ë³¼ ì‹œê°„ì…ë‹ˆë‹¤. ì´ì‚°í™”í•˜ê¸° ì „ì˜ ì›ë˜ ë³€ìˆ˜ì¸ `TheatersOpenWeek`ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ì‹œê°ì  ë¶„ì„ì—ì„œ ì„œë¡œ ë¹„ìŠ·í•´ ë³´ì´ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.



``` r
# randomForest íŒ¨í‚¤ì§€ì˜ na.roughfixë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë˜ ë‹¤ë¥¸ ëŒ€ì¹˜ ìƒì„±
if(!requireNamespace("randomForest", quietly = TRUE)) install.packages("randomForest")
library(randomForest)
df_rough=randomForest::na.roughfix(df_holly)

# ëŒ€ì¹˜ ì „í›„ì˜ ë¶„í¬ ë¹„êµ
df_holly$imputation="original"
df_rough$imputation="na.roughfix"
df_imputed$imputation="missForest"

# ì„¸ ë°ì´í„° í”„ë ˆì„ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ê³  imputation ë³€ìˆ˜ë¡œ êµ¬ë¶„
library(dplyr)
df_all=bind_rows(df_holly, df_imputed, df_rough)

# í”Œë¡¯ì— ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìš”ì¸(factor)ìœ¼ë¡œ ë³€í™˜
df_all$imputation=factor(df_all$imputation, levels=unique(df_all$imputation))

# í”Œë¡¯íŒ…
ggplot(df_all, aes(TheatersOpenWeek, colour=imputation)) + 
  geom_density() + 
  theme_minimal() + 
  scale_colour_brewer(palette="Set2")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/how-to-impute-missing-values-1.png" alt="ëŒ€ì¹˜ ë°©ë²• ë¹„êµ (ìˆ˜ì¹˜í˜• ë³€ìˆ˜)" width="480"  />
<p class="caption">(\#fig:how-to-impute-missing-values)ëŒ€ì¹˜ ë°©ë²• ë¹„êµ (ìˆ˜ì¹˜í˜• ë³€ìˆ˜)</p>
</div>


* ì£¼í™©ìƒ‰ ê³¡ì„ ì€ `missForest` íŒ¨í‚¤ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒ€ì¹˜ëœ ë¶„í¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
* íŒŒë€ìƒ‰ì€ ì²˜ìŒì— ë…¼ì˜í–ˆë˜ ëŒ€ì¹˜ ë°©ë²•ìœ¼ë¡œ, `randomForest` íŒ¨í‚¤ì§€ì˜ `na.roughfix` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  `NA`ë¥¼ ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´í•œ ê²ƒì…ë‹ˆë‹¤.
* ì´ˆë¡ìƒ‰ì€ ëŒ€ì¹˜ ì „ì˜ ë¶„í¬ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤ (ë‹¹ì—°íˆ NA ê°’ì€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤).

**ë¶„ì„:**

ì˜ˆìƒëŒ€ë¡œ `NA`ë¥¼ ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´í•˜ë©´ ëª¨ë“  ê°’ì´ 3000 ì£¼ë³€ì— ì§‘ì¤‘ë˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ì— missForest íŒ¨í‚¤ì§€ì— ì˜í•œ ëŒ€ì¹˜ëŠ” ë‹¨ì¼ ê°’ì— ì§‘ì¤‘ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— **ë”ìš± ìì—°ìŠ¤ëŸ¬ìš´ ë¶„í¬**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ê²ƒì´ 3000 ì£¼ë³€ì˜ í”¼í¬ê°€ ì›ë˜ ê²ƒë³´ë‹¤ ë‚®ì€ ì´ìœ ì…ë‹ˆë‹¤.

ì£¼í™©ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ì€ ê½¤ ë¹„ìŠ·í•´ ë³´ì…ë‹ˆë‹¤!

ë¶„ì„ì ì¸ ê´€ì ì—ì„œ ë³´ê³  ì‹¶ë‹¤ë©´, ì˜ˆë¥¼ ë“¤ì–´ í‰ê· ì´ë‚˜ ë¶„ì‚°ì„ ë¹„êµí•˜ê¸° ìœ„í•´ í†µê³„ì  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ `TheatersOpenWeek`ë¥¼ ì´ì‚°í™”í•œ ì‚¬ìš©ì ì •ì˜ ë³€ìˆ˜(`TheatersOpenWeek_cat_cust`)ë¥¼ ì‹œê°í™”í•´ ë³´ê² ìŠµë‹ˆë‹¤.



``` r
# NAë¥¼ í•˜ë‚˜ì˜ ì¹´í…Œê³ ë¦¬ë¡œ í”Œë¡¯í•˜ê¸° ìœ„í•œ í¸ë²•
levels(df_all$TheatersOpenWeek_cat_cust)=
  c(levels(df_all$TheatersOpenWeek_cat_cust), "NA")

flag_na=is.na(df_all$TheatersOpenWeek_cat_cust)

df_all$TheatersOpenWeek_cat_cust[flag_na]="NA"

# ì´ì œ í”Œë¡¯ì…ë‹ˆë‹¤!
ggplot(df_all, aes(x = TheatersOpenWeek_cat_cust, 
                   fill = TheatersOpenWeek_cat_cust)
       ) +
  geom_bar(na.rm=T) + 
  facet_wrap(~imputation) + 
  geom_text(stat='count',
            aes(label=after_stat(count)),
            vjust=-1) + 
  ylim(0, 125) + 
  scale_fill_brewer(palette="Set2") + 
  theme_minimal() + 
  theme(axis.text.x=
          element_text(angle = 45, hjust = 0.7)
        ) +
  theme(legend.position="bottom")
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/missing-value-imputation-1.png" alt="ëŒ€ì¹˜ ë°©ë²• ë¹„êµ" width="672"  />
<p class="caption">(\#fig:missing-value-imputation)ëŒ€ì¹˜ ë°©ë²• ë¹„êµ</p>
</div>



**ë¶„ì„:**

ì›ë³¸ ë³€ìˆ˜ëŠ” 35ê°œì˜ `NA` ê°’ì„ í¬í•¨í•˜ê³  ìˆìœ¼ë©°, ì´ëŠ” `na.roughfix`ì—ì„œ ìµœë¹ˆê°’ì¸ `(2300, 4100]`ìœ¼ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤. ë°˜ë©´ì— `missForest`ë¥¼ ì‚¬ìš©í–ˆì„ ë•ŒëŠ” ì•½ê°„ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì–»ì—ˆëŠ”ë°, ì™„ì„± ê¸°ì¤€ì´ ë‹¤ë¥¸ ë³€ìˆ˜ë“¤ì— ê¸°ë°˜í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

`missForest`ëŠ” `[0, 1000]` ì¹´í…Œê³ ë¦¬ì— 15ê°œ í–‰ì„, `[1000, 2300]`ì— 3ê°œë¥¼, ê·¸ë¦¬ê³  `[2300, 4100]` ì¹´í…Œê³ ë¦¬ì— 17ê°œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.



#### ë°©ë²• 2: MICE ì ‘ê·¼ ë°©ì‹ ì‚¬ìš©í•˜ê¸°

**ì¡°ì–¸:** ê²°ì¸¡ê°’ ëŒ€ì¹˜ì— ëŒ€í•œ ì´ˆê¸° ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œëŠ” ì´ ë°©ë²•ì´ ì •ë§ ë³µì¡í•©ë‹ˆë‹¤ ğŸ˜¨.

MICEëŠ” "Multivariate Imputation by Chained Equations"ì˜ ì•½ìë¡œ, "Fully Conditional Specification"ìœ¼ë¡œë„ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤. ì´ ì±…ì€ ê·¸ ì¸ê¸° ë•Œë¬¸ì— ì´ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

MICEëŠ” ê²°ì¸¡ê°’ì„ ë¶„ì„í•˜ê³  ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì™„ì „í•œ í”„ë ˆì„ì›Œí¬ë¥¼ ìˆ˜ë°˜í•©ë‹ˆë‹¤. ì´ëŠ” **ëª¨ë“  ë³€ìˆ˜** ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ë™ì‹œì— ê³ ë ¤í•˜ë©°(ë‹¨ì¼ ë³€ìˆ˜ê°€ ì•„ë‹Œ ë‹¤ë³€ëŸ‰), ì„œë¡œ ë‹¤ë¥¸ ì˜ˆì¸¡ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ê° ë³€ìˆ˜ë¥¼ ì±„ìš°ëŠ” **ë°˜ë³µì ì¸** í”„ë¡œì„¸ìŠ¤ì— ê¸°ëŠ¥ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ë‚´ë¶€ì ìœ¼ë¡œëŠ” Bì™€ Cë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³€ìˆ˜ Aë¥¼ ì±„ì›ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ A(ì´ì „ ë‹¨ê³„ì—ì„œ ì˜ˆì¸¡ë¨)ì™€ Cë¥¼ ê¸°ë°˜ìœ¼ë¡œ Bë¥¼ ì±„ìš°ê³  ë°˜ë³µì´ ê³„ì†ë©ë‹ˆë‹¤. "chained equations(ì—°ì‡„ ë°©ì •ì‹)"ë¼ëŠ” ì´ë¦„ì€ ì¼€ì´ìŠ¤ë¥¼ ëŒ€ì¹˜í•˜ê¸° ìœ„í•´ ë³€ìˆ˜ë³„ë¡œ ì•Œê³ ë¦¬ì¦˜ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì—ì„œ ìœ ë˜ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ëŠ” ê²°ì¸¡ê°’ì´ ì—†ëŠ” ì›ë˜ ë°ì´í„°ì˜ Mê°œ ë³µì œë³¸ì„ ë§Œë“­ë‹ˆë‹¤. _ê·¸ëŸ°ë° ì™œ Mê°œì˜ ë³µì œë³¸ì„ ë§Œë“¤ê¹Œìš”?_

ê° ë³µì œë³¸ì—ì„œ _ë¹ˆ ìŠ¬ë¡¯_ì— ì‚½ì…í•  ê°’ì˜ ê²°ì •ì€ ë¶„í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ë§ì€ MICE ì‹œì—°ì€ ëŒ€ì¹˜ë¥¼ ê²€ì¦í•˜ê³  íŒ¨í‚¤ì§€ì—ì„œ ì§€ì›í•˜ëŠ” ëª‡ ì•ˆ ë˜ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤. ë‹¤ë¥¸ ì˜ˆì¸¡ ëª¨ë¸(ëœë¤ í¬ë ˆìŠ¤íŠ¸, ê·¸ë ˆë””ì–¸íŠ¸ ë¶€ìŠ¤íŒ… ë¨¸ì‹  ë“±)ì´ë‚˜ êµì°¨ ê²€ì¦ ê¸°ìˆ (ì˜ˆ: `caret`)ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ ì´ê²ƒìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.

MICE ê¸°ìˆ ì€ ê²°ì¸¡ê°’ìœ¼ë¡œ ì¸í•œ ë¶„ì‚°ì„ ì¸¡ì •í•˜ê¸° ìœ„í•œ ì‹œì„¤ì„ ì œê³µí•˜ëŠ” Mê°œ ì˜ˆì¸¡ ëª¨ë¸ì˜ ë§¤ê°œë³€ìˆ˜(ë˜ëŠ” ë² íƒ€)ë¥¼ í‰ê· í™”í•˜ëŠ” `pool()` í•¨ìˆ˜ë¥¼ ì„¤ì •í•˜ì—¬ ìµœì¢… ê²°ê³¼ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.

ë„¤, ìƒì„±ëœ ë°ì´í„° í”„ë ˆì„ë‹¹ í•˜ë‚˜ì˜ ëª¨ë¸ì…ë‹ˆë‹¤. [ë°°ê¹…(bagging)](https://en.wikipedia.org/wiki/Bootstrap_aggregating)ì²˜ëŸ¼ ë“¤ë¦¬ì£ ? í•˜ì§€ë§Œ ì–¸ê¸‰ëœ ëª¨ë¸ë“¤ì—ì„œëŠ” ì´ëŸ° ê°€ëŠ¥ì„±ì´ ì—†ìŠµë‹ˆë‹¤.

MICEì—ëŠ” ì±„ìš°ê¸° ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ê³  ê²€ì¦í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ë§ì€ í•¨ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•´ ê·¹íˆ ì¼ë¶€ë§Œ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì´ë‚˜ ì˜ˆì¸¡ ëª¨ë¸ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ **ê²°ì¸¡ê°’ì´ ì—†ëŠ” ë°ì´í„° í”„ë ˆì„ì„ ì¶”ì¶œ**í•˜ëŠ” ë° ì¤‘ì ì„ ë‘˜ ê²ƒì…ë‹ˆë‹¤.

**R ì˜ˆì‹œ:**

ì´ê²ƒì€ [mice íŒ¨í‚¤ì§€](https://cran.r-project.org/web/packages/mice/mice.pdf)ì— í¬í•¨ëœ `nhanes` ë°ì´í„° í”„ë ˆì„ì˜ ë°ì´í„°ë¥¼ ëŒ€ì¹˜í•  ê²ƒì…ë‹ˆë‹¤. í™•ì¸í•´ ë´…ì‹œë‹¤:


``` r
# install.packages("mice")
library(mice)
df_status(nhanes)
```

```
##   variable q_zeros p_zeros q_na p_na q_inf p_inf    type unique
## 1      age       0       0    0    0     0     0 numeric      3
## 2      bmi       0       0    9   36     0     0 numeric     16
## 3      hyp       0       0    8   32     0     0 numeric      2
## 4      chl       0       0   10   40     0     0 numeric     13
```

ì„¸ ê°œì˜ ë³€ìˆ˜ì— ê²°ì¸¡ê°’ì´ ìˆìŠµë‹ˆë‹¤. ì±„ì›Œë´…ì‹œë‹¤:


``` r
# ê¸°ë³¸ ëŒ€ì¹˜ëŠ” 5ê°œì˜ ì™„ì „í•œ ë°ì´í„°ì…‹ì„ ìƒì„±í•©ë‹ˆë‹¤.
imp_data=mice(nhanes, m = 5, printFlag = FALSE)

# 5ê°œì˜ ëŒ€ì¹˜ëœ ë°ì´í„° í”„ë ˆì„ì„ í¬í•¨í•˜ëŠ” ìµœì¢… ë°ì´í„°ì…‹ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì „ì²´ í–‰ ìˆ˜ = nrow(nhanes) * 5
data_all=complete(imp_data, "long")

# data_allì€ nhanesì™€ ë™ì¼í•œ ì—´ì— .idì™€ .imp ë‘ ê°œë¥¼ ë” í¬í•¨í•©ë‹ˆë‹¤.
# .id = 1ë¶€í„° 25ê¹Œì§€ì˜ í–‰ ë²ˆí˜¸
# .imp = ëŒ€ì¹˜ ë°ì´í„° í”„ë ˆì„ .id 1ë¶€í„° 5ê¹Œì§€ (m ë§¤ê°œë³€ìˆ˜)
```

ì›ë³¸ ë°ì´í„°ì—ì„œ `nhanes`ëŠ” 25í–‰ì„ ê°€ì§€ê³  ìˆê³  `data_all`ì€ 125í–‰ì„ í¬í•¨í•˜ëŠ”ë°, ì´ëŠ” ê°ê° 25í–‰ì¸ 5ê°œ(`m=5`)ì˜ ì™„ì „í•œ ë°ì´í„° í”„ë ˆì„ì„ ìƒì„±í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

ê²°ê³¼ë¥¼ í™•ì¸í•  ì‹œê°„ì…ë‹ˆë‹¤:


``` r
library(mice)
densityplot(imp_data)
```

<div class="figure">
<img src="02_data_preparation_files/figure-html/unnamed-chunk-71-1.png" alt="MICEë¥¼ ì‚¬ìš©í•œ ê²°ì¸¡ê°’ ê²°ê³¼ ë¶„ì„" width="576"  />
<p class="caption">(\#fig:unnamed-chunk-71)MICEë¥¼ ì‚¬ìš©í•œ ê²°ì¸¡ê°’ ê²°ê³¼ ë¶„ì„</p>
</div>

ê° ë¹¨ê°„ìƒ‰ ì„ ì€ ëŒ€ì¹˜ëœ ê° ë°ì´í„° í”„ë ˆì„ì˜ ë¶„í¬ë¥¼ ë³´ì—¬ì£¼ê³  íŒŒë€ìƒ‰ ì„ ì€ ì›ë˜ì˜ ë¶„í¬ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ ì´ë©´ì˜ ì•„ì´ë””ì–´ëŠ” ê·¸ë“¤ì´ ë¹„ìŠ·í•´ ë³´ì¸ë‹¤ë©´ ëŒ€ì¹˜ê°€ ì›ë˜ì˜ ë¶„í¬ë¥¼ ì˜ ë”°ëë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `chl`ì€ ëŒ€ì¹˜ëœ ë°ì´í„° í”„ë ˆì„ í•˜ë‚˜ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì›ë˜ ê²ƒë³´ë‹¤ í›¨ì”¬ ë†’ì€ ë‘ ê°’ ì£¼ë³€ì— ë‘ ê°œì˜ í”¼í¬ë¥¼ íŠ¹ì§•ìœ¼ë¡œ í•˜ëŠ” ë¹¨ê°„ìƒ‰ ì„ ì´ í•˜ë‚˜ë§Œ ìˆìŠµë‹ˆë‹¤.

ë‹¨ì ì€ í”„ë¡œì„¸ìŠ¤ê°€ ëŠë¦¬ê³  ì‘ë™í•˜ê¸° ìœ„í•´ ì•½ê°„ì˜ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: `mice_hollywood=mice(HollywoodMovies2011, m=5)`ëŠ” ì‘ì€ ë°ì´í„° í”„ë ˆì„ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ë° ì‹œê°„ì´ ì¢€ ê±¸ë¦° í›„ ì‹¤íŒ¨í•  ê²ƒì…ë‹ˆë‹¤.


`MICE` íŒ¨í‚¤ì§€ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´:

* ì›ë³¸ MICE ë…¼ë¬¸: [Multivariate Imputation by Chained Equations in R](https://www.jstatsoft.org/article/view/v045i03)
* [Handling missing data with MICE package; a simple approach](https://datascienceplus.com/handling-missing-data-with-mice-package-a-simple-approach)



### ê²°ë¡ 

ëª¨ë“  ê²ƒì„ ë‹¤ë£¬ í›„, ìš°ë¦¬ëŠ” ë¬¼ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: ë¬´ì—‡ì´ ìµœì„ ì˜ ì „ëµì¼ê¹Œìš”? ìŒ, ê²°ì¸¡ê°’ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ìš°ë¦¬ê°€ ì–¼ë§ˆë‚˜ ê°œì…í•´ì•¼ í•˜ëŠ”ì§€ì— ë‹¬ë ¤ ìˆìŠµë‹ˆë‹¤.

ì „ëµì— ëŒ€í•œ ë¹ ë¥¸ ê²€í† ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

A) ê²°ì¸¡ê°’ì´ ìˆëŠ” í–‰ê³¼ ì—´ì„ ì œì™¸í•˜ê¸°. ê²°ì¸¡ê°’ì´ ìˆëŠ” í–‰(ë˜ëŠ” ì—´)ì´ _ê±°ì˜ ì—†ê³ _, ë‚¨ì€ ë°ì´í„°ê°€ í”„ë¡œì íŠ¸ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸°ì— ì¶©ë¶„í•  ë•Œë§Œ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê²°ì¸¡ê°’ì´ ìˆëŠ” í–‰ì„ ì œì™¸í•˜ê³  ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰ë  ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•  ë•Œ, ê²°ì¸¡ê°’ì´ í¬í•¨ëœ **ìƒˆë¡œìš´ ì‚¬ë¡€ê°€ ë„ì°©í•˜ë©´** ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê°’ì„ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.

B) **ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¥¼ ë²”ì£¼í˜•ìœ¼ë¡œ ë³€í™˜**í•œ ë‹¤ìŒ "ë¹ˆ(empty)" ê°’ì„ ìƒì„±í•˜ëŠ” ì „ëµ(ë²”ì£¼í˜• ë³€ìˆ˜ì—ë„ ì ìš© ê°€ëŠ¥)ì€ ë¹ˆ ê°’ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê°€ì¥ ë¹ ë¥´ê³  ê¶Œì¥ë˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ëª¨ë¸ì´ ë¶ˆí™•ì‹¤ì„±ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ê²°ì¸¡ê°’ì„ ëª¨ë¸ì— ë„ì…í•˜ê²Œ ë©ë‹ˆë‹¤.

C) MICEì™€ missForestë¡œ ë‹¤ë£¬ ê²ƒê³¼ ê°™ì€ **ëŒ€ì¹˜ ë°©ë²•**ì€ ìƒë‹¹íˆ ë” ë³µì¡í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²•ë“¤ì„ í†µí•´ ìš°ë¦¬ëŠ” í–‰ì´ë‚˜ ì—´ì„ ì œì™¸í•  í•„ìš”ê°€ ì—†ë„ë¡ **ì œì–´ëœ í¸í–¥(controlled-bias)**ì„ ë„ì…í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë³€í™˜ë“¤ì„ ê¹Šì´ íŒŒê³ ë“œëŠ” ê²ƒê³¼ ë‹¨ìˆœí•˜ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒ ì‚¬ì´ì—ì„œ ì˜¬ë°”ë¥¸ ê· í˜•ì„ ì°¾ëŠ” ê²ƒì€ ì˜ˆìˆ ê³¼ ê°™ìŠµë‹ˆë‹¤. íˆ¬ìëœ ì‹œê°„ì´ ì „ì²´ì ì¸ ì •í™•ë„ì— ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë°©ë²•ì— ìƒê´€ì—†ì´ ê° ê²°ì •ì˜ ì˜í–¥ì„ ë¶„ì„í•˜ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ ë°ì´í„°ì™€ í”„ë¡œì íŠ¸ì— ê°€ì¥ ì í•©í•œ ë°©ë²•ì„ ë°œê²¬í•˜ê¸°ê¹Œì§€ëŠ” íƒìƒ‰ì  ë°ì´í„° ë¶„ì„ë¿ë§Œ ì•„ë‹ˆë¼ ë§ì€ ì‹œí–‰ì°©ì˜¤ê°€ ë”°ë¦…ë‹ˆë‹¤.
 


![](introduction/spacer_bar.png)<!-- -->





## ì‹œê°„ê³¼ ê´€ë ¨ëœ ê³ ë ¤ ì‚¬í•­ {#considerations-involving-time}


### ë¬´ì—‡ì— ëŒ€í•œ ë‚´ìš©ì¸ê°€ìš”?


<img src="data_preparation/Heraklit.jpeg" alt="" width="150px" />

> ëª¨ë“  ê²ƒì€ ë³€í•˜ê³  ì•„ë¬´ê²ƒë„ ë©ˆì¶° ìˆì§€ ì•ŠëŠ”ë‹¤. - í—¤ë¼í´ë ˆì´í† ìŠ¤ (ê¸°ì›ì „ 535ë…„ ~ 475ë…„), ì†Œí¬ë¼í…ŒìŠ¤ ì´ì „ì˜ ê·¸ë¦¬ìŠ¤ ì² í•™ì.

ë³€ìˆ˜ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.

ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë³€ìˆ˜ì˜ ê°’ì€ ë³€í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì˜ˆì¸¡ ëª¨ë¸ì„ ìƒì„±í•˜ê¸° ìœ„í•´ ì‹œê°„ ë¶„ì„ì„ ì¤‘ìš”í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. **ê²°ê³¼**ë¥¼ **ì›ì¸**ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í”¼í•´ì•¼ í•©ë‹ˆë‹¤.


**ì´ ì¥ì—ì„œ ë¬´ì—‡ì„ ê²€í† í• ê¹Œìš”?**

* ì˜ˆì¸¡í•  ì´ë²¤íŠ¸ ì´ì „ì˜ ì •ë³´ë¥¼ í•„í„°ë§í•˜ëŠ” ê°œë….
* ê°’ì´ ë¬´í•œëŒ€(ê·¸ ì´ìƒ)ë¡œ ì¦ê°€í•˜ê±°ë‚˜ ê°ì†Œí•˜ëŠ” ë³€ìˆ˜ë¥¼ ë¶„ì„í•˜ê³  ì¤€ë¹„í•˜ëŠ” ë°©ë²•.


#### ë¯¸ë˜ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”


<img src="data_preparation/back_to_the_future.png" alt="" width="200px" />

_ì˜í™” "ë°± íˆ¬ ë” í“¨ì²˜" (1985)ì˜ ì¥ë©´. ë¡œë²„íŠ¸ ì €ë©”í‚¤ìŠ¤ (ê°ë…)._


ì˜ˆì¸¡í•˜ë ¤ëŠ” ì´ë²¤íŠ¸ _ì´í›„_ì˜ ì •ë³´ê°€ í¬í•¨ëœ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ìƒˆë¡œìš´ ì˜ˆì¸¡ ëª¨ë¸ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•Œ í”íˆ ì €ì§€ë¥´ëŠ” ì‹¤ìˆ˜ì…ë‹ˆë‹¤. ì´ëŠ” ë‚´ì¼ì˜ ì‹ ë¬¸ì„ ê°€ì§€ê³  ì˜¤ëŠ˜ ë¡œë˜ë¥¼ í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì–´ë–¤ ì‚¬ìš©ìê°€ ì „ì²´ êµ¬ë…(full subscription)ì„ êµ¬ë§¤í• ì§€ ì•Œê¸° ìœ„í•´ ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•´ì•¼ í•œë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. ê·¸ë¦¬ê³  ì´ ì†Œí”„íŠ¸ì›¨ì–´ì—ëŠ” `feature_A`ë¼ëŠ” ê°€ìƒì˜ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.



```
##    user_id feature_A full_subscription
## 1        1       yes               yes
## 2        2       yes               yes
## 3        3       yes               yes
## 4        4        no                no
## 5        5       yes               yes
## 6        6        no                no
## 7        7        no                no
## 8        8        no                no
## 9        9        no                no
## 10      10        no                no
```


ì˜ˆì¸¡ ëª¨ë¸ì„ êµ¬ì¶•í•˜ì—¬ ì™„ë²½í•œ ì •í™•ë„ë¥¼ ì–»ì—ˆê³ , ì¡°ì‚¬ ê²°ê³¼ ë‹¤ìŒê³¼ ê°™ì€ ì‚¬ì‹¤ì´ ë“œëŸ¬ë‚¬ìŠµë‹ˆë‹¤: _"ì „ì²´ êµ¬ë…ì„ í•œ ì‚¬ìš©ì ì¤‘ 100%ê°€ ê¸°ëŠ¥ Aë¥¼ ì‚¬ìš©í•œë‹¤"_. ì¼ë¶€ ì˜ˆì¸¡ ì•Œê³ ë¦¬ì¦˜ì€ ë³€ìˆ˜ ì¤‘ìš”ë„ë¥¼ ë³´ê³ í•˜ë©°, ë”°ë¼ì„œ `feature_A`ê°€ ìµœìƒìœ„ì— ìˆì„ ê²ƒì…ë‹ˆë‹¤.

**ë¬¸ì œëŠ”:** `feature_A`ëŠ” **ì‚¬ìš©ìê°€ ì „ì²´ êµ¬ë…ìœ¼ë¡œ ì „í™˜í•œ í›„ì—ë§Œ** ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

**í•µì‹¬ ë©”ì‹œì§€ëŠ”**: ì™„ë²½í•œ ë³€ìˆ˜ë„, ì™„ë²½í•œ ëª¨ë¸ë„ ë¯¿ì§€ ë§ˆì„¸ìš”.


#### ë°ì´í„°ë¡œ ì •ì •ë‹¹ë‹¹í•˜ê²Œ ê²½ìŸí•˜ê³ , ë°ì´í„°ê°€ ê±°ë™ì„ ë°œì „ì‹œí‚¤ê²Œ í•˜ì„¸ìš”

ìì—°ì—ì„œì²˜ëŸ¼ ì‚¬ë¬¼ë„ íŠ¹ì • í–‰ë™ì„ ë³´ì´ê¸° ì‹œì‘í•˜ëŠ” ìµœì†Œ ì‹œê°„ê³¼ ìµœëŒ€ ì‹œê°„ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì‹œê°„ì€ 0ì—ì„œ ë¬´í•œëŒ€ ì‚¬ì´ì—ì„œ ìš”ë™ì¹©ë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” ë¶„ì„í•˜ê¸°ì— ê°€ì¥ ì¢‹ì€ ê¸°ê°„ì´ ì–¸ì œì¸ì§€ ì—°êµ¬í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë˜ëŠ”ë°, ì¦‰ ì´ ê´€ì°° ê¸°ê°„ ì „í›„ì˜ ëª¨ë“  ê±°ë™ì„ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ì—ì„œ ë²”ìœ„ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì€ ë‹¤ë¶„íˆ ì£¼ê´€ì ì¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°„ë‹¨í•œ ì¼ì€ ì•„ë‹™ë‹ˆë‹¤.

ì‹œê°„ì´ íë¦„ì— ë”°ë¼ ìˆ˜ì¹˜ê°€ ì¦ê°€í•˜ëŠ” **ìˆ˜ì¹˜í˜• ë³€ìˆ˜**ê°€ ìˆë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ê³  ì˜ˆì¸¡ ëª¨ë¸ì— ê³µê¸‰í•˜ê¸° ìœ„í•´ **ê´€ì°° ì‹œê°„ ìœˆë„ìš°(observation time window)**ë¥¼ ì •ì˜í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

* **ìµœì†Œ** ì‹œê°„ ì„¤ì •: ê±°ë™ì´ ë‚˜íƒ€ë‚˜ê¸° ì‹œì‘í•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ë§ì€ ì‹œê°„ì´ í•„ìš”í•œê°€?
* **ìµœëŒ€** ì‹œê°„ ì„¤ì •: ê±°ë™ì˜ ëì„ í™•ì¸í•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ë§ì€ ì‹œê°„ì´ ì†Œìš”ë˜ëŠ”ê°€?

ê°€ì¥ ì‰¬ìš´ í•´ê²°ì±…ì€ ìµœì†Œ ì‹œê°„ì„ ì‹œì‘ë¶€í„°ë¡œ, ìµœëŒ€ ì‹œê°„ì„ ì „ì²´ ì´ë ¥ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


**ì‚¬ë¡€ ì—°êµ¬:**

ë‘ ì‚¬ëŒ `Ouro`ì™€ `Borus`ëŠ” `feature_A`ë¼ëŠ” íŠ¹ì • ê¸°ëŠ¥ì´ ìˆëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‚¬ìš©ìì´ë©°, ìš°ë¦¬ëŠ” `feature_A` ì‚¬ìš©ëŸ‰(í´ë¦­ ìˆ˜ ì¸¡ì •)ì„ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ì¸ì´ `full_subscription`ì„ êµ¬ë§¤í• ì§€ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì„ êµ¬ì¶•í•´ì•¼ í•©ë‹ˆë‹¤.

í˜„ì¬ ë°ì´í„°ì— ë”°ë¥´ë©´ BorusëŠ” `full_subscription`ì„ ê°€ì§€ê³  ìˆì§€ë§Œ OuroëŠ” ê°€ì§€ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-time-variable-1.png" alt="ì‹œê°„ ê³ ë ¤ ì‚¬í•­ì— ì£¼ì˜í•˜ì„¸ìš”" width="384"  />
<p class="caption">(\#fig:data-preparation-time-variable)ì‹œê°„ ê³ ë ¤ ì‚¬í•­ì— ì£¼ì˜í•˜ì„¸ìš”</p>
</div>


ì‚¬ìš©ì `Borus`ëŠ” 3ì¼ì§¸ë¶€í„° `feature_A`ë¥¼ ì‚¬ìš©í•˜ê¸° ì‹œì‘í–ˆê³ , 5ì¼ í›„ì—ëŠ” 0ì¼ì§¸ë¶€í„° ì‚¬ìš©ì„ ì‹œì‘í•œ `Ouro`ë³´ë‹¤ ì´ ê¸°ëŠ¥ì„ ë” ë§ì´ ì‚¬ìš©(15 ëŒ€ 12 í´ë¦­)í–ˆìŠµë‹ˆë‹¤.

ë§Œì•½ `Borus`ê°€ `full subscription`ì„ êµ¬ë§¤í•˜ê³  `Ouro`ëŠ” êµ¬ë§¤í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, _ëª¨ë¸ì€ ë¬´ì—‡ì„ ë°°ìš¸ê¹Œìš”?_

ì „ì²´ ì´ë ¥(`days_since_signup = all`)ìœ¼ë¡œ ëª¨ë¸ë§í•  ë•Œ, `Borus`ê°€ ê°€ì¥ ë†’ì€ ìˆ˜ì¹˜ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— `days_since_signup`ì´ ë†’ì„ìˆ˜ë¡ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.

í•˜ì§€ë§Œ ìš°ë¦¬ê°€ ê°€ì… í›„ ì²« 5ì¼ê°„ì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ì ì´ë ¥ë§Œ ìœ ì§€í•œë‹¤ë©´ ê²°ë¡ ì€ ë°˜ëŒ€ê°€ ë©ë‹ˆë‹¤.

_ì™œ ì²« 5ì¼ê°„ì˜ ì´ë ¥ë§Œ ìœ ì§€í• ê¹Œìš”?_

ì´ ì‹œì‘ ë‹¨ê³„ì—ì„œì˜ í–‰ë™ì´ ì „ì²´ ì´ë ¥ì„ ë¶„ì„í•˜ëŠ” ê²ƒë³´ë‹¤ (ì˜ˆì¸¡ ì •í™•ë„ ì¸¡ë©´ì—ì„œ) ë” ê´€ë ¨ì„±ì´ ë†’ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ì„œ ë§í–ˆë“¯ì´ ê° ì‚¬ë¡€ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.

 

#### ë¬´í•œí•¨ê³¼ì˜ ì‹¸ì›€


<img src="data_preparation/infinity.png" alt="" width="150px" />


ì´ ì£¼ì œì— ëŒ€í•œ ì˜ˆì‹œëŠ” ë°©ëŒ€í•©ë‹ˆë‹¤. ì´ ì¥ì˜ í•µì‹¬ì„ **ë°ì´í„°ê°€ ì‹œê°„ì— ë”°ë¼ ì–´ë–»ê²Œ ë³€í•˜ëŠ”ì§€**ì— ë‘ê² ìŠµë‹ˆë‹¤. ë•Œë¡œëŠ” ê³ ì •ëœ ì‹œê°„ í›„ì— ë³€ìˆ˜ê°€ ìµœì†Œê°’(ë˜ëŠ” ìµœëŒ€ê°’)ì— ë„ë‹¬í•˜ëŠ” ê²ƒì²˜ëŸ¼ ê°„ë‹¨í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ëŠ” ì‰½ê²Œ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë°˜ë©´ì—, ì¸ê°„ì€ ë¬´í•œí•¨ê³¼ ë§ì„œ ì‹¸ì›Œì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì‹œë¥¼ ê³ ë ¤í•´ ë´…ì‹œë‹¤. _0 ê°’ì— ë„ë‹¬í•˜ëŠ” ë° ëª‡ ì‹œê°„ì´ í•„ìš”í• ê¹Œìš”?_

100ì‹œê°„ì€ ì–´ë–¨ê¹Œìš”?

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-time-variable-1-1.png" alt="100ì‹œê°„" width="384"  />
<p class="caption">(\#fig:data-preparation-time-variable-1)100ì‹œê°„</p>
</div>

ìŒ, ìµœì†Œê°’ì„ í™•ì¸í•´ ë´…ì‹œë‹¤.


```
## [1] "100ì‹œê°„ í›„ ìµœì†Œê°’: 0.22"
```

0ì— ê°€ê¹ì§€ë§Œ, _ë§Œì•½ 1000ì‹œê°„ì„ ê¸°ë‹¤ë¦°ë‹¤ë©´ ì–´ë–¨ê¹Œìš”?_

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-time-variable-3-1.png" alt="1,000ì‹œê°„" width="384"  />
<p class="caption">(\#fig:data-preparation-time-variable-3)1,000ì‹œê°„</p>
</div>

```
## [1] "1,000ì‹œê°„ í›„ ìµœì†Œê°’: 0.14"
```

ì•¼í˜¸! 0ì— ì ‘ê·¼í•˜ê³  ìˆìŠµë‹ˆë‹¤! `0.21`ì—ì„œ `0.14`ë¡œ ë§ì´ì£ . í•˜ì§€ë§Œ 10ë°° ë” ê¸°ë‹¤ë¦°ë‹¤ë©´(10,000ì‹œê°„) ì–´ë–¨ê¹Œìš”?

<div class="figure">
<img src="02_data_preparation_files/figure-html/data-preparation-time-variable-4-1.png" alt="10,000ì‹œê°„" width="384"  />
<p class="caption">(\#fig:data-preparation-time-variable-4)10,000ì‹œê°„</p>
</div>

```
## [1] "10,000ì‹œê°„ í›„ ìµœì†Œê°’: 0.11"
```

_ì—¬ì „íˆ 0ì´ ì•„ë‹ˆë„¤ìš”! ì‹œê°„ì´ ì–¼ë§ˆë‚˜ ë” í•„ìš”í•œ ê±°ì£ ?!_ ğŸ˜±


ì•„ì‹œë‹¤ì‹œí”¼, ì•„ë§ˆ ë¬´í•œëŒ€ì—ì„œ 0 ê°’ì— ë„ë‹¬í•  ê²ƒì…ë‹ˆë‹¤... ìš°ë¦¬ëŠ” ì§€ê¸ˆ [ì ê·¼ì„ (Asymptote)](https://en.wikipedia.org/wiki/Asymptote)ì„ ë§ˆì£¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.

_ìš°ë¦¬ëŠ” ë¬´ì—‡ì„ í•´ì•¼ í• ê¹Œìš”?_ ë‹¤ìŒ ì„¹ì…˜ìœ¼ë¡œ ì´ë™í•  ë•Œì…ë‹ˆë‹¤.


#### ë¬´í•œí•¨ê³¼ ì¹œêµ¬ ë˜ê¸°

ë§ˆì§€ë§‰ ì˜ˆì‹œëŠ” íšŒì‚¬ì˜ ê³ ê° ì—°ë ¹ ë¶„ì„ì—ì„œë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. _ì´ ê°’ì€ ë¬´í•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._

ì˜ˆë¥¼ ë“¤ì–´ í”„ë¡œì íŠ¸ ëª©í‘œê°€ `êµ¬ë§¤`/`ë¹„êµ¬ë§¤`ì™€ ê°™ì€ ì´ì§„ ê²°ê³¼ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì´ë¼ë©´, ìœ ìš©í•œ ë¶„ì„ ì¤‘ í•˜ë‚˜ëŠ” ì‚¬ìš©ì ì—°ë ¹ì— ë”°ë¥¸ `êµ¬ë§¤` ë¹„ìœ¨ì„ ê³„ì‚°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ê²°ë¡ ì— ë„ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤: _í‰ê· ì ìœ¼ë¡œ í•œ ê³ ê°ì€ ì´ ì œí’ˆì„ êµ¬ë§¤í•˜ëŠ” ë° ì•½ 6ê°œì›”ì´ í•„ìš”í•˜ë‹¤._

ì´ ë‹µì€ ë°ì´í„° ê³¼í•™ìì™€ ë„ë©”ì¸ ì „ë¬¸ê°€ì˜ ê³µë™ ì‘ì—…ì„ í†µí•´ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê²½ìš°, ì¸êµ¬ì˜ 95%ê°€ ê°€ì§€ëŠ” ê°’ê³¼ ë™ì¼í•˜ê²Œ 0ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í†µê³„ ìš©ì–´ë¡œëŠ” `0.95` **ë°±ë¶„ìœ„ìˆ˜(percentile)**ì…ë‹ˆë‹¤. ì´ ì±…ì€ [ë¶€ë¡ 1: ë°±ë¶„ìœ„ìˆ˜ì˜ ë§ˆë²•](#appendix-percentiles) ì¥ì—ì„œ ì´ ì£¼ì œë¥¼ ê´‘ë²”ìœ„í•˜ê²Œ ë‹¤ë£¹ë‹ˆë‹¤. ì´ëŠ” íƒìƒ‰ì  ë°ì´í„° ë¶„ì„ì˜ í•µì‹¬ ì£¼ì œì…ë‹ˆë‹¤.

ê´€ë ¨ëœ ì‚¬ë¡€ëŠ” **ì´ìƒì¹˜ ì²˜ë¦¬**ì¸ë°, [ì´ìƒì¹˜ ì²˜ë¦¬](#treatment_outliers) ì¥ì—ì„œ ë³¸ ê²ƒì²˜ëŸ¼ ì´ ì ˆë‹¨ ë°±ë¶„ìœ„ìˆ˜ ê¸°ì¤€ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



#### ë‹¤ë¥¸ ë¶„ì•¼ì˜ ì˜ˆì‹œ

ë§ì€ ë°ì´í„°ì…‹ì´ë‚˜ í”„ë¡œì íŠ¸ì—ì„œ ì´ëŸ° ì¢…ë¥˜ì˜ ë³€ìˆ˜ë¥¼ ì°¾ëŠ” ê²ƒì€ ì •ë§ í”í•œ ì¼ì…ë‹ˆë‹¤.

**ì˜í•™ì—ì„œ**, [ìƒì¡´ ë¶„ì„ í”„ë¡œì íŠ¸](https://en.wikipedia.org/wiki/Survival_analysis)ì˜ ê²½ìš° ì˜ì‚¬ë“¤ì€ ë³´í†µ í™˜ìê°€ ì¹˜ë£Œì—ì„œ _ìƒì¡´_í–ˆë‹¤ê³  ê°„ì£¼í•˜ê¸° ìœ„í•´ ì˜ˆë¥¼ ë“¤ì–´ 3ë…„ì´ë¼ëŠ” ì„ê³„ê°’ì„ ì •ì˜í•©ë‹ˆë‹¤.

**ë§ˆì¼€íŒ… í”„ë¡œì íŠ¸ì—ì„œ**, ë§Œì•½ ì‚¬ìš©ìê°€ íŠ¹ì • ì„ê³„ê°’ ë¯¸ë§Œìœ¼ë¡œ í™œë™ì„ ì¤„ì¸ë‹¤ë©´(ì˜ˆ:):
* ì§€ë‚œë‹¬ ë™ì•ˆ íšŒì‚¬ì˜ ì›¹ í˜ì´ì§€ì—ì„œ 10ë²ˆì˜ í´ë¦­
* 1ì£¼ì¼ í›„ì—ë„ ì´ë©”ì¼ì„ ì—´ì§€ ì•ŠìŒ
* 30ì¼ì´ ì§€ë‚˜ë„ êµ¬ë§¤í•˜ì§€ ì•ŠìŒ

ì´íƒˆí•œ ê³ ê° ë˜ëŠ” ê¸°íšŒë¥¼ ë†“ì¹œ ê³ ê°ìœ¼ë¡œ ì •ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê³ ê° ì§€ì›ì—ì„œ**, ì‚¬ìš©ìê°€ 1ì£¼ì¼ ë™ì•ˆ ë¶ˆë§Œì„ ì œê¸°í•˜ì§€ ì•Šìœ¼ë©´ ë¬¸ì œê°€ í•´ê²°ëœ ê²ƒìœ¼ë¡œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‡Œ ì‹ í˜¸ ë¶„ì„ì—ì„œ**, ë§Œì•½ ì´ ì‹ í˜¸ë“¤ì´ ì‹œê° í”¼ì§ˆì—ì„œ ì˜¨ ê²ƒì´ê³  í™˜ìê°€ ì–´ë–¤ ìœ í˜•ì˜ ì´ë¯¸ì§€ë¥¼ ë³´ê³  ìˆëŠ”ì§€ ì˜ˆì¸¡í•´ì•¼ í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´, ì²˜ìŒ 40msì˜ ê°’ì€ ë¬´ìš©ì§€ë¬¼ì…ë‹ˆë‹¤. ë‡Œê°€ ì‹ í˜¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ì‹œì‘í•˜ëŠ” ë° í•„ìš”í•œ ì‹œê°„ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ê²ƒì€ _"ì‹¤ìƒí™œ"_ì—ì„œë„ ì¼ì–´ë‚©ë‹ˆë‹¤. ëª¨ë“  ì—°ë ¹ëŒ€ì— ì í•©í•œ ë°ì´í„° ê³¼í•™ ì±…ì„ ì“¸ ë•Œ, ê·¸ê²ƒì„ ëë‚´ëŠ” ë° ì–¼ë§ˆë‚˜ ë§ì€ ì‹œê°„ì´ í•„ìš”í• ê¹Œìš”? ë¬´í•œí•œ ì‹œê°„ì¼ê¹Œìš”? ì•„ë§ˆë„ ì•„ë‹ ê²ë‹ˆë‹¤ ğŸ˜„.



#### ìµœì¢… ìƒê°

ë°ì´í„°ê°€ ë™ì ì¸ ê²½ìš° í›ˆë ¨ ë° ê²€ì¦ ì„¸íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì‹œê°„ í”„ë ˆì„ì„ ì •ì˜í•˜ëŠ” ê²ƒì€ **ê±°ì € ì–»ì–´ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë©°(not a free-lunch)**, ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë³€í•˜ëŠ” ë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ê²°ì •í•˜ëŠ” ê²ƒë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë¶„ì„ ì¤‘ì¸ ë°ì´í„°ì™€ ì ‘ì´‰í•˜ê¸° ìœ„í•´ **íƒìƒ‰ì  ë°ì´í„° ë¶„ì„**ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ì£¼ì œë“¤ì€ ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ì œ ì´ ì¥ê³¼ ëª¨ë¸ ì„±ëŠ¥ í‰ê°€ì—ì„œì˜ [ì‹œê°„ ì™¸ ê²€ì¦(Out-of-time Validation)](#out-of-time_validation)ê³¼ì˜ ê´€ê³„ë¥¼ ì–¸ê¸‰í•  ë•Œì…ë‹ˆë‹¤. ë¯¸ë˜ì˜ ì‚¬ê±´ì„ ì˜ˆì¸¡í•  ë•Œ, íƒ€ê²Ÿ ë³€ìˆ˜ê°€ ë³€í•˜ëŠ” ë° ì–¼ë§ˆë‚˜ ë§ì€ ì‹œê°„ì´ í•„ìš”í•œì§€ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œì˜ í•µì‹¬ ê°œë…ì€ **ì˜ˆì¸¡ ëª¨ë¸ë§ì—ì„œ ì‹œê°„ì„ ë‹¤ë£¨ëŠ” ë°©ë²•**ì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì§ˆë¬¸í•´ ë³¼ ì¢‹ì€ ê¸°íšŒì…ë‹ˆë‹¤: _ì´ëŸ¬í•œ ì‹œê°„ ë¬¸ì œë¥¼ ìë™í™”ëœ ì‹œìŠ¤í…œìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²ƒì´ ì–´ë–»ê²Œ ê°€ëŠ¥í• ê¹Œìš”?_

ê²½í—˜, ì§ê´€ ë° ì¼ë¶€ ê³„ì‚°ì„ ê¸°ë°˜ìœ¼ë¡œ ì„ê³„ê°’ì„ ì •ì˜í•˜ëŠ” ë° ìˆì–´ ì´ëŸ¬í•œ ë§¥ë½ì—ì„œëŠ” ì¸ê°„ì˜ ì§€ì‹ì´ ê²°ì •ì ì…ë‹ˆë‹¤.





![](introduction/spacer_bar.png)<!-- -->

